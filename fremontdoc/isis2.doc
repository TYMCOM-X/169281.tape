                                                               January 24, 1983












                  *****  **** *****  ****        ***** *****
                    *   *       *   *              *     *  
                    *    ***    *    ***   *****   *     *  
                    *       *   *       *          *     *  
                  ***** ****  ***** ****         ***** *****

                     Internally Switched Interface System
                               REFERENCE MANUAL

                           Network Development Group
                                Tymshare, Inc.
                             Cupertino, California





   DISCLAIMER -- Many of the terms used herein are references to the TYMNET
   technology -- these are more fully described in the document "TYMNET-I".



    New users of this ISIS Document may feel that some process descriptions
     are inadequate -- please advise us, so that these may be improved for
                                 future users.




       =================================================================
       |       THIS DOCUMENT IS THE SOLE PROPERTY AND CONFIDENTIAL     |
       |       INFORMATION  OF  TYMSHARE,  INC.,  AND  MAY  NOT BE     |
       |       COPIED  IN  WHOLE OR IN PART  OR  DISCLOSED  TO ANY     |
       |       THIRD PARTY  WITHOUT THE PRIOR  WRITTEN  CONSENT OF     |
       |       TYMSHARE.                                               |
       =================================================================








                                                                        ISIS-II
                                                               January 24, 1983













             Various sections of this document were written by:

           John O. Kopf
           Matt Young







             In addition, parts were derived from other documents, written by:

           Bruce Barrett
           Mike Rude




























                                                                        ISIS-II
                                        ISIS-II                January 24, 1983







                                   TABLE OF CONTENTS

        Section                                                            Page



        1.   ISIS-II -- Internally Switched Interface System                  1
          1.1   Introduction -- ISIS-II                                       1
          1.2   The Kernel                                                    1
          1.3   The Dispatcher                                                3
          1.4   Internal Process Communications                               3
          1.5   Routing of Circuits                                           5
          1.6   External Communications                                       6
          1.7   Internal Processes                                            6
          1.8   Communications with the Kernel                                6
          1.9   Libraries                                                     7


        2.   ISIS Process Intercommunication                                  9
          2.1   Message Format                                               10
          2.2   Message Types                                                10
          2.3   Intra-ISIS Communications                                    16
          2.4   Circuits                                                     24
             2.4.1    Circuit terminating on a port                          24
             2.4.2    Circuit Origination                                    24
                2.4.2.1     Normal Circuits                                  24
                2.4.2.2     Auxiliary Circuits                               25


        3.   ISIS Control Table                                              26
          3.1   Memory Management                                            28
          3.2   Host Management                                              30


        4.   ISIS Kernel SVC's                                               31
          4.1   Dismiss SVC's                                                31
             4.1.1    Dismiss--               SVC     DISMISS<0>,VALUE       31
             4.1.2    Fast Dismiss--          SVC     FAST<1>,--             31

          4.2   System SVC's                                                 32
             4.2.1    Syscall--               SVC     SYS<2>,SYSOP           32
                4.2.1.1     Restart Syscall--               SVC   SYS,0      32
                4.2.1.2     Connect-Foreground Syscall--    SVC   SYS,1      33
                4.2.1.3     Turn-on-Debug-Mode Syscall--    SVC   SYS,2      33
                4.2.1.4     Turn-off-Debug-Mode Syscall--   SVC   SYS,3      34
                4.2.1.5     Test-Debug-Mode Syscall--       SVC   SYS,4      34
                4.2.1.6     Freeze-Slot Syscall--           SVC   SYS,5      34
                4.2.1.7     Thaw-Slot Syscall--             SVC   SYS,6      34
                                        ISIS-II                January 24, 1983


                4.2.1.8     Test-Freeze Syscall--           SVC   SYS,7      34
                4.2.1.9     Read-DDT-Register Syscall--     SVC   SYS,8      34
                4.2.1.10    Read-DDT-PSD Syscall--          SVC   SYS,9      34
                4.2.1.11    Read-Background-Register Syscall SVC  SYS,10d    35
                4.2.1.12    Read-Background-PSD Syscall--   SVC   SYS,11d    35
                4.2.1.13    Read-Foreground-Register Syscall SVC  SYS,12d    35
                4.2.1.14    Read-Foreground-PSD Syscall     SVC   SYS,13d    35
                4.2.1.15    Read-DDT-MAC-Register Syscall-- SVC   SYS,14d    35
                4.2.1.16    Read-Background-MAC Syscall--   SVC   SYS,15d    35
                4.2.1.17    Read-Foreground-MAC Syscall--   SVC   SYS,16d    35
                4.2.1.18    Set-1-Protect Syscall--         SVC   SYS,17d    36
                4.2.1.19    Set-Protection Syscall--        SVC   SYS,18d    36
                4.2.1.20    Set-Back.-Execution-Addr. Syscall SVC SYS,19d    36
                4.2.1.21    Set-Fore.-Execution-Addr. Syscall SVC SYS,20d    36
                4.2.1.22    Setup-Dispatcher-MAC Syscall--  SVC   SYS,21d    36
                4.2.1.23    Check-SUP-Freeze-State Syscall- SVC   SYS,22d    36
                4.2.1.24    Check-SUP-Run-Q-State Syscall-- SVC   SYS,23d    37
                4.2.1.25    Freeze the SUP Syscall--        SVC   SYS,24d    37
                4.2.1.26    Thaw the SUP Syscall--          SVC   SYS,25d    37
                4.2.1.27    Set/Clear ALARM--               SVC   SYS,26d    37
                4.2.1.28    Read Super-Clock--              SVC   SYS,27d    38
                4.2.1.29    Set Super-Clock--               SVC   SYS,28d    38
                4.2.1.30    Set User Diagnostic--           SVC   SYS,29d    38
                4.2.1.31    Locate Storage Parameters--     SVC   SYS,30d    38
                4.2.1.32    Super-Freeze-Slot Syscall--     SVC   SYS,31d    38
                4.2.1.33    Halt-Slot Syscall--             SVC   SYS,32d    38
                4.2.1.34    Super-Halt-Slot Syscall--       SVC   SYS,33d    39
                4.2.1.35    SPY Syscall--                   SVC   SYS,34d    39
                4.2.1.36    Disconnect L.U. Syscall --      SVC   SYS,35d    39
                4.2.1.37    Replace MAC Set--               SVC   SYS,42d    39

          4.3   I/O Control--            SVC     IO<3>,OP:REG                40
             4.3.1    I/O Status Query                                       40
                4.3.1.1     I/O Attributes Query----OP=8000                  40

             4.3.2    Synchronous Input Control                              41
                4.3.2.1     Connect Synchronous Input----OP=0                41

             4.3.3    Synchronous Output Control                             42
                4.3.3.1     Connect Synchronous Output----OP=1               43
                4.3.3.2     Force Synchronous Output----OP=2                 43
                4.3.3.3     T-II Sync-line Connect----OP=6                   43
                4.3.3.4     T-II Sync-line Idle Test----OP=7                 43
                4.3.3.5     T-II Query Parameters----OP=8                    44

             4.3.4    Asynchronous I/O                                       44
                4.3.4.1     Connect Async----OP=3                            46
                4.3.4.2     Connect Async----OP=12d                          47

             4.3.5    Printer Output                                         47
                4.3.5.1     Connect Printer----OP=4                          48
                4.3.5.2     Force Printer Output----OP=5                     48
                                        ISIS-II                January 24, 1983


             4.3.6    Mother-board Serial-I/O                                49
                4.3.6.1     Connect M-board channel----OP=9                  49
                4.3.6.2     Force M-board input----OP=10d                    50
                4.3.6.3     Force M-board output----OP=11d                   50

          4.4   Shared Device Control--         SVC     SHARE<4>,ADDR        50
             4.4.1    MSC-1400 Disk I/O                                      53
             4.4.2    Tape SVC                                               54
             4.4.3    Disk I/O                                               56
             4.4.4    Disk I/O (Block)        SVC     0E,ADDR                57
             4.4.5    Disk I/O (Sector)       SVC     0F,ADDR                59

          4.5   Change MAC Set--               SVC     5,MACSET              59
          4.6   DDT SVC's                                                    59
             4.6.1    TTY Input--             SVC     0A,REG:TIME            59
             4.6.2    TTY Output--            SVC     0B,ADDR                60
             4.6.3    KIO--                   SVC     0D,TYPE                60
                4.6.3.1     SVC     KIO,0    detach circuit                  60
                4.6.3.2     SVC     KIO,1    transfer control                60
                4.6.3.3     SVC     KIO,2    T.I.D.                          60
                4.6.3.4     SVC     KIO,3    echo on                         60
                4.6.3.5     SVC     KIO,4    echo off                        61
                4.6.3.6     SVC     KIO,5    flush outbound circuit          61
                4.6.3.7     SVC     KIO,6    change context                  61
                4.6.3.8     SVC     KIO,7    change context (default)        61
                4.6.3.9     SVC     KIO,8    check own background            61
                4.6.3.10    SVC     KIO,9    check any background            62
                4.6.3.11    SVC     KIO,10d  output number                   62
                4.6.3.12    SVC     KIO,11d  set zap handling                62
                4.6.3.13    SVC     KIO,12d  send yellow ball                62
                4.6.3.14    SVC     KIO,13d  set trap handling               63
                4.6.3.15    SVC     KIO,14d  output single data char         63


        5.   ISIS DDT Commands                                               64
          5.1   Initialize Address Space::  A                                65
          5.2   Set Breakpoint::  B ADDR NUM                                 65
          5.3   Execute Slot::  E                                            66
          5.4   Fire-up::  F                                                 66
          5.5   Go:: G ADDR                                                  66
          5.6   Halt Slot::  H                                               66
          5.7   Initialize::  I                                              67
          5.8   Load From Disk::  L DISK-ADDR NUMBER-OF-BLOCKS MEM-ADDR      67
          5.9   LL UNIT SECTOR CORE-ADDR NUMBER-OF-BYTES                     67
          5.10  Mask for Search::  M MASK START-ADDR END-ADDR                67
          5.11  Next::  N                                                    68
          5.12  Proceed::  P                                                 68
          5.13  Read Memory::  R ADDR COUNT                                  68
          5.14  Read Registers::  RR REG COUNT                               68
          5.15  Save Memory on Disk::  S DISK-ADDR NUMBER-OF-BLOCKS MEM-ADDR 69
          5.16  SS UNIT SECTOR CORE-ADDR NUMBER-OF-BYTES                     69
          5.17  Type Old PSD::  T                                            69
          5.18  User Status::  U NUM                                         69
                                        ISIS-II                January 24, 1983


          5.19  Spy::  V ADDR                                                70
          5.20  Write Memory::  W ADDR COUNT string                          70
          5.21  Write Register::  WR REG COUNT string                        71
          5.22  Data Search::  X (0,1) (1,2,4) VALUE                         71
          5.23  Instruction Search::  Y (1,2,3) VALUE1 VALUE2 VALUE3         71
          5.24  Zap Command Circuit::  Z                                     72
          5.25  \                                                            72
          5.26  Switch Slot::  ^ NUM                                         72
          5.27  ?command                                                     73
             5.27.1   ?B        --query Breakpoints                          73
             5.27.2   ?ABS ADDR --query Absolute Address                     73
             5.27.3   ?MAC      --query MAC                                  73
             5.27.4   ?SMAC n   --(query) Select MAC Set                     73
             5.27.5   ?SLOT     --query SLOT number                          74
             5.27.6   ?VERN     --query version number                       74
             5.27.7   ?BT       --query Background PSD                       74
             5.27.8   ?FT       --query Foreground PSD                       74
             5.27.9   ?BRR R N  --query Background's Read Registers          74
             5.27.10  ?FRR R N  --query Foreground's Read Registers          74
             5.27.11  ?CT       --query Channels Terminating                 75
             5.27.12  ?USE      --query Dispatcher buffer usage              75
             5.27.13  ?HOST     --query host                                 75
             5.27.14  ?WHO      --query who                                  76
             5.27.15  ?EDBG     --(query) Enter DeBuG mode                   76
             5.27.16  ?LDBG     --(query) Leave DebuG mode                   76
             5.27.17  ?FREZ     --(query) FREeZe                             76
             5.27.18  ?THAW     --(query) THAW                               76
             5.27.19  ?RET      --query return                               76
             5.27.20  ?STAT     --query status                               77
             5.27.21  ?LMAC     --(query) Load Mac                           77
             5.27.22  ?PORT      --(query) Kernel Ports                      77
             5.27.23  ?HANG      --(query) hang Kernel Ports                 77
             5.27.24  ?TIME      --(query) system time                       77
             5.27.25  ?DIAG      --(query) Flush diagnostics                 78
             5.27.26  ?HIST      --(query) list ALL system diagnostics       78
             5.27.27  ?MEM      --query Memory Error Log                     78
             5.27.28  ?CPU      --(query) CPU utilization                    78
             5.27.29  ?SYS      --(query) SYStem utilization                 79
             5.27.30  ?LU       --(query) Logical Unit                       79
             5.27.31  ?TRAN     --(query) Transfer Logical Unit              79

          5.28  DDT Filesystem                                               79
             5.28.1   ?LIST                                                  80
             5.28.2   ?WRIT,FILENAME                                         80
             5.28.3   ?READ,FILENAME                                         80
             5.28.4   ?SAVE,FILENAME                                         80
             5.28.5   ?SSEG,MASK,FILENAME                                    80
             5.28.6   ?REST,FILENAME                                         81
             5.28.7   ?DELE,FILENAME                                         81
             5.28.8   ?NAME,FILENAME,FILENAME                                81
             5.28.9   ?CLOS                                                  81
             5.28.10  ?FORM                                                  81
                                        ISIS-II                January 24, 1983


          5.29  C  don't use!                                                82
          5.30  control-C                                                    82
          5.31  control-O                                                    83


        6.   NAD-KERNEL COMMUNICATIONS                                       84
          6.1   NAD-DDT commands                                             84


        7.   ISIS LIBRARY PACKAGES                                           87
          7.1   ISIS Interface Library Packages                              87
             7.1.1    START.LIB                                              87
             7.1.2    TRACE.LIB                                              89
             7.1.3    BID.LIB                                                89
             7   TIMOUT.LIB                                             90
             7.1.5    FRING.LIB                                              91
                7.1.5.1     Utility Routines                                 91
                7.1.5.2     Primative Input Routines                         92
                7.1.5.3     Primative Output Routines                        93

             7.1.6    BUFFER.LIB                                             94
             7.1.7    BBFLET.LIB                                             96
             7.1.8    CRASH.LIB                                              97
             7.1.9    FRONT.LIB                                              98
                7.1.9.1     Conventions                                      98

             7.1.10   FRNTND.LIB                                            100
             7.1.11   ARING.LIB                                             104
             7.1.12   FINISH.LIB                                            106

          7.2   Utility Routines                                            106
             7.2.1    OUTNUM.LIB                                            106
             7.2.2    CONVRT.LIB                                            107
             7.2.3    DATIME.LIB                                            108
             7.2.4    STATUS.LIB - User Command Handler                     109
             7.2.5    DARRAY.LIB                                            110

          7.3   Development Tools                                           112
             7.3.1    INSTAT.LIB                                            112
             7.3.2    SPY.LIB                                               113


        8.   CONFIGURING AN ISIS SYSTEM                                     116
          8.1   FILES                                                       116
             8.1.1    XXX.CMD FILE                                          116
             8.1.2    XXX.TYM file                                          117

          8.2   GENERATION                                                  122
          8.3   SHARED DEVICES                                              124
             8.3.1    DECLARING SHARED DEVICES                              124
             8.3.2    REFERENCING SHARED DEVICES                            125
                8.3.2.1     EXAMPLE:                                        126
                                        ISIS-II                January 24, 1983


        9.   STARTING & RESTARTING AN ISIS-II MACHINE                       127
          9.1   START UP (WITHOUT RELOAD)                                   127
          9.2   PROM START FROM SCRATCH                                     127
          9.3   SPECIALIZED RELOADING INFORMATION                           128
          9.4   DISK BOOTSTRAP                                              128


        10.  Loading an ISIS-II slot                                        130
          10.1  Prefered procedure                                          130
          10.2  alternate procedure [used for debugging]                    130


                                     APPENDICES
                                     ==========


        I.   Summary of ISIS Message Formats                                134


        II.  Summary of ISIS Kernel SVC's                                   137


        III. ISIS DISPLAYS AND HALTS                                        140
          III.1 NORMAL DISPLAY                                              140
          III.2 ISIS HALT DISPLAY                                           141
             III.2.1  DISPLAYED STATUS                                      141
             III.2.2  CRASH TABLE                                           142
             III.2.3  COMMON CRASH HANDLING                                 143
                III.2.3.1   Crash Codes                                     143


        IV.  CONVENTIONS FOR NAD - DDT COMMUNICATIONS                       145

          IV.1  PDP10 TO ENGINE                                             145
          IV.2  ENGINE TO PDP10                                             146


        V.   SEGMENT 14d -- Core Layout                                     147


        VI.  SEGMENT 15d -- Core Layout                                     149


        VII. OBSOLETE WAYS TO RESTART AN ISIS-II NODE                       151
          VII.1 RELOAD PROCEDURE (FROM TERMINAL)                            151
          VII.2 START-FROM-SCRATCH PROCEDURE                                152
             VII.2.1  TTY (MULTIFUNCTION) CARD START FROM SCRATCH           152

          VII.3 RELOAD PROCEDURE (FROM DISK)                                153


                                     GLOSSARY
                                     ========                               154
                                        ISIS-II                January 24, 1983


                                      INDEX
                                      =====                                 155
        ISIS-II -- Internally Switched Interface System        January 24, 1983






                 1 -  ISIS-II -- Internally Switched Interface System







                             1.1  Introduction -- ISIS-II


             ISIS  was  defined in  order  to develop,  debug,  and  deploy new
        interfaces on network nodes while protecting these nodes  from possible
        faults in these interfaces.

             ISIS is a system, not a program:   it is a set of rules as  to how
        the interfaces are to be  constructed, and how they are  to communicate
        with each other.  ISIS is not a TYMNET node or implementation of TYMNET
        technology.

             ISIS divides  the machine  into partitions, or  SLOTS.  Slot  0 is
        expected  to  have  special  properties  and  abilities,  including the
        routing  of  circuits  within  the  machine,  and  the   collection  of
        diagnostic and accounting information.

             To this  end, ISIS  treats the  TYMNET node  code as  just another
        interface.   The  TYMNET node  code  has special  properties  only when
        executing  in  slot  0.   These  include  the  routing  and  monitoring
        functions relating to the TYMNET supervisor.  When executing in  a slot
        other than  slot 0,  the TYMNET  interface performs  the function  of a
        gateway to TYMNET.






                                    1.2  The Kernel


             The control center of ISIS is the KERNEL, a process which provides
        ultimate  control  of  hardware,  including  the  scheduling  of  other
        processes.

             Interrupts  have  absolute   priority  in  the   machine.   During
        intervals when  no interrupts are  active, other processes  are active.
        These are either  the kernel, or some  process to which the  kernel has
        temporarily assigned the machine.


                                           1                            ISIS-II
        ISIS-II -- Internally Switched Interface System        January 24, 1983


             These processes are,  for the purposes of  scheduling, independent
        jobs, even  though a  set of processes  may be  working together,  as a
        SLOT.  These processes fall into a hierarchy of levels.

             The top level consists  of Foreground (or Quasi-)  processes.  The
        kernel schedules all active foreground processes to execute  once every
        25   milliseconds   (nominally;  40   scheduled   activities/second  is
        guaranteed), for a maximum period dependent upon the number  of devices
        which must  be serviced...periods  are in  clock ticks  (1/600 second),
        with a minimum of 2 ticks,  and one additional tick for each  3 logical
        units.   These are  intended to  communicate with  the  interrupt level
        processes, and thus must be scheduled at frequent intervals,  to permit
        timely responses.  To this end, each time the kernel tries  to schedule
        a job, it  first searches the queue  of foreground jobs, to  find which
        one should run  next.  If none  should go immediately,  the time--until
        the  next  foreground  process  is  to  run--is  made  available  to  a
        background process.

             At the bottom level are the Background jobs.  These are  the work-
        horses, which  perform the  major effort  of an  interface.  Background
        jobs  actually  fall  into  several  categories,  which   the  kernel's
        scheduler treats identically.  The Kernel divides the  time-domain into
        timeslices, of 50 milliseconds; these timeslices are interruptable (for
        foreground  execution).  A  job  may dismiss  at any  time  during it's
        timeslice...a new timeslice is then  created for the next job.   If the
        job doesn't dismiss  itself, the machine is  taken away from it  at the
        end of the timeslice, and all other jobs are given a chance  to execute
        their timeslices.  As a  result, a job may get  as many as 500  or more
        timeslices/second (in a lightly-loaded machine, with well-behaved jobs)
        to as few as 2-4, if there are several pathologic jobs active.

             The true background job, as already mentioned, is the  main effort
        of a given interface.  In addition, there are a set of DDT  jobs.  Each
        of  these  can be  logged  into through  the  network, and  be  used to
        control, modify, debug, or reload a given set of processes (a SLOT).

             Each  slot  has  an  DDT,  a  foreground,  and  a  background  job
        associated with it (note--not all  jobs associated with a slot  need be
        active concurrently).

             An intermediate  level job is  the DISPATCHER.  The  dispatcher is
        run each time a  true background job runs, and  is used to set  up that
        background job for  it's next use of  the machine.  In  particular, the
        dispatcher switches the output which  was produced by that slot  to the
        appropriate destination slots.









                                           2                            ISIS-II
        ISIS-II -- Internally Switched Interface System        January 24, 1983


                                  1.3  The Dispatcher


             The communications center of ISIS is the DISPATCHER.   The primary
        function of the dispatcher is to act as a switching center,  talking to
        several  interfaces.   Subsidiary  functions  are  to  perform  network
        accounting,  and  such  other  functions  which  it  is  convenient  to
        centralize.  It does NOT  have any knowledge of the  strange properties
        of specific interfaces, except that the interface associated  with slot
        0 has  the capability  to perform  routing, and  is the  repository for
        diagnostic, accounting, and other messages.

             Each interface has a set  of descriptors which it uses to  talk to
        the dispatcher, and may have  a translator to convert its  requests and
        messages to the  standard format.  Each interface  runs as one  or more
        independent jobs under the KERNEL, sharing time-slices with the rest of
        the  interfaces.   The  MAC (Memory  Access  Controller)  prevents each
        interface from destroying  another interface because of  illegal memory
        stores.  The  dispatcher checks the  data flow to  insure that,  if the
        interface is in error, it damages only its own subset of circuits.

             Under the MAC,  a job slot  can have up  to 16 segments.   By ISIS
        convention,  segment 15d  is readable  by all  processes,  and contains
        system  variables (such  as  clocks) which  may  be of  interest  to al
        processes.  Segment 14d is  the slot's Control Table Area  (CTA), which
        is  protected from  inadvertent modification  by the  slot  itself, and
        which contains the descriptors necessary and sufficient to describe the
        slot's  running configuration,  such as  pointers to  variables, memory
        layout, etc.  The dispatcher shares segment 14d with the slot, and uses
        these  fixed  cells  to communicate  with  the  individual  jobs.  This
        segment  is used,  by the  dispatcher, to  maintain records  of ongoing
        events.






                         1.4  Internal Process Communications


             The  dispatcher and  any particular  interface must  talk  to each
        other.  Because the processes are running concurrently,  the dispatcher
        may interrupt the other after any instruction.  The intercommunications
        has therefore been designed such that this is expected!

             The two directions of traffic must also be independent.

             The buffering mechanism used  is a ring buffer, which  one process
        fills, and the other empties.  No specific constraint is placed  on the
        size of  the buffer by  ISIS, and  indeed, there is  no reason  that an
        interface input ring must be the same size as it's output ring.


                                           3                            ISIS-II
        ISIS-II -- Internally Switched Interface System        January 24, 1983


             In designing an interface,  some knowledge is available as  to the
        interface  capacity.   (An  interface with  one  9600-baud  full duplex
        synchronous   line   interface   can   handle   no   more   than   1200
        characters/second  in  each  direction,  and,  allowing   for  protocol
        overhead, the  actual data transfered  is typically  significantly less
        than  this.) A  reasonable approximation  is to  allocate  one second's
        worth  of interface  traffic storage  to the  ring buffer,  to  allow a
        certain degree  of "burstiness" to  data transfers.  (E.g.,  one simple
        interface might have 200 character buffers, while another might require
        5000 characters of buffering for  50 Kbps capacity, or because  of some
        constraint on the size of records which it must transmit.)

             Two interfaces talk to  each other through the  dispatcher.  There
        is no requirement that the originator and the receiver of a data stream
        be synchronous, so some  mechanism is necessary to  apply back-pressure
        over  a  circuit.  This  back-pressure  may be  end-to-end,  or  may be
        applied by the dispatcher to one of the interfaces.

             The dispatcher normally tries to move data from the source process
        to the  destination, but  for a variety  of reasons,  may be  unable to
        deliver immediately, and must instead buffer the data  temporarily.  In
        this case, it will have reason to back-pressure the source port.  It is
        NOT desirable to back-pressure the source interface itself,  since that
        would  stop ALL  its output--some  of which  would still  be allowable,
        since it might be going to a different interface.  (A common reason for
        buffering would be the destination ring being full--perhaps because the
        destination process is busy processing a burst of data--but this should
        not preclude  all traffic  from this source,  since some  of it  may be
        going elsewhere.)

             As  defined herein,  the  slot 0  interface includes  that  set of
        functions relating to  inter-node communications, circuit  routing, and
        diagnostic information.  Each interface, including slot 0, has a set of
        permuter  tables,  controlled   by  the  dispatcher,  which   tell  the
        dispatcher which  port of one  interface is connected  to what  port of
        another.

             The dispatcher receives commands and data from slot 0 and forwards
        them to  the appropriate interface,  constructing internal  circuits as
        necessary.   The  dispatcher  also  performs  the  internal  accounting
        function.

             If an interface requests a circuit to another host, the dispatcher
        will make a connection to the slot 0 interface.  If that  circuit turns
        out to  be an internal  circuit, the dispatcher  will do  the necessary
        interconnection from source to  destination process such that  the data
        flows  entirely within  the dispatcher,  without bothering  the  slot 0
        interface.

             The dispatcher could do all this without reference to slot  0, but
        in the case where slot 0 is connected to some external  network special
        constraints may apply, which should not be "wired" into the dispatcher.


                                           4                            ISIS-II
        ISIS-II -- Internally Switched Interface System        January 24, 1983


             (This  capability  permits  the  deployment  of  stand-alone  ISIS
        configurations  for the  purpose  of local  interconnection  of special
        interfaces, such as the routing of a set of dial-up bisync ports to ANY
        of a set of hosts connected to the same machine, perhaps with X-25 host
        interfaces.)

             The internal format of data being transmitted must be  uniform for
        all interfaces.  To this end,  a message format is used.   Each message
        originating at  an interface  has a header.   The header  specifies the
        port number and  the message type:  for  each message type  the message
        length is fixed.  One class  of messages would be pure  data transfers:
        type 1  means 1  character follows, 2==2,  ..., 80x==128d;  others mean
        specific  control  messages,  such  as  DISCONNECT,  etc.    Since  the
        predominance  of  traffic  is  expected  to  be  data,  a  receiver can
        eliminate much of the normal logic required to examine  each character,
        because this  information is  incorporated into  the message  type.  In
        particular, the dispatcher (and  other processes as well)  can process,
        or move  messages from  one ring  to another,  with the  major overhead
        occurring  in  looking  at  the  message  header  and  determining  the
        destination;  if  there is room  there, the message  can be  moved very
        quickly without excess character-by-character overhead.






                               1.5  Routing of Circuits


             Slot 0, as noted above, has special properties  involving routing,
        accounting, and  diagnostic collection.   The actual  implementation is
        dependent on the usage of that particular ISIS configuration.

             In a self-contained configuration, all circuits are  internal, and
        the routing algorithm may be very simple.

             When the slot 0 interface is part of an external network, circuits
        may  originate  and  terminate both  internally,  and  externally.  The
        interface is now more complex, since, in addition to internal circuits,
        it  need  also  perform  some  measure  of  external  routing,  and may
        additionally  support  external   traffic  which  passes   through  the
        interface, but  which is not  terminated (in the  view of  the external
        network) there.

             In a network with centralized control, such as TYMNET, all routing
        is  defered  to the  control  of the  supervisor,  which  also provides
        centralized accounting and diagnostic collection.  Use is also  made of
        the supervisor's ability to validate requests, and to permit  or reject
        certain connections (fences).




                                           5                            ISIS-II
        ISIS-II -- Internally Switched Interface System        January 24, 1983


                             1.6  External Communications


             Each logical  interface may require  some sort of  hardware driver
        (although this it  not strictly necessary),  which could imply  loss of
        security  (memory violations  for other  jobs) for  each  new interface
        generated.  However, the  majority of drivers  would seem to  fall into
        one of  four communication classes:   async, synchronous,  bit stuffing
        (SDLC), and channel,  or alternately, some  sort of special  I/O device
        driver  (printer, disc,  etc.).  ISIS  supports drivers  for  all these
        devices.   The value  of  centralized hardware  drivers,  although less
        efficient  than  allowing  each  process  to  drive  it's  own devices,
        outweighs  efficiency  considerations.   The  inter-process  protection
        afforded, the ability to change or share devices without rewriting each
        process using that  device, and the  lack of specialized  knowledge (on
        the part  of the process)  make the processes  much easier  to develop.
        Details  of  specific  logical  interfaces  relate  not  to  the actual
        transfer mechanism used,  but on the  buffer format--a detail  which is
        protectable, under the MAC, from interprocess corruption.  An interface
        which corrupts its buffer handling hurts only itself, not the hardware,
        or the other interfaces with  which it is sharing the  hardware.  Thus,
        each interface is constrained to request actual data transfers from the
        drivers, through the KERNEL.






                                1.7  Internal Processes


             In addition, in  a given machine which  has an available  slot and
        unused capacity, there  is no reason  that special processes  cannot be
        run.   These  processes   may  be  internal  or   network  housekeeping
        functions, or they may be specific applications.






                          1.8  Communications with the Kernel


             All interfaces  must be  able to communicate  with the  kernel, if
        only  to dismiss  themselves.  This  is done  through the  mechanism of
        SVC's (SuperVisory Command instructions).  There are a number  of these
        defined,  and  they  provide  primitive  functions,  such  as  dismiss,
        restart, connect  foreground, connect I/O  drivers, as well  as special
        SVC's for the use of DDT.



                                           6                            ISIS-II
        ISIS-II -- Internally Switched Interface System        January 24, 1983


                                    1.9  Libraries


             It is desirable to have a library of functional packages which may
        be  collected as  needed and  used  to produce  the skeleton  of  a new
        interface.  Since these packages  may change with requirements  (and as
        bugs are  found, as well  as when improvements  are discovered),  it is
        desirable to be able to create  a new version of an interface  with all
        corrections incorporated.  These requirements impose two constraints on
        the assembler:

             A.  It is desirable, to  prevent the number of library  files used
        for an interface from getting out of hand, for each library  package to
        contain ALL code and data allocations required for that  package.  This
        means that all packages should  be able to "scatter" blocks  of storage
        and code to  different MAC segments  to acquire the  appropriate access
        protection.   This  facility  is provided  by  the  NAD  assembler.  In
        particular, a  SEG directive provides  a separate location  counter for
        each segment of address space.

             B.   Since  an  interface  may  go  into  several  machines  (with
        different parameters), it is desirable to be able to transmit a list of
        parameter  and  library  files  on  releasing  an  interface,   so  the
        appropriate  code may  be generated.   To help  prevent  possible human
        errors, the assembler permits this file for use as a COMMAND file.





























                                           7                            ISIS-II
        ISIS-II -- Internally Switched Interface System        January 24, 1983



        =====================================================
        |                                                   |
        |       HARDWARE (INTERRUPTS)                       |
        |                         A           A           A |
        ==========================|===========|===========|=|
        |                         |           |           | |
        |      KERNEL (SCHEDULER) |           |           | |
        |                         |           |           | |
        ========================--|--=======--|--=======--|-|
        |                       | V |       | V |       | V |
        |     DISPATCHER    ----|   |   ----|   |   ----|   |
        |                   |   <=======>   <=======>   |   |
        --------------------|   | F |---|   | F |---|   | F |
        |               |   |   | O |   |   | O |   |   | O |
        |    OTHER      | D | B | R | D | B | R | D | B | R |
        |               | D | A | E | D | A | E | D | A | E |
        ----------------| T | C | G | T | C | G | T | C | G |
                        |   | K | R |   | K | R |   | K | R |
                        |   | R | O |   | R | O |   | R | O |
                        |   | O | U |   | O | U |   | O | U |
                        |   | U | N |   | U | N |   | U | N |
                        |   | N | D |   | N | D |   | N | D |
                        |     D     |     D     |     D     |
                        |           |           |           |
                        |   SLOT 0  |           |           |
                        |  (TYMNET) |           |           |
                        ------------|           |           |
                                    |           |   SLOT 2  |
                                    |           |------------
                                    |   SLOT 1  |
                                    -------------

                                       Figure 1.

             Schematic  layout  of  ISIS.  Showing  the  general  layout  for a
        configuration  with   three  slots.    The  hardware   module  services
        interrupts.   The kernel  schedules all  other processes,  and provides
        communications  between the  hardware  module and  the  individule slot
        processes.  Each slot has up to three processes active.  The foreground
        process  has  the  highest   priority  of  service,  and   is  executed
        periodically,  for  short  time-slices.  The  Dispatcher  has  the next
        highest priority, and runs  whenever any slot's background  process has
        finished.  The background process does the major portion of  the slot's
        work, and communicates with  other slots through the  dispatcher.  Each
        slot has a DDT process associated with it, so that maintainance  can be
        performed on that slot.







                                           8                            ISIS-II
        ISIS Process Intercommunication                        January 24, 1983






                         2 -  ISIS Process Intercommunication


             ISIS is a system to support interface processes.   These processes
        are connected  to a  subset of  NODE PORTS,   and communicate  with the
        other processes  ONLY through a  special process, the  DISPATCHER.  The
        interface  is the  SLAVE process,  and knows  ONLY about  its set  of N
        ports.  The  dispatcher translates  the relative  port number  into the
        appropriate real port and buffer numbers.

             Independent processes  communicate with  the dispatcher  via input
        and output  rings.  Each ring  contains a string  of MESSAGES,  each of
        which has a HEADER of  standard format.  Each message starts on  a word
        boundary.  Each ring is described by a collection of  DESCRIPTOR cells,
        to  permit the  driver  and receiver  to synchronize  with  each other.
        Requiring that messages start on word boundaries also insures  that the
        header can be referenced without consideration of ring folding.

             Each ring descriptor has the following parameters:

                --------.-------.-------.-------
                |      NFMI     |      CEI     |
                |-------.-------.-------.------|
                |       THE RING               |
                |----                      ----|
                |                              |

                where:

        NFMI    next fill message index         H-word
                The chararacter index of the next message to be filled.
        CEI     current empty index             H-word
                The character index of the next message to be emptied.
        RING    the ring data                   Variable number of Words
                the set of data

                Associated with each ring is an additional 16-bit quantity:

        MAXI    maximum index
                The number of characters reserved in the ring.  This is used
                to cycle indices.









                                           9                            ISIS-II
        ISIS Process Intercommunication                        January 24, 1983


                                  2.1  Message Format


             Each message header has the format:

        --------.-------.-------.-------.-------.-------.--
        |     RPORT     |M. TYPE| additional string dependent on MESSAGE TYPE
        ---------------------------------------------------

                Where:

        RPORT   halfword        relative port number for this process.  NOTE!!!
                                RPORT = 0 is ALWAYS used for intra-node commun-
                                ications.
        M. TYPE byte            MESSAGE TYPE






                                  2.2  Message Types


             The following message types are defined (for individual circuits):

        TYPE    length  usage
        (hex)   (total)

        00      var.    Needle:  (Originates in Slot 0,  and is interpreted by
                        the Dispatcher, thence passed to slot)

                format:

                --------.-------.-------.--------
                |    RPORT      |   0   | length|
                |-------.-------.-------.-------|
                |        INVOICE NUMBER         |
                |-------.-------.-------.-------|
                | Dest. Host #  | Orig. Node #  |
                |-------.-------.-------.-------|
                | Orig. Host #  | Orig. Port #  |
                |-------.-------.-------.-------|
                |          XXX          | TPC   |
                |-------.-------.-------.-------|
                |I      0       |  NID  | size  |
                |-------.-------.-------.-------.---
                |   USER NAME ("size" bytes long)
                -------------------------------------

           RPORT:  The port number assigned to this circuit.
           length:  The 4th byte is additional length of needle (in BYTES).


                                          10                            ISIS-II
        ISIS Process Intercommunication                        January 24, 1983


           Destination Host:  This field is used by the dispatcher to determine
               which slot is being addressed.
           Orig. Host #:  This  MAY specify which host originated a circuit.  A
               zero in  this field  indicates that it  may be  ignored;  either
               there is no origination  host, or that it is  unknown.  However,
               if known, it is made available to the slot for any specific slot
               requirements, such as limiting access, etc.

               NOTE:   if a  circuit originates  on another  slot within
                       this machine, then  the high-order bit  in "Orig.
                       port no." will be set, and the rest of  the field
                       is the originating  Slot 0 port  which originated
                       the circuit.
           XXX:  This field is unused, and provided for future expansion.
           TPC:   (circuit ThroughPut Class, also known as the "gouging level")
               has the high-order bit set (to distinguish from unused TPC), and
               the low 7 bits specify the level (currently 0-3).
           I:   The High-order  bit of  this field  is set  if the  circuit can
               support IIX (Intelligent Interface) protocol.
           NID:  The network (Terminal) ID;  usage as defined in  TYMNET.  (The
               two high-order bits may be set, and should be ignored.)
           USER NAME is several chars long, terminated by C/R or ";".   If this
               is an  override logon,  the first character  of username  is "!"
               [0A1].   Username characters  will all  have the  high-order bit
               off.


        01-9D   4-A0    data text string

                format:

                --------.-------.-------.-------.-------.-------
                |    RPORT      |   n   |   n characters of data
                ------------------------------------------------


        9E      3       detach (originate yellow ball, zap or O.B. or timeout)
        9F      3       disconnect (ZAP circuit)
        A0      3       apply backpressure
        A1      3       release backpressure
        A2      3       flush output (in direction of this message) [GOBBLER]
        A3      3       flush input (in opposite direction to this message)
        A4      3       data lost in this direction [Black Ball]
        A5      3       data lost in opposite direction [Gray Ball]
        A6      3       enter 'DEM'
        A7      3       leave 'DEM'
        A8      3       enter 'Transparency'
        A9      3       leave 'Transparency'
        AA      3       Green Ball
        AB      3       Red Ball
        AC      3       Yellow Ball
        AD      3       Orange Ball
        AE      3       'break' begin

                                          11                            ISIS-II
        ISIS Process Intercommunication                        January 24, 1983


        AF      3       'hang up'
        B0      4       query terminal parameter N, N in byte 4
        B1      5       set terminal parameter N, N in byte 4, value in byte 5

                format:

                --------.-------.-------.--------
                |    RPORT      |  B1   |   N   |
                --------.------------------------
                | value |
                ---------

                        where "value" may be 1 to 4 significant bits (right
                                justified), and:

                N       length  USAGE
                0       1       ECHO CONTROL
                1       1       ECHO CONTROL-I
                2       1       ECHO CR/Rubout on LF
                3       1       ECHO LF on CR
                4       1       CR DELAY
                5       4       INPUT BAUD RATE
                6       4       OUTPUT BAUD RATE
                7       1       PARITY
                8       1       HALF-DUPLEX
                9       4       PARAMETER A
                10      4       PARAMETER B
                11      4       PARAMETER C
                12      1       X-ENABLE
                13      1       ECHO CONTROL-H
                14      1       REVERSE X-ENABLE
                15      4       PARAMETER D
                16      1       KATAKANA
                17      1       TERMINATE OUTPUT on BREAK
                18      1       ECHO-ESC
                19      1       Q-MODE

        B2      6       Pseudo-needle (from Slot 0)

                format:

                --------.-------.-------.--------
                |    RPORT      |  B2   |  key  |
                --------.-------.-------.--------
                |   local key   |
                --------.-------.

             This specifies circuit is  built to slot 0...however,  no messages
        other than B3's or 9F's should be sent until until the slot  receives a
        B6 message.




                                          12                            ISIS-II
        ISIS Process Intercommunication                        January 24, 1983


        B3      4       normal logon character (to Slot 0)

                format:

                --------.-------.-------.--------
                |    RPORT      |  B3   | CHAR  |
                ---------------------------------

             (NOTE...the  high-order  bit of  CHAR  had better  be  on,  or the
        supervisor may ignore the characters.)

        B4      4       normal logon status  (from Slot 0)

                format:

                --------.-------.-------.--------
                |    RPORT      |  B4   | STAT  |
                ---------------------------------

             STAT has the format:

                X X X 0 0 S S S
                | | |     |
                | | |     Status message code:
                | | |     0 - continue
                | | |     1 - "please log in"
                | | |     2 - "error, type username"
                | | |     3 - "error, type password"
                | | |     4 - "username"
                | | |     5 - "password"
                | | empty output buffer
                | echo on
                empty input buffer





















                                          13                            ISIS-II
        ISIS Process Intercommunication                        January 24, 1983



             If extended  login-status has  been requested,  then STAT  has the
        format:

                X X X S S S S S
                ----- ---------
                  |       |
                  |       Status message code:
                  |       0-5 - as before
                  |       8 - "please see your rep..."
                  |       9 - "bad mud"
                  |       0A - "circuits busy"
                  |       0B - "host not avail..."
                  |       0C - "host out of ports"
                  |       0D - "host down"
                  |       0E - "host shut"
                  |       0F - "try again in 2 minutes"
                  |       10 - "access not permitted"
                  |       11 - "no host specified"
                  |       12 - "bad host number"
                  |       13 - "mud error"
                as before

        B5      4       Logon failure (from Slot 0)

                format:

                --------.-------.-------.--------
                |    RPORT      |  B5   |  err  |
                ---------------------------------

             where "err" means:
                0       ISIS unable to complete request
                1       format error
                2       bad user name
                3       bad mud
                4       system unavailable
                5       down-line load or dial-out failure
                6       timeout
                7       access not permitted
                8       out of origination ports
                9       try again later
                0A      bad requesting-host number
                0B      requesting-host not up on requesting node










                                          14                            ISIS-II
        ISIS Process Intercommunication                        January 24, 1983


        B6      10d     successful logon from this port (from Slot 0)

                format:

                --------.-------.-------.--------
                |    RPORT      |  B6   |  IIX  |
                |-------.-------.-------.-------|
                |          invoice #            |
                |-------.-------.----------------
                |  Orig. Host.  |
                -----------------

               IIX has the  high-order bit set for  internal (slot-slot)
                       circuits;

               The  low-order 7-bits  of IIX  = 1  indicates IIX-capable
                       circuit, else 0.

        B7      8       addendum to accounting

                format:

                --------.-------.-------.--------
                |     RPORT     |  B7   | ignore|
                |-------.-------.-------.-------|
                | 0E|msg|         value         |
                ---------------------------------

                        See "TYMNET-I" document for format of values.

        B8      3       super-'hang up' (for half-duplex terminals)

        B9      4       set transmit limit

                format:

                --------.-------.-------.--------
                |    RPORT      |  B9   | limit |
                ---------------------------------

             Limit  is the  maximum  number of  characters the  source  of data
        should send before dismissing  and allowing the destination to  look at
        the data, and apply back-pressure, if necessary.  (A number  >9D should
        be treated as 9D.)

        BA      3       'break' end

        BB      3       Zap Acknowledge

             Zap  acknowledge  is returned  by  the dispatcher  to  a  slot, to
        acknowledge that  the dispatcher has  serviced the zapper  (or detach),
        and the port is now free.  This message is dependent upon a CTA control
        bit.  It is ignored if received by the dispatcher.

                                          15                            ISIS-II
        ISIS Process Intercommunication                        January 24, 1983


        BC      3       Enter 'Alternate Output Device Mode'

        BD      3       Leave 'Alternate Output Device Mode'

        BE      4       Zap with reason: sent by slot.

                Format:

                --------.-------.-------.--------
                |    RPORT      |  BE   |reason |
                ---------------------------------

             Message BE is just like message 9F, except that there is  an extra
        byte which may specify the reason.  Currently the only valid  reason is
        "0", signifying host-out-of-ports.

        BF      3       SIIX command

        C0      3       TIIX command

        C1-FF   ?       to be defined as the need arises






                            2.3  Intra-ISIS Communications


             RPORT  = 0  has special  significance and  formats.   Each message
        header has the format:

        --------.-------.-------.-------.-------.-------.----
        |       0       |SUBTYPE| additional string dependent on subtype
        -----------------------------------------------------

             In the descriptions below, "key", where used, is 4 times  the slot
        number, since it's most common usage is indexing into word tables.

             Certain of these messages  are dependent upon bits in  the Control
        Table Area (CTA) "CNTRL" bits.  These are identified by  the appearance
        of an "*" next to the message type.











                                          16                            ISIS-II
        ISIS Process Intercommunication                        January 24, 1983


                intra-node subtypes:

        SUB-    LENGTH  USAGE
        TYPE    (BYTES)

        00 *    3       restart-request.   The originating slot will wait for a
                        response!


        01 *    3       restart-response.   Slot originates this in response to
                        an observed type 00,  AFTER resetting the ring indices,
                        and zapping all circuits!


        02 *    4       node has been taken over (originates at slot 0, goes to
                                all interested slots)

                Format:

                --------.-------.-------.--------
                |       0       |  02   |Sup No.|
                ---------------------------------


        03      9       report to supervisor's log  (originate at slot, goes to
                                slot 0)

                format:

                --------.-------.-------.--------
                |       0       |   03  |  key  |
                |-------.-------+-------+-------|
                |     DATA2     | R TYP | DATA1 |
                |-------.-------+-------+--------
                |PROD ID|
                ---------

             R TYP:  Report Type

             PROD ID:  Product ID


        04      12d     report host status (originates in slot, goes to slot 0)

                format:

                --------.-------.-------.--------
                |       0       |   4   |  key  |
                |-------.-------.-------.-------|
                |  Host number  | number/ports  |
                |-------.-------.-------.-------|
                |      RH#      |status | H key |
                ---------------------------------

                                          17                            ISIS-II
        ISIS Process Intercommunication                        January 24, 1983



           Key is set by the dispatcher.
           "RH#"  is Relative-Host-number.   It is  the number  of the  host in
               question; ie, host  0, host 1, etc.  (of the slot).  It  MUST be
               less than the number of hosts on the slot.
           Status byte currently specifies two distinct parameters:
                    The low 2 bits specify one of 4 host states:

                        0       host answered;
                        1       host down;
                        2       host shut (but up);
                        3       host gone.

                    The next bit (mask 04) specifies if "H key" is meaningful.

           H key is host key:  This  may be provided by certain hosts,  such as
               TYMSHARE's  370's.

               NOTE:   This  message  interacts with  the  ISIS Control-
                       Table.  In particular, unless the CTA permits the
                       number-of-ports  and host-number  to  be changed,
                       these  fields  are  forced  to  the  assembled-in
                       values, and thus may be left 0 for this case.


        05      8       report accounting  (originates in Dispatcher [or in
                                slot], goes to Slot 0)

                format:

                --------.-------.-------.-------
                |       0       |   5   |unused|
                |-------.-------+-------+------|
                |      accounting message      |
                --------------------------------


        06 *    8       tell host time (originates in Slot 0, goes to all
                                interested slots)

                format:

                --------.-------.-------.--------
                |       0       |   6   |unused |
                |-------.-------+-------+-------|
                |            GMT                |
                ---------------------------------







                                          18                            ISIS-II
        ISIS Process Intercommunication                        January 24, 1983


        07      11d     Pseudo-needle request (originates in slot, goes to
                                Slot 0)

                format:

                --------.-------.-------.--------
                |       0       |   7   |  key  |
                --------.-------+.------+-------|
                |   local key   |IE             |
                |---------------+-------.-------|
                |  Orig. Host   |  NID  |
                -------------------------


               Key     Used between  the dispatcher and  Slot 0  to keep
                       track  of the  slot  making the  request,  and is
                       meaningless at the slot level.

               Local Key   Used for the slot to identify a response to a
                       request.   All requests  outstanding  should have
                       unique local keys.

               I       Indicates intelligent interface (IIX-capable).

               E       Request extended login-status (to be  returned in
                       B4 message).

               Orig. Host   The origination host number.

               NID     The  Network  (Terminal)  ID,  as  defined within
                       TYMNET.  (Note, the two high-order bits should be
                       set -- "or"ed with x'C0.)


        08      11+var  auxiliary circuit request (originates in slot, goes to
                                Slot 0)

                format:

                --------.-------.-------.--------
                |       0       |   8   | key   |
                --------.-------+.------+-------|
                |   local key   |I              |
                --------.-------+-------+------------
                |  Orig. Host   | size  |   string
                -------------------------------------

             Usage is exactly like the 0:07 request, except that the "NID" byte
        is replaced by a size byte and username string (this should contain the
        username, a ":", and the decimal string denoting the  destination host;
        it is also desirable to terminate the string with either C/R or ";").



                                          19                            ISIS-II
        ISIS Process Intercommunication                        January 24, 1983


        09      7       Unable to provide pseudo-needle (originates in Slot 0
                                OR Dispatcher, goes to slot)

                format:

                --------.-------.-------.--------
                |       0       |   9   |  key  |
                |-------.-------+-------+--------
                |   local key   |  err  |
                -------------------------

                where "err" is:

                0       Slot 0 will not honor request at this time...try later
                1       Format error;
                2       Bad User Name;
                3       Bad Mud;
                4       System Unavailable;
                5       Down-line load or dial-out request failure;
                6       Timeout;
                7       Access not permitted;
                8       Out of origination ports;
                9       Sup will not honor request at this time...try later.


        0A      10d     report host port availability (originates in Slot, goes
                                to Slot 0)

                format:

                --------.-------.-------.--------
                |       0       |   0A  |  key  |
                |-------.-------+-------+-------|
                |  Host number  | number/ports  |
                |-------.-------+---------------|
                |      RH#      |
                -----------------

             Number/ports is the number of ADDITIONAL (remaining) circuits that
        can be accepted on this host.   FOR NOW, 0 is translated into  a "soft-
        shut", and non-0 specifies "soft-answer".

               NOTE:   This  message  interacts with  the  ISIS Control-
                       Table.  In particular, unless the CTA permits the
                       host-number to be  changed, this field  is forced
                       to the assembled-in values, and thus may  be left
                       0 for this case.







                                          20                            ISIS-II
        ISIS Process Intercommunication                        January 24, 1983


        0B      7       Host unacceptable (From Slot 0)

                format:

                --------.-------.-------.--------
                |       0       |   0B  |  key  |
                |-------.-------+-------+--------
                |  Host number  | err   |
                -------------------------

                Where "err" has the values:
                        0       host table full (in node code)
                        1       impostor, rejected by Sup
                        2       imposter, rejected by node
                        3       illegal host on restricted node

             If slot 0 has no more host table space, and an attempt was made to
        bring a NEW host to a  state other than "GONE", then slot 0  will issue
        this diagnostic  message (with  err = 0)  back to  the slot  making the
        request.

             If the  new host  number already  exists, either  on the  node, or
        elsewhere within the network, this host is classed as an  imposter, and
        rejected.


        0C      10d     report host cost (originates in slot, goes to Slot 0)

                format:

                --------.-------.-------.--------
                |       0       |   0C  |  key  |
                |-------.-------+-------+-------|
                |  Host number  |     cost      |
                |-------.-------+---------------|
                |      RH#      |
                -----------------

               NOTE:   This  message  interacts with  the  ISIS Control-
                       Table.  In particular, unless the CTA permits the
                       host-number to be  changed, this field  is forced
                       to the assembled-in values, and thus may  be left
                       0 for this case.


        0D *    3       no supervisor (originates at slot 0, goes to all
                                interested slots)







                                          21                            ISIS-II
        ISIS Process Intercommunication                        January 24, 1983


        0E *    6+var   "1-DOWN" text   (originates at Slot 0,  goes to one or
                                all slots)

                format:

                --------.-------.-------.--------
                |       0       |   0E  |  key  |
                |-------+-------+-------+--------
                | Stype | Size  | Text String . . .
                ----------------------------------

             This message is used to  introduce a text string into one  or more
        slots in  order to provide  the capability of  updating messages  to be
        originated subsequently  by the slot,  which may be  time-critical:  an
        example might  be an  indication of  unavailability at  some particular
        time and date.

               Key     If  the key  is  = 0,  this  is assumed  to  be a
                       broadcast message, and is delivered to  ALL slots
                       (NOTE...A slot will not be presented this message
                       UNLESS it has the "1-DOWN" [bit 400x] bit enabled
                       in the CTA status word).

               Stype   Used to distinguish between (potential) different
                       messages.

               Size    Specifies the length of the text string;  0  is a
                       valid value, and is used to cancel an outstanding
                       message.


        0F      3       Report all hosts   (originates at Slot 0,  goes to the
                                dispatcher,  who  responds  with  current host
                                status)

             This message originates in  slot 0, causes a series  of intra-node
        subtype 4 "Report Host Status" to be returned by the  dispatcher.  Used
        by slot 0 to recover states of all hosts.
















                                          22                            ISIS-II
        ISIS Process Intercommunication                        January 24, 1983


        10      14d     EXTENDED report host status  originates in slot,  goes
                                to slot 0)

                format:

                --------.-------.-------.--------
                |       0       |  10   |  key  |
                |-------.-------.-------.-------|
                |  Host number  | number/ports  |
                |-------.-------.-------.-------|
                |    RH No.     |status | H key |
                |.------.-------.----------------
                |I  0   |  PID  |
                -----------------

               Key     set by the dispatcher.

               RH No.  Relative-Host-number.   It is  the number  of the
                       host in  question; ie, host  0, host 1,  etc. (of
                       the slot).   It MUST be  less than the  number of
                       hosts on the slot.

               Status  currently specifies two distinct parameters:
                    The low 2 bits specify one of 4 host states:

                        0       host answered;
                        1       host down;
                        2       host shut (but up);
                        3       host gone.

                    The next bit (mask 04) specifies if "H key" is meaningful.

               H key   host key:  This may be provided by certain hosts,
                       such as TYMSHARE's  370's.

               I       Host I/Q.

               PID     Product ID.

             The Type 10 message is  like the type 04, except for  the addition
        of additional fields for IIX.

               NOTE:   This  message  interacts with  the  ISIS Control-
                       Table.  In particular, unless the CTA permits the
                       number-of-ports  and host-number  to  be changed,
                       these  fields  are  forced  to  the  assembled-in
                       values, and thus may be left 0 for this case.







                                          23                            ISIS-II
        ISIS Process Intercommunication                        January 24, 1983


                                     2.4  Circuits


             An interface may originate or terminate circuits, or both.





                    2.4.1  Circuit terminating on a port

             The  first indication  that an  interface has  of a  circuit being
        built TO  the interface, is  the appearance of  a NEEDLE in  the input.
        When the NEEDLE  arrives, the circuit  is already constructed,  and the
        NEEDLE may be followed immediately by messages for that port.





                    2.4.2  Circuit Origination

             An  interface  may  originate circuits  in  either  of  two forms,
        depending on the characteristics of the interface and  the requirements
        of the circuit.

             Circuits are  actually constructed by  the Slot 0  supervisor, and
        the  ports  are  assigned  external  to  the  interface.   Thus circuit
        origination  involves  some  initial  communication  with  the  Slot  0
        interface, and, through it, the supervisor.

             The first thing an interface must do, to initiate a circuit, is to
        emit the  appropriate form of  pseudo-needle request.  This  travels to
        the Slot  0 interface, which  either rejects it,  or returns  a pseudo-
        needle, causing a circuit  to be constructed THRU ISIS,  connecting the
        node-code  and the  interface.  this  circuit permits  subsequent logon
        information to travel to the supervisor.



        2.4.2.1  Normal Circuits

             A NORMAL circuit  is normally originated  at an external  entry to
        the network, and is characterized by the need for a password.

             The FIRST thing an interface  must do is request a channel  to the
        Slot  0  interface, via  a  NORMAL-CIRCUIT-PSEUDO-NEEDLE  request.  The
        response  specifies the  port to  use, and  indicates that  an internal
        circuit has been established to the Slot 0 interface.

             At this  time, the interface  may proceed with  the login,  in the
        manner of a TYMSAT.


                                          24                            ISIS-II
        ISIS Process Intercommunication                        January 24, 1983


             When  completed,  a  success/failure  indication  is  sent  to the
        interface, and it may then take the appropriate action.

             The actual sequence of transmissions is:

        inter-  TYMNET  Sup
        face
            ==>                 request pseudo-needle [0|07 (pseudo)
                                        or 0|08 (Aux)]
            <==                 pseudo-needle (assigns port on interface
                                        and on TYMNET) [B2] [or 0|09]
            ==>    ==>          logon character stream appropriate
                                        to type of logon [B3] [B4 response]
                   <==          sup provides a needle to TYMNET interface
                                        for successful logon [B6] [or B5]
            <==                 successful logon
                ============>circuit    circuit completed to destination



        2.4.2.2  Auxiliary Circuits

             An AUX circuit is characterized by the absence of a  password, and
        the requirement of specifying a destination host.  It is used for well-
        defined usage, such as a circuit originating at that host.

             An AUX circuit is somewhat simpler to construct, since it involves
        only one request and a pair of responses indicating success or failure.
        That is, the same rules  as followed as for building a  normal circuit,
        except no messages B3 or B4 are involved.
























                                          25                            ISIS-II
        ISIS Control Table                                     January 24, 1983






                                3 -  ISIS Control Table


             Fixed locations  for constants, and  temp storage  for dispatcher;
        The ISIS dispatcher and other programs will find this table at  a fixed
        location in the slot's absolute memory:

        CTA     SEG     $A 14           :force to segment 14d!
        CNTRL   WS      1               :Control Flags, used by DISPATCHER
           format (bits):
         - - x x.x x x x.x x x x.x x x x.
             | | | | | | | | | | | | | +--not currently used
             | | | | | | | | | | | | +----set if  ports not reusable until they
             | | | | | | | | | | | |            emit a disconnect
             | | | | | | | | | | | +------set if number of ports may be changed
             | | | | | | | | | | +--------set if host numbers may be changed
             | | | | | | | | | +----------slot wants  to  know  about take-over
             | | | | | | | | +------------slot wants to know supervisor time
             | | | | | | | +--------------slot can originate reset requests
             | | | | | | +----------------slot   wants   zappers  and  detach's
             | | | | | |                        acknowledged.
             | | | | | +------------------set to accumulate project code
             | | | | +--------------------slot wants out-of-band flow-control
             | | | +----------------------slot wants "1-down" messages
             | | +------------------------slot wants to know if Supe is lost
             -----------------------------slot uses extended memory

        CTASIZE WS      1               :size of CTA area (bytes)
        AREAS   WS      $A 14           :memory area requirements (bytes/area)
        NPROT   HS      1               :count of usable protection bytes
        PROT    BS      $A 14           :memory protection requirements:
                            bit masks   usage
                                1       execution access permitted
                                2       write access permitted
                                4       read allowed (required for others)

        ISTART  WC      START           :job execution start address
        DSTART  WC      DEBUG           :DDT execution start address
        STATUS  WC      FPANEL          :pointer to front-panel display cell
        HTBLPT  WC      HOSTS           :pointer to host table
        PTBLPT  WC      PORTS           :pointer to port table
        TTBLPT  WC      PTABLE          :pointer to termination table
        IRINGP  WS      1               :Input -- ring descriptor start address
        ORINGP  WS      1               :Output-- ring descriptor start address
        IBKPNT  WS      1               :input-- pointer to "FROMISIS" bits
        OBKPNT  WS      1               :input-- pointer to "TOISIS" bits
        PCBPNT  WC      PCTTBL          :pointer to project code term. table
        CSADDR  WS      1               :core start address
        HOSTN   HC      MAXHOST         :Maximum number of hosts

                                          26                            ISIS-II
        ISIS Control Table                                     January 24, 1983


        NPORTS  HC      MAXPORT         :Highest real port number (from 0)
        IMAXI   HS      1               :Input -- size of input ring in bytes
        OMAXI   HS      1               :Output -- size of output ring in bytes
        SLOTNO  HS      1               :Slot number (put there by dispatcher)
        SVERNO  HS      1               :Slot version number (assembled in)
        DD.BG2  WS      1               :Second DDT entry
        MACPNT  HC      MACR-0E0000     :HW pointer to extended MAC sets
        MAXCNT  HC      NUMAC           :HW count of extended MAC sets
                WS      10              :extra entries for future expansion!

             There are also a number of additional tables and  cells, addressed
        by the dispatcher.  These should  be placed in segment 0E,  (or another
        write-protected  area), where  they can  be protected  from inadvertent
        modification by the slot's code.

           START:  The start address for background code.
           DEBUG:  The address (if  non-zero) of a special  routine, executable
               from  DDT,  to  provide  application-dependent  information  and
               control.
           FPANEL:  The address  of a halfword, which  can be displayed  at the
               front panel for diagnostic purposes.
           HOSTS:  The master table, for this slot, showing the numbers  of all
               of  the  hosts to  be  applied.  (NOTE...unless  the  CNTRL word
               specifies that the host numbers may be changed, this  table MUST
               be assembled in!)
           PORTS:   The master  table, for  this slot,  of all  port allowances
               (number of host ports) for each potential  host.  (NOTE...unless
               the  CNTRL  word  specifies  that the  number  of  ports  may be
               changed, this  table MUST be  assembled in!) The  HIGH-ORDER TWO
               BITS of each entry specify the host state:
                                00 - answered
                                01 - down
                                10 - shut
                                11 - gone
           PTABLE:  Slot permuter table (length NPORTS+1 halfwords); extra port
               is used for  port 0...thus NPORTS  is the number  of serviceable
               ports, and is also the highest port number to use:
                entry = 0 --> not in use
                entry  >0 --> index for dispatcher buffer
                entry  <0 --> timeout waiting to be thrashed
                        (or waiting for disconnect to return)
           MACR:  The extended MAC register sets are assembled starting  at the
               label MACR.  Each set must consist of 16 fullword  MAC registers
               followed by  a fullword  pointer and  two fullwords  of storage.
               The  pointer contains  the  address of  the PSD  used  to resume
               execution after the Change MAC Set SVC has been issued.  The MAC
               registers take the form:

                WXYYZZZZ

                where
                        W       is the protection mask
                        X       is the extended memory block number

                                          27                            ISIS-II
        ISIS Control Table                                     January 24, 1983


                        YY      is the number of pages in the segment
                        ZZZZ    is the starting page of the segment

           The  starting  page number  is  the starting  page  relative  to the
               beginning  of the  block.  The  protection mask  is the  same as
               shown forfor the label PROT above.
           "TOISIS": A bit array,  of length maxport, whose bits  correspond to
               the  same  numeric ports;   the  bit turned  on  means  that the
               DISPATCHER is willing  to accept data  on that port  (applied to
               data going to ISIS).
           "FROMISIS": A bit array, like  "TOISIS", set by the slot  to specify
               which ports  it is  willing to accept  data on.   Set by  A0, A1
               conventions, or may be set explicitly by slot.
           "PCBTBL": An  optional bit  array, the bits  of which  specify those
               input  characters which  are  to terminate  the  "project code".
               This  is ignored  unless the  "project code"  CNTRL bit  is set.
               Even then, it may be  null (pointer set to 0), in  which project
               codes of 27 characters will be accumulated.  If not null,  up to
               27 characters of data will be accumulated, unless  terminated by
               one of the data characters specified by PCBTBL;  the terminating
               character  is  included  in  the  project  code.   (Project code
               characters  are those  included in  the input  data  stream, but
               exclude control mesages.)






                                3.1  Memory Management


             The user's memory layout is defined by a table in the CTA,  and is
        in terms of AREAS, where  an area corresponds to an integral  number of
        MAC segments, rather than  exactly one.  In particular,  The executable
        code area need  not start at 10000,  but may instead start  wherever is
        convenient.   Further, the  user program  is permitted  to  specify the
        protection to  apply to each  segment at load  time, and to  change the
        protection,  independently in  each independent  process, at  run time,
        dynamically.   This  permits  the  definition  of  multiple   areas  of
        executable code, and  allows, for example,  the foreground to  not have
        access to  background data  areas, such as  bufferlets, if  this should
        seem desirable.











                                          28                            ISIS-II
        ISIS Control Table                                     January 24, 1983



                                Figure 1.

                ---------
                |       |
                |       |
                |  FsF  | ----------+
         F0000  |-------|           |
                |       |           |
                |       |           |
                |  EaE  | ----------|---+
         E0000  |-------|           |   |
                                    |   |
                   <->              |   |
                                    |   |
                |-------|           |   |
                |       |           |   |
                |  2a2  | ----+     |   |
                |  2a2  |     +-----|---|------ |- 3s3 -|
         30000  |-------|           |   |       |  3s3  |
                |  2a2  |           |   |       |  2s2  |
                |  2a2  |           |   |       |- 2s2 -|
                |  2a2  | ----+     |   |       |  2s2  |
          20000 |-------|     +-----|---|------ |  2s2  |
                |       |  +--------|---|------ |- 1s1 -|
                |       |  | +------|---|------ |  0s0  |
                |  1a1  | -+ | +----|---|------ |  0s0  |
         10000  |-------|    | |    |   +------ |- EsE -|
                |       |    | |    |              <->
                |  0a0  | ---+ |    |
                |  0a0  | -----+    +---------- |  FaF  |
             0  ---------
        Slot Virtual address space        Physical address space

             Where "NaN" denotes area "N", and "s" denotes segment.


             The user has no access  control over segments 14d and 15d  (15d is
        still used to examine system parameters, such as the  clocks).  Segment
        14d  maps  into the  beginning  of the  user's  physical  address area,
        unconditionally!  This insures that ISIS knows where to find it  at all
        times, independent  of the  setting of the  user's MAC  registers.  DDT
        will be  able to  write into  SEG 14d,  provided that  the slot  is not
        running (in order to  initialize storage), but this segment  is outside
        the control  of the  slot, and write  protected.  As  a result  of this
        convention,  the  physical  storage  is  "scrambled",  relative  to the
        topological address space of the user, but, since he can  never address
        the real space directly, there should be no real  difficulty.  However,
        any process which  loads a slot's  storage into physical  memory (down-
        stream load, etc.) must be aware of this convention.




                                          29                            ISIS-II
        ISIS Control Table                                     January 24, 1983


                                 3.2  Host Management


             NOTICE...ALL management  of hosts is  performed by the  slots!  In
        particular, the slot MUST issue an 0:04 message to change the  state of
        the host, and in particular to create initial knowledge of host numbers
        and the number of ports to apply to that host.  The dispatcher will not
        do any management,  other than update the  HOSTS and PORTS  tables (for
        it's own information) unless  some condition outside the  slot (halting
        the slot, etc) forces the dispatcher to take all hosts down and zap all
        circuits.  In particular, no  attempt will be made to  avoid repetitive
        messages (i.e., host  12 down, host  12 down,...), although  TYMNET may
        have strong objections!.

             If the slot  crashes, all circuits will  be zapped, and  all hosts
        will be set "DOWN".  If the  slot is HALTED, the hosts will  instead be
        set "GONE".

             If  the  slot  issues  a host  message  0:04,  0:0A  or  0:0C, the
        dispatcher will verify that "RH#" is less than HOSTN, else it  is cause
        to crash the slot!

             A host MUST be set GONE before the host number can be changed, but
        the host number may be changed in the process of bringing the host from
        GONE to any other state.

             For the 0:0A and 0:0C messages, a mismatch of host numbers is also
        cause to crash the slot.

             However, in the TYMNET-I environment, a "RH#" of zero is  the ONLY
        legitimate value, and in this  environment, HOSTN is taken to be  1 for
        each slot--this  will cause a  crash for any  attempt to  address other
        than host 0!!

             The TYMNET-II node code will be configured for a certain number of
        hosts and ports.  If these are exceeded, a 0:0B message is  issued back
        to the requesting slot, indicating the error.

             If "CNTRL" masked with 04  or 08 is zero (disallowing  host number
        or port changes), then (and ONLY then) the values presented by the slot
        for that  "RH#" will be  ignored, and the  assembled-in values  will be
        used instead!

             Once a circuit has been built  to a host, it is tied to  the slot.
        In particular, the dispatcher will not have knowledge of which circuits
        correspond  to  a  host, and  that  host  may be  taken  to  any state,
        including "GONE",  without affecting the  existing circuits.   The slot
        must manage this  function if it wants  to drop circuits when  the host
        goes down.





                                          30                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983






                                4 -  ISIS Kernel SVC's


             Under ISIS, there may be  three kinds of jobs running.   These are
        DDT, RUN, and QUASI jobs.  These have different usage, and so the SVC's
        are different.  In particular, many SVC's are illegal except under DDT.






                                  4.1  Dismiss SVC's


             The following SVC's are legal from all jobs.  The kernel  may have
        different Interpretations of the usage, as described below.





                    4.1.1  Dismiss--               SVC     DISMISS<0>,VALUE

             Gives  up the  remaining part  of this  time slice.   The  user is
        rescheduled after VALUE seconds, if he is a RUN or DDT user.  If  he is
        a QUASI user, VALUE is taken as the number of clock ticks to ADD to the
        job's timeout before resuming execution.





                    4.1.2  Fast Dismiss--          SVC     FAST<1>,--

             Fast dismiss causes  no registers to  be saved (nor  restored next
        time), and no timeouts to be allowable.













                                          31                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


                                   4.2  System SVC's


             There are  a number  of system  functions provided  through SVC's.
        These are functions,  common to many  processes, which are  provided by
        the ISIS system.





                    4.2.1  Syscall--               SVC     SYS<2>,SYSOP

             SYSCALL is equivalent to  SVC 2,SYSOP.  It is used to  perform all
        sorts of operations  for the user.  In  all cases, SYSOP  specifies the
        operation to  perform.  If  there is a  parameter to  be passed,  it is
        passed in register 0, unless otherwise specified.

             In the following  descriptions, references to Trap-Blocks  will be
        found.  These are all of common form, starting at ADDR:

                ADDR    PSD
                ADDR+8  R0,R1
                ADDR+10 TRAP (transfer) address

             In the event of  a trap, the old PSD  is saved at ADDR, R0  and R1
        are  saved  at  ADDR+8  (and ADDR+0C),  and  control  is  transfered to
        ADDR+010.  In this  event, special information may  be placed in  R0 or
        R1, depending upon the trap condition.



        4.2.1.1  Restart Syscall--               SVC   SYS,0

             The Restart SVC causes all  hardware and system traps to  be taken
        by the KERNEL and passed to the job, rather than crashing the  job.  R0
        contains an  address (ADDR) of  a Trap-block.  If  ADDR is not  a valid
        address, a non-skip return is made, else a skip return occurs.   (It is
        recommended that ADDR  be in a read-only  area).  The user  code should
        later execute  another RESTART SVC  (this later SVC  may have ADDR  = 0
        causing the old  address to be used)  to reenable restart.  If  after a
        trap occurs, a second trap  occurs before another Restart SVC  has been
        executed, then the  user program will  be permanently removed  from the
        run queue.  The trap will return (in R1) the trap reason (to  user code
        at ADDR+10):

                0       MANUAL RESTART
                1       POWER FAILURE
                2       PARITY ERROR
                3       DISPATCHER CRASH (Error Detected BY Dispatcher)
                4       ILLEGAL INSTRUCTION
                5       ILLEGAL SVC
                6       SYSTEM CRASH (PARITY ERROR)

                                          32                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


                7       PROTECTION VIOLATION
                8       NON-RECOVERABLE DEVICE-CHECK

               NOTE:   Manual Restart and  Power Failure will  crash ALL
                       jobs.  The others  will crash only  the offending
                       job.   When  a  foreground  job  crashes,  it  is
                       disconnected, and  any associated  BACKGROUND job
                       is  also  crashed.   A  crash  in  the background
                       causes the foreground to be disconnected.

               NOTE:   A   crash   in  the   foreground   (e.g.  illegal
                       instruction)  will  cause   the  foreground-state
                       (registers, PSW) to be copied onto the background
                       state,  and  then  the  background   is  crashed.
                       Foreground  crashes  may  be  distinguished  from
                       background  crashes  by examining  the  PSD;  for
                       foreground  crashes,  the first  byte  is  set to
                       x'FC'  ("Foreground  Crash")  --  it  is   0  for
                       background crashes.

               NOTE:   The execution of a restart SYSCALL will  have the
                       same  effect on  a running  background job  as if
                       that  job  had  taken  a   system-detected  crash
                       (except when the system detects that the  call is
                       in response to  a system crash):   All dispatcher
                       circuits  will  be  disconnected,  the foreground
                       will be  halted, host will  be set down,  and the
                       slot  will be  dismissed for  4 seconds!   If the
                       slot is in  debug mode, the restart  SYSCALL will
                       cause it to become frozen.



        4.2.1.2  Connect-Foreground Syscall--    SVC   SYS,1

             The Connect Quasi-Process SVC permits a background job  to control
        a foreground  process.  The contents  of R0 is  used as the  address to
        start  execution.  R0  = 0  says turn  off foreground.   The foreground
        process is guaranteed frequent,  short shots at the CPU,  for real-time
        activities, while the backround job has longer, less frequent shots.



        4.2.1.3  Turn-on-Debug-Mode Syscall--    SVC   SYS,2

             This SYSCALL sets the slot to DEBUG mode, and may be executed from
        DDT, Foreground or Background.   In DEBUG mode, any crash  (through the
        kernel) causes the slot to be FROZEN.






                                          33                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


        4.2.1.4  Turn-off-Debug-Mode Syscall--   SVC   SYS,3

             Turns off DEBUG mode.  Any subsequent crashes are taken  in normal
        fashion.



        4.2.1.5  Test-Debug-Mode Syscall--       SVC   SYS,4

             Returns R0 non-zero if DEBUG mode is in effect, else R0 is zero.



        4.2.1.6  Freeze-Slot Syscall--           SVC   SYS,5

             This SYSCALL  causes the  background and  foreground to  be FROZEN
        (infinite time dismiss),  and may be  executed from DDT,  Foreground or
        Background.



        4.2.1.7  Thaw-Slot Syscall--             SVC   SYS,6

             Turns  off  FREEZE  dismissal.   Background  and  foreground  will
        continue with execution.



        4.2.1.8  Test-Freeze Syscall--           SVC   SYS,7

             Returns R0 non-zero if the slot is FROZEN, else R0 is zero.



        4.2.1.9  Read-DDT-Register Syscall--     SVC   SYS,8

             R0 (Modulo  16d) is used  to address one  of DDT's  registers, and
        return it in R0.



        4.2.1.10  Read-DDT-PSD Syscall--          SVC   SYS,9

             R0  (modulo 2)  is used  to address  one of  DDT's PSD  words, and
        return it in R0.









                                          34                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


        4.2.1.11  Read-Background-Register Syscall SVC  SYS,10d

             R0  (Modulo  16d)  is  used to  address  one  of  the background's
        registers, and return it in R0.



        4.2.1.12  Read-Background-PSD Syscall--   SVC   SYS,11d

             R0  (modulo 2)  is used  to address  one of  the  background's PSD
        words, and return it in R0.



        4.2.1.13  Read-Foreground-Register Syscall SVC  SYS,12d

             R0  (Modulo  16d)  is  used to  address  one  of  the foreground's
        registers, and return it in R0.



        4.2.1.14  Read-Foreground-PSD Syscall     SVC   SYS,13d

             R0  (modulo 2)  is used  to address  one of  the  foreground's PSD
        words, and return it in R0.



        4.2.1.15  Read-DDT-MAC-Register Syscall-- SVC   SYS,14d

             R0 (modulo 16d) specifies a segment...it is returned with  the DDT
        MAC-register for that segment.



        4.2.1.16  Read-Background-MAC Syscall--   SVC   SYS,15d

             R0  (modulo 16d)  specifies a  segment...it is  returned  with the
        Background MAC-register for that segment.



        4.2.1.17  Read-Foreground-MAC Syscall--   SVC   SYS,16d

             R0  (modulo 16d)  specifies a  segment...it is  returned  with the
        Foreground MAC-register for that segment.








                                          35                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


        4.2.1.18  Set-1-Protect Syscall--         SVC   SYS,17d

             R0 is divided into  left (L) and right  (R) halves.  L is  the MAC
        segment #;   R is  the protection to  apply to  that segment,  for this
        partition (ie, a call from background  has no effect on DDT).  L  > 13d
        is cause  for invoking  illegal-SVC trap.  R  has the  format described
        under "CTA".



        4.2.1.19  Set-Protection Syscall--        SVC   SYS,18d

             R0 contains the address of a string of consecutive  protections to
        be set:  The first byte indicates the first segment, the second  is the
        number of segments,  and successive bytes  are the protections.   If an
        attempt is made to set  protection on a segment >13d, illegal  SVC trap
        will occur.



        4.2.1.20  Set-Back.-Execution-Addr. Syscall SVC SYS,19d

             R0  contains  the  address at  which  the  Background  will resume
        execution.  The condition codes will not, however, be changed.



        4.2.1.21  Set-Fore.-Execution-Addr. Syscall SVC SYS,20d

             R0  contains  the  address at  which  the  Foreground  will resume
        execution.  The condition codes will not, however, be changed.



        4.2.1.22  Setup-Dispatcher-MAC Syscall--  SVC   SYS,21d

             Utility SVC, accessible ONLY to DDT (NOT to code running under the
        control of DDT).  Used to set up the MAC from the description contained
        in the job's "CTA".



        4.2.1.23  Check-SUP-Freeze-State Syscall- SVC   SYS,22d

             This  SVC is  illegal unless  there is  a SUP  (on  this machine).
        Then, normal  return indicates the  SUP is NOT  frozen, and  skip^1 (4)
        return indicates that it IS frozen!







                                          36                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


        4.2.1.24  Check-SUP-Run-Q-State Syscall-- SVC   SYS,23d

             This  SVC is  illegal unless  there is  a sup  (on  this machine).
        Then, if the SUP is on the run queue, the SVC skip^1 (4)  returns, with
        the current SUP execution address in r0; else normal return.



        4.2.1.25  Freeze the SUP Syscall--        SVC   SYS,24d

             This SVC is invalid unless there is a SUP (on this  machine),  and
        then ONLY to slot 0, or to users PROBE or RPROBE!



        4.2.1.26  Thaw the SUP Syscall--          SVC   SYS,25d

             This SVC is invalid unless there is a SUP (on this  machine),  and
        then ONLY to slot 0, or to users PROBE or RPROBE!



        4.2.1.27  Set/Clear ALARM--               SVC   SYS,26d

             This SVC permits a process to insure that it will be trapped after
        a given amount of time, if it does not cancel the request.  The process
        loads a value into R0:

                --------.-------.-------.--------
                | ticks |     trap address      |
                ---------------------------------

             where:

           If (R0) = 0, the request is canceled;
           ticks:  The  number of  clock ticks (1/600  second each)  before the
               trap is to be taken;
           Trap address:  the address of a  trap block to be used in  the event
               that timeout occurs.

             The  time specified  is in  units of  actual execution  time; this
        insures that a process will be able to execute a given amount of effort
        independent of machine load.

             Either dismiss-SVC  executed--while the alarm-clock  is active--is
        cause for the time to be canceled, and the trap to be taken.








                                          37                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


        4.2.1.28  Read Super-Clock--              SVC   SYS,27d

             The  system  attempts  to  read the  Super-clock.   If  it  is not
        successful (ie, non-existent or non-functional device), it exits  via a
        normal return.  If successful, the clock value is placed in Register 0,
        and a skip return (^4) is performed.



        4.2.1.29  Set Super-Clock--               SVC   SYS,28d

             This  is  a  privileged  command;   on  machines   configured  for
        Supervisor,  the  SVC is  valid  ONLY  from the  supervisor  or  from a
        privileged username;  On all other  systems, it is valid only  from DDT
        to someone with System-access License.



        4.2.1.30  Set User Diagnostic--           SVC   SYS,29d

             If R0 contains a valid address within this user space, the address
        will be  saved as  a user  diagnostic:  it  is assumed  that it  is the
        address of a "SC" text  string in the user space.  This  message, along
        with the time and  slot number, are saved  and will be output  later to
        the console TTY.



        4.2.1.31  Locate Storage Parameters--     SVC   SYS,30d

             Valid ONLY from DDT,  this SVC returns the physical  start address
        of this slot in R0, and the size of the slot, in bytes, in R1.



        4.2.1.32  Super-Freeze-Slot Syscall--     SVC   SYS,31d

             This  SYSCALL is  legal  ONLY in  system-DEBUG mode.   Then  R0 is
        expected to  contain the  number of a  valid slot.   That slot  will be
        found  and  FROZEN   (Background  and  foreground   have  infinite-time
        dismissal)!!  It  may be executed  from DDT, Foreground  or Background.
        SVC  is  illegal  if  ISIS-DEBUG  is  not  enabled.   Normal  return if
        specified  slot is  not on  run list.   Skip (^4)  return if  found and
        frozen.



        4.2.1.33  Halt-Slot Syscall--             SVC   SYS,32d

             This SYSCALL  causes a halt,  including complete  disconnection of
        circuits  and  devices,  for   the  calling  slot.   Valid   from  DDT,
        Foreground, or Background.


                                          38                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


        4.2.1.34  Super-Halt-Slot Syscall--       SVC   SYS,33d

             This  SYSCALL is  legal  ONLY in  system-DEBUG mode.   Then  R0 is
        expected to  contain the  number of a  valid slot.   That slot  will be
        found and halted (as in SVC SYS,32d).  SVC is illegal if  ISIS-DEBUG is
        not enabled.  Normal return if specified slot is not on run list.  Skip
        (^4) return if found and halted.



        4.2.1.35  SPY Syscall--                   SVC   SYS,34d

             R0 contains a pointer to a SPY discriptor;  if R0 = 0, SPY will be
        will be disconnected from this slot:

        DISCR   WC      ARYBIN          :pointer to start of bin array,
                WC      ESTART          :pointer to beginning of SPY space,
                WC      RANGE           :byte displacement from start,
                HC      NBINS           :the number of bins,
        FLAG    HC      0               :flag cell, set negative when done.

             Normal return  if the  SVC fails;  then R0 is  < 0  if one  of the
        arguments is bad (start or  end of either ARYBIN or  execution-space is
        not accessible  to that  slot);  R0 >  -1 means  that SPY  is currently
        assigned to the slot specified by R0.

             Skip (^4) return if successful, and SPY has been connected.

             It  is  the  responsibility  of  the  code  issueing  the  SVC  to
        initialize the FLAG and ARYBIN storage.



        4.2.1.36  Disconnect L.U. Syscall --      SVC   SYS,35d

             R0 contains  the number of  a Logical Unit  (L.U.), that is  to be
        disconnected from this slot.

             Normal  return if  the SVC  fails, because  the specified  L.U. is
        undefined.

             Skip  (^4)   return  if   successful,  and   the  L.U.   has  been
        disconnected.  Any I/O in progress will be halted.



        4.2.1.37  Replace MAC Set--               SVC   SYS,42d

             The Replace MAC Set SVC dynamically builds or replaces an extended
        MAC set.  R0 contains the MAC set number, which must be less the MAXCNT
        (from the CTA table).  R1 contains the address of the extended MAC set.
        The  MAC  set consists  of  16  fullword MAC  registers  followed  by a


                                          39                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


        fullword pointer and two  fullwords of storage.  See Section  3.0, ISIS
        Control Table, for the  MAC register format.  The pointer  contains the
        address of the  PSD used to resume  execution after the Change  MAC Set
        SVC has been issued.  IF  successful, a skip return (^4)  is performed.
        It will fail if the MAC set number is too large or if an address is out
        of range.






                  4.3  I/O Control--            SVC     IO<3>,OP:REG#


             "OP:REG" is  the operand  telling the  operation to  perform:  the
        low-order 4  bits specify the  user register which  starts the  list of
        arguments required;  the high-order bits specify the  numeric operation
        desired.

             SVC 3 connects I/O to the job.  The argument has two  fields.  The
        low  4  bits specifies  a  register,  which contains  the  start  of an
        argument  list.   Preceding  this  is  the  operation  to  perform,  as
        specified below.





                    4.3.1  I/O Status Query

             Each different kind of device has certain attributes, which may be
        of interest to user programs for one reason or another.  A mechanism is
        provided to query the attributes connected with each logical unit.



        4.3.1.1  I/O Attributes Query----OP=8000

             The Query Attributes SVC loads a specified buffer in the user area
        with the  appropriate attributes for  the specified logical  unit.  The
        SVC may  fail for invalid  buffer address ONLY,  resulting in  a normal
        return.  A skip return denotes success, and then status  and attributes
        are returned in the specified buffer area.

                REG# contains the logical unit number;
                REG#+1 contains the start address of the buffer;
                REG#+2 contains the number of attribute bytes requested.

             A skip return will always  cause at least one byte  of information
        to be placed in the buffer...the device type:



                                          40                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983



              value     device type
                0       synchronous line
                1       asynchronous group
                2       printer
                3       (not used)
                4       mother-board device
              ...
              376       range check...L.U. queried exceeds number supported
              377       no device assigned to L.U.

             If  the number  of bytes  requested is  greater than  1,  then the
        second  byte delivered  is the  actual device  number assigned  to that
        device:   the  string  "00:02..."  indicates  sync  line  2; "01:03..."
        indicates async group 3.

             Each  device  has  a  maximum  number  of  attributes;  the number
        returned  is the  arithmetic minimum  of the  number requested  and the
        number which exist.  If excess  bytes are requested, they will  be left
        in an undefined state.

               NOTE:   This SVC requires the use of RX3 instructions!





                    4.3.2  Synchronous Input Control

             Input is via an input  ring, allocated by the user.  This  ring is
        always an even number of bytes (integral number of halfwords),  and has
        a halfword  header which  is the interrupt  routine's pointer  for next
        halfword to fill.  The format is:

                --------.-------
                | fill index   |
                |-------.------|
                |      the     |
                |--   data   --|
                |     area     |
                |--(variable)--|



        4.3.2.1  Connect Synchronous Input----OP=0

             The Connect Input SVC connects the input process associated with a
        job's Logical Unit to the specified input buffer for that job.  The SVC
        may fail for  unassigned Logical unit, or  for the buffer being  out of
        range, resulting in a normal return.  A skip return signifies success.

                  REG# contains the logical unit number;
                  REG#+1 contains the start address of the input buffer;

                                          41                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


                  REG#+2 contains the size of the input buffer.

             This  SVC  overrides  any input  currently  in  progress,  and, if
        successful, initializes the buffer header.





                    4.3.3  Synchronous Output Control

             Output is via a control (rotor) list.  Each entry is 8-bytes long,
        and is  subject to word  addressing.  When an  entry is  completed, the
        command  portion is  set  to zero,  and  the next  successive  rotor is
        processed.  The format of a rotor entry is:

                --------.-------.-------.-------
                |   COMMAND     |     COUNT    |
                |-------.-------.-------.------|
                | ADDRESS of OUTPUT STRING     |
                --------------------------------

                where:

        COMMAND is one of the set of operations to perform:
        0       stop output (stop processing command list)...enter marking
                state
        1       output COUNT bytes starting at ADDRESS
        2       TRANSFER control to ADDRESS
        3       Turn off Request-to-send
        4       Turn on Request-to-send
        5       Set Bit Flag...Bit COUNT relative to ADDRESS
        6       Connect "clear-to-send"...bit COUNT relative to ADDRESS will
                henceforth reflect the state of this line's CS state
        7       Connect "data-set-ready"...bit COUNT relative to ADDRESS will
                henceforth reflect the state of this line's DSR state
        8       Turn off Data-terminal-ready
        9       Turn on Data-terminal-ready.
        10d     Set Output Padding to COUNT.

             Output padding is what the  line does when it has nothing  else to
        do.  The  default is  all bits  on ("marking  state").  The  default is
        restored when a line is disconnected from a process.

               NOTE:   A restriction  exists...The command list  and all
                       of  it's operands  MUST  be within  the  same MAC
                       segment.  Also, since some physical lines  do not
                       have RS  or CS, these  commands are  skipped over
                       (the driver ignores them) for these lines.

             The attribute list has maximum length of 3 bytes.  These are:

                                       00:sl:sa

                                          42                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


             where 00 is the  device type, "sl" is  the sync line, and  "sa" is
        the sync attributes:  x'80' indicates that the line  supports "RS"/"CS"
        usage.



        4.3.3.1  Connect Synchronous Output----OP=1

             The  Connect  Output SVC  attempts  to connect  a  list  of output
        descriptors to a logical unit.  A normal return indicates  failure, due
        to an invalid specification, or to a logical unit being active.

             A skip return indicates the output operation has started.

                  REG# contains the logical unit number;
                  REG#+1 contains the address of the first output descriptor.

               NOTE:   output  descriptors and  buffers MUST  be  in the
                       same MAC segment.



        4.3.3.2  Force Synchronous Output----OP=2

             The  Force  Output  SVC  attempts  to  connect  a  list  of output
        descriptors to a logical unit.  A normal return indicates  failure, due
        to  an  invalid  specification.  A  skip  return  indicates  the output
        operation has  started.  Any output  currently in progress  is aborted,
        possibly without indication.

                  REG# contains the logical unit number;
                  REG#+1 contains the address of the first output descriptor.

               NOTE:   Output  descriptors and  buffers MUST  be  in the
                       same MAC segment.



        4.3.3.3  T-II Sync-line Connect----OP=6

             The  TYMNET-II sync  line  connect causes  the  special, TYMNET-II
        sync-line driver to be connected for the specified logical  unit.  This
        driver is  very specific  to TYMNET-II, and  is of  no interest  to any
        other application, except for the need to be aware of it's presence.



        4.3.3.4  T-II Sync-line Idle Test----OP=7

             This  SVC permits  the testing  of a  TYMNET-II sync-line  for the
        presence  of  any  transmit  activity.   It  is  of  no  use  to  other
        applications.


                                          43                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


        4.3.3.5  T-II Query Parameters----OP=8

             This SVC collects certain Tymnet-II sync parameters.  It is  of no
        use to any application other than Tymnet-II.





                    4.3.4  Asynchronous I/O

             The attribute list has maximum length of 3 bytes.  These are:

                                       01:ag:aa

             where 01 is the device  type, "ag" is the async group  number, and
        "aa" is  one byte of  attributes:  x'80' indicates  that the  group can
        support 1200-baud.

             Async I/O is bi-directional.  Commands are transfered  between the
        driver and the job in  the data stream.  Character 00 is  an escape--it
        is always of the form 00:XX; in particular, the character pair 00:00 is
        data 00.  If the second character of an escaped pair (XX) is not 00, it
        is treated as a command.

             the following commands apply, from the job to the driver:




























                                          44                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983



           01--8F  generate XX 1/30-second delays;
           90--AF  set output baud rate index to (XX-90);
           B0--CF  set input baud rate index to (XX-B0);
             Baud rate indicies are:
                   0    10 cps
                   1    15 cps
                   2    30 cps
                   3    40 cps
                   4    60 cps
                   5    120 cps
                   6    30 cps (3767)
                   7    14.7 cps (2741)
                   8    10 cps (at 300 baud)
                   9    10 cps (at 1200 baud)
                  0A    240 cps
                  0B    480 cps
                  0C    960 cps
                  0D    50 baud (BAUDOT)
                  0E    75 baud (BAUDOT)
                  0F    75 baud (ASCII)

           D0--DF   enter connect  mode (XX-D0);  Place the  driver  into 'TID'
               mode.  Current modes are: 0 TYMNET TID mode
           E0      enter data mode;
           E1      disconnect;
           E2      enable;
           E3      RS up;
           E4      RS down;
           E5      generate 0.083 seconds of output break state.
           All others are ignored.

             the following commands apply from the driver to the job:

           80--8F  Connect mode has detected a character input, and  thinks the
               input baud rate is (XX-80): this pair will always be followed by
               the data character observed, as seen at that speed;
           90      Break detected;
           91      End-of-break detected.

             The SVC's use as arguments  an 8 word discriptor;  some  words are
        pointers.   If  any  of  the  pointers is  =  0,  that  element  is NOT
        connected.  The discriptor, whether in memory or in registers,  has the
        format:










                                          45                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


                W       Logical Group number
                W+1     pointer to start of Group ring array **
                W+2     pointer to Group CP halfword
                W+3     pointer to Group DSR halfword
                W+4     pointer to Group DTR halfword
                W+5     pointer to Group TOPORT halfword **
                W+6     pointer to Group FROMPORT halfword **
                W+7     pointer to Group TAM halfword **

                Where:

           Ring_array - An array of  16 data-blocks, one  for each port  in the
               group.  Each block consists of 2 data-rings;  the first of which
               is for input TO the slot (fron the port), the second  for output
               FROM the slot (to the port).  The ring format is  dependent upon
               the specific SVC used.
           CP -    The halfword bit array for Carrier Present.
           DSR -   The halfword bit array for Data Set Ready.
           DTR -   The halfword bit array for Data Terminal Ready.
           TOPORT - The  halfword bit  array for  data present  in  port output
               ring.
           FROMPORT - The halfword  bit array  for data  present in  port input
               ring.
           TAM -   The halfword bit array for output ring full.

             **TOPORT, FROMPORT, and TAM  are ignored if Ring array  pointer is
        null.

             The Connect Async SVC's attempt  to connect a list of  pointers (a
        discriptor) to an Async logical  unit (ALU).  An ALU covers a  group of
        16  ports.  A  normal  return indicates  failure, and  leaves  the unit
        disconnected.  This may be due to the logical unit not being valid, not
        being of type Async, or because  one of the pointers is outside  of the
        requestor's address space.

             A skip  return indicates  success, and the  logical unit  has been
        connected.



        4.3.4.1  Connect Async----OP=3

             The form of this SVC is:

                                   SVC     IO,030!R

             Where  R  specifies  the  first  register  containing   the  ASYNC
        descriptor block.  Since the block is 8 words (registers) long,  R must
        be one of R0-R8.  If R9-R15 are used, the SVC will fail.

             Each ring consists of 1 byte of fill index, 1 byte of empty index,
        and 14 bytes of ring storage.  The ring is empty when the fill  index =
        the empty index.

                                          46                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


        4.3.4.2  Connect Async----OP=12d

             The form of this SVC is:

                                    SVC     IO,0C0

             R0 is to contain a pointer to the ASYNC descriptor (in memory).

             The high-order halfword  of W (the  first word of  the descriptor)
        contains the ring-size n;  this is restricted to the range 8 < n  < 256
        and requires n be even (if n=0, the default size n=16d is used).

             The input ring  consists of 1 half-word  of BCT counter,  1 unused
        half-word, 1 byte of fill-cursor, 1 byte of empty-cursor, and n-6 bytes
        of ring storage.  The ring is empty when BCT has the value -1.

             The output ring  consists of 1 half-word  of BCT counter,  1 half-
        word of TAM counter, 1 byte of fill-cursor, 1 byte of empty-cursor, and
        n-6 bytes of ring  storage.  The ring is  empty when BCT has  the value
        -1.  The TAM counter tracks BCT, and it's transition through  the value
        0 causes the TAM (Transmitter  Active Mask) bits to be changed;   it is
        thus  the  quantity  which  controls  backpressure.   For  example,  if
        initialized to -3, then TAM goes  true when ever there are 3  (or more)
        characters in the ring.





                    4.3.5  Printer Output

             The printer is a pure output device.  the only quantity "input" is
        status information.

             The attribute list has maximum length of 2 bytes.  These are:

                                         02:pp

             where 02 is the device type, and "pp" is the printer number.

             Output is via a control (rotor) list.  Each entry is 8-bytes long,
        and is of the same format as in SYNCHRONOUS OUTPUT CONTROL, above.  The
        only meaningful commands are:

        0       stop output
        1       output COUNT bytes starting at ADDRESS
        2       TRANSFER control to ADDRESS







                                          47                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983



             The  string  of data  transmitted  to the  printer  is  of special
        format; special use is made of the individual characters:


            Code   Usage
           (Hex)

             00    End-of-line (Print command).
           01-3F   Blank Compression (output this many blanks).
             40    Form-Feed (Cause printer to eject paper).
           41-7F   Character compression -- repeat preceeding character CODE-40
               times.
           80-FF   Data characters - print directly.



        4.3.5.1  Connect Printer----OP=4

             The  Connect  Printer SVC  attempts  to connect  the  list  to the
        printer driver logical unit.  A normal return indicates failure, due to
        an invalid specification, or to the logical unit being active.

             A skip return indicates the output operation has started.

                REG# contains the logical unit number;
                REG#+1 contains the address of the first output descriptor;
                REG#+2 is a pointer to the halfword that you want the printer
                status saved in.  The status bits are:

                BIT
                 9 -    A one indicates the printer is out of paper.
                12 -    A one indicates the printer is busy, either printing
                        a line or reading a character into its line buffer.
                13 -    A one indicates the printer is out of paper.
                14 -    A one indicates the printer is not ready.



        4.3.5.2  Force Printer Output----OP=5

             The Force Printer is  like Connect Printer, except that  if output
        is in progress, it is terminated, and the new output is started.











                                          48                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


                    4.3.6  Mother-board Serial-I/O

             This description of mother-board usage is minimal;  explicit users
        are urged  to refer to  the documents (ISISDOC)DEVICE.DOC,  and Zilog's
        "Z-80 SIO Technical Manual" for details.

             The M-board is a device consisting of a big (mother) board, and up
        to 8 little (daughter) boards.   The daughter boards each have  a Zilog
        SIO  chip  and  interface  circuitry  for  two  channels  (ports).  The
        individual daughter-cards may be configured for  specific applications,
        such as async, bisync, HDLC, etc.

             EACH  channel  is  a  logical unit!   Thus  a  daughter  card (two
        channels) may be shared by two different users.

             Since each different type of Daughter-channel must be addressed in
        it's own  unique fashion,  ISIS does  not provide  other than  the bare
        interface  necessary  for  a  user  to  talk  to  the   card.   Certain
        constraints apply: all addresses must follow the "quad-word" rules, and
        all addresses must be in a contiguous area of user as well  as physical
        memory.

             Once operation  has been started,  it runs independently  of ISIS,
        unless the slot crashes or is halted.

             The attribute list has a maximum length of 3 bytes.  These are:

                                       04:c#:da

             where "04" is the device  type, "c#" is the device  channel number
        on this card, and "da" is the card device address.



        4.3.6.1  Connect M-board channel----OP=9

             This SVC is  used to initialize  the channel.  The  registers used
        are:


           REG#    contains the logical unit number;
           REG#+1  contains the low address that card may reference;
           REG#+2  contains the high address that card may reference;
           REG#+3  contains status address (optional; 0=null).

             If "status  address" is  specified, the  address is  forced modulo
        16d, and the following information is placed starting at that address:

                --------.-------.-------.-------.-------.-------.--------
                |        status         | unused| s/int |    T/int      |
                ---------------------------------------------------------

             Where:

                                          49                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


           status: 6  bytes  input  by  a  "read  status"  command.   Performed
               periodically by ISIS.
                 byte 0:  SIO (read) Register 0;
                 byte 1:  SIO (read) Register 1;
                 byte 2:  SIO Idle-line counter;
                 byte 3:  SIO checksum-error counter;
                 byte 4-5:  Abort counter and other special bits.
               NOTE::  Bytes 0-1 will contain 0FFFF for nonexistant ports.

           unused: 2 bytes.
           s/int:  status upon interrupt.  If the device interrupts, the status
               input by a Sense Status instruction is placed here at this time.
           T/int:  Time of interrupt.  If the device interrupts, the fast clock
               (FASTC) is copied to these cells.



        4.3.6.2  Force M-board input----OP=10d

             Connects the input side of the specified device.



        4.3.6.3  Force M-board output----OP=11d

             Connects the output side of the specified device.

             Both of these SVC's have the same register usage:

           REG#    contains the logical unit number;
           REG#+1  contains the address of the first command (null  just causes
               reset).






              4.4  Shared Device Control--         SVC     SHARE<4>,ADDR


             For  a variety  of reasons  (such as  common  drivers--required by
        constraints imposed  by the selector  channel, and common  disc areas),
        the DISC drivers and the TAPE driver are treated in a similar manner.

             In particular, requests to  either type of device are  queued, and
        are serviced in turn, by the driver.







                                          50                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983



             ADDR is the address of a parameter block, of form:

                        --------.-------.----------------
                        |O| R/S |  LU   |    status     |
                        |-------------------------------|
                        |              VMA              |
                        |-------------------------------|
                        |             COUNT             |
                        |-------------------------------|
                        |               P               |
                        ---------------------------------

                where:

        O       high  bit  =  execution  overlap...if  off  (0),  dismiss until
                operation complete.

        R/S     operation requested, status of complete operation.


           R:
           0       read
           1       write
           2       attach unit -  make unit available exclusively to  this ISIS
               slot
           3       detach unit - make unit available to other ISIS slots


           S (decimal):
           0       operation completed successfully
           1       bad memory access
           2       no access allowed to this unit
           3       read/write/attach protection failure - access not allowed
           7       error return from unit
           8       error return from controller
           9       operation aborted, by quit character, crash, or halt
           10d     requested byte count 0 or odd
           18d     device unavailable
           19d     attempt to write on write-protected volume
           20d     unit successfully attached, but volume is write protected
           21d     unit attached to another slot, slot number in "status"
           22d     operation ignored for this type of unit
           23d     hardware (controller or ESELCH) timeout

        LU      the local I/O unit to access.

        status  device-dependent status bits returned  on  termination  of  the
                operation.

        VMA     Virtual Memory Address...the address of the first byte  of  the
                the buffer.


                                          51                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


        COUNT   the number of bytes to transfer

        P       position (device dependent)


             The  last three  arguments are  ignored, except  on read  or write
        operations.

             This SVC is illegal if there is no LU assigned with this number.

             The SVC is also  illegal if the parameter-block  address presented
        is non-existant within the requestor's virtual address space.

             There is a "get status" operation which returns  information about
        a slot's  unit.  NOTE INCREASED  PARAMETER BLOCK LENGTH,  compared with
        other  operations!   This  information  is  returned  directly  to  the
        parameter block, and is of format:

                        --------.--------
                        |   0   |  LU   |
                        |---------------|
                        |     status    |
                        |---------------|
                        |  PM   |  GU   |
                        |---------------|
                        |      name     |
                        |---------------|
                        | TYPE  |  DA   |
                        |---------------|
                        |      DBS      |
                        |---------------|
                        |    BLK/TRK    |
                        |---------------|
                        |    TRK/CYL    |
                        |---------------|
                        |    St. CYL    |
                        |---------------|
                        |    no. CYL    |
                        -----------------

                where:

        PM      protection mask:
                bit 0   read access permitted to unit
                    1   write access permitted to unit
                    2   slot can attach/detach unit
                  3-7   reserved

        GU      Global Unit number - used to index system's unit table

        name    two char ASCII device mnemonic - eg, "DK", "MT", "MS"

        TYPE    device type:

                                          52                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


                0       disc
                1       tape
                2       msc-1400 disc

        DA      Device address on I/O bus - eg. 0C6

        DDB     default block size for device;  used when user-supplied "COUNT"
                is zero.

        BLK/TRK number of (default-sized) blocks/track (for discs).

        TRK/CYL number of tracks/cylinder (for discs).

        St. CYL absolute start cylinder (for discs).

        no. CYL number of cylinders in this area (for discs).





                    4.4.1  MSC-1400 Disk I/O

             Additional details:

             Block size = 256 bytes.

           S:

             The first 5 errors indicate no data transfer has occured

           4       virtual block number (P) out of allowed area

             The next 2  errors are due to  bad Kernel tables and  should never
        happen!!

           5       Bad cylinder address
           6       same as 5 but some data tranfer has occured

             The next  error indicates  an error return  from the  device.  The
        device status half-word is placed in the return status.  If there  is a
        system fault, then that information is placed into the  high-order byte
        of VMA.

           8       Error return from the controller - see status

           24d     operation successful, but error recovery performed.







                                          53                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983



           status  status bits returned on termination of the operation:

                --------.-------.-------.--------
                |F|E|A| |U|B|P|   |S| |R|D|B|N|N|
                |A|C|D| |D|S|S|   |E| |D|R|S|R|S|
                |U|C|D| |E|C|C|   |K| |O|F|Y|Y|E|
                ---------------------------------


           bit:
           0   FAU   System Fault...see byte 0 of VMA for clarification;
           1   ECC   ID ECC Error.  indicates  that during a read or  write the
               controller read an ID field that had an ECC error;
           2   ADD   Address Error.  Indicates that during a read or  write the
               controller read an ID field and the address it contained did not
               match  the  specified  target address  (should  be  corrected by
               system);
           3   ---   reserved;
           4   UDE   Uncorrectable data  error.  Indicates  that during  a read
               the controller read a  data field that had an  uncorrectable ECC
               error;
           5   BSC   Bad Sector.   Indicates that  during a  read or  write the
               controller read an ID field that had the bad-sector bit set;
           6   PSC   Protected  sector.   Indicates  that  during  a  write the
               controller read  an ID field  that had the  Protected-Sector bit
               set;
           7,8 ---   reserved;
           9   SEK   Seek Error.  Should be detected and corrected by system;
           10  ---   reserved;
           11  RDO   Read  Only.  Indicates  that  during a  Write,  the target
               drive had the read-only switch set;
           12  DRF   Drive Fault.  Should be detected and corrected by system;
           13  BSY   Busy.  Indicates  that the target  drive is busy  (held by
               another controller) for more than one second.
           14  NRD   Not Ready.  Indicates that the target drive is  not ready.
               This condition can arise when the heads are not loaded, or there
               is a drive fault;
           15  NSL   Not Selected.   Indicates that either  no drives,  or more
               than one drive, responded to the request.
                SYSTEM FAULT (VMA byte 0)...Interpretation as per manual.





                    4.4.2  Tape SVC

             Additional details:





                                          54                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983



                R       operation requested:
                0       read a record - count actually read returned in "COUNT"
                4       backspace one record
                5       skip forward file
                6       skip backward file
                7       write end-of-file
                8       rewind
                9       unload - put tape offline
                0A      get status
                0B      erase gap
                0C      set low density (dual density tapes only)

             S       operation status:

           16d     end-of-file detected during write, read, backspace,  or skip
               operation
           17d     end-of-volume detected during write, read, or skip operation
           19d     write-protected volume
           20d     attach successful, but write-protected volume
           21d     unit already attached
           23d     hardware (ESELCH or Controller) timeout
































                                          55                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983



           status  status bits returned on termination of the operation:

                --------.-------.-------.--------
                |E|E|E|       |D|P|T| |I|H|W|B| |
                |R|O|N|       |U|E|E| |L|I|P|O| |
                |R|F|D|       | |R| | |L| | |T| |
                ---------------------------------

           bit:
           0       read or write data error, or read data overrun:
               if EOF (end-of-file);
               if PER (parity-error);
               if TE (timing-error);
               or if BTE (bad-tape error) detector detects 3 or more characters
                  after  EOR  (end-of-record),  or  a  1-character   record  is
                  detected which is not a tape-mark.
           1       EOF detected during read, write, backspace, or skip
           2       unit is at BOT or EOT
           3-6     reserved
           7       device unavailable
           8       Parity-error detected (read OR write).
           9        Timing error:  CPU failed  to perform  read  transfers with
               sufficient speed,  or failed to  complete read  transfers before
               the end of the read operation, or resumed write  transfers after
               the controller began the end-of-record sequence.
           10      reserved
           11      illegal operation attempted - eg, erase, write or  write EOF
               on write-protected tape
           12      high density  selected (default) -  this bit will  always be
               selected for single-density drive
           13      tape is write-protected
           14      tape is at BOT
           15      reserved

                P       always ignored! - need not be present except for
        "request status"

             This SVC is illegal if there is no tape configured.





                    4.4.3  Disk I/O

             Additional details:

           S:

             The first 5 errors indicate no data tranfer has occured

           4       virtual block number (P) out of allowed area

                                          56                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


             The next 2  errors are due to  bad Kernel tables and  should never
        happen!!

           5       Bad cylinder address
           6       same as 5 but some data tranfer has occured

             The next 2 errors indicate  an error return from the  device.  The
        device status byte is placed in the right byte of the return status

           7       Error return from the disk - eg, disc seek error
           8       Error return from the controller - eg, parity error

           11d     invalid cylinder overflow indication; (this is the half word
               device problem)
           12d     controller error - defective sector in alternate cylinder
           13d     controller error - defective sector; (no alternate cylinders
               left)
           14d     could not read disk map for this disk; (no transfers to this
               disk are permitted)
           15d     controller error - defective sector; (alternate cylinder has
               been  assigned.   all  future  references  to  a  block  in this
               cylinder will be relocated - ALL data on this cylinder  has been
               lost)
           18d     device unavailable
           21d     unit already attached
           22d     request ignored for this type device
           23d     ESELCH timeout



           P        position.   Sector  number (256  bytes  long),  relative to
               beginning of area, at which to start I/O.





                    4.4.4  Disk I/O (Block)        SVC     0E,ADDR

             This is  an obsolete SVC,  included for backward  SUP. capability.
        Each user may have  up to 8 areas on  the disk, numbered 0 to  7.  Each
        area is a fixed integral  number of blocks long.  The number  of blocks
        per area is  determined by the area's  allocation.  ADDR points to  a 3
        word parameter block, of format:

                        ---------------------------------
                        |O     R/S      |     count     |
                        |---------------|---------------|
                        |               |A|     P       |
                        |-------------------------------|
                        |      core start address       |
                        ---------------------------------


                                          57                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983



        R       operation to be performed.  Up to 5 such requests may be made.
                low order bits designate operation:
                0       read
                1       write

        S       Status of operation.  The status is returned in the left-most
                  byte, and in SOME cases there is additional information
                  in the next byte, when appropriate:

                0       no errors encountered...operation successful
                  The first 5 errors indicate no data tranfer has occured
                1       Bad memory access
                2       Bad disk area number
                3       Bad disk area access
                4       Virtual disk address out of area
                  The next 2 errors are due to bad Kernel tables and
                  should never happen!!
                5       Bad cylinder address
                6       same as 5 but some data tranfer has occured
                  The next 2 errors indicate an error return from
                  a device.  The device status byte is placed in the
                  right byte of the return status
                7       Error return from the disk
                8       Error return from the controller
                9       Aborted by quit character
                10d     User requested transfer of zero blocks
                11d     invalid cylinder overflow indication
                        this is the half word device problem
                12d     controller error - defective sector in
                        alternate cylinder
                13d     controller error - defective sector
                        no alternate cylinders left
                14d     could not read disk map for this disk
                        no transfers to this disk are permited
                15d     controller error - defective sector
                        alternate cylinder has been assigned
                        all future references to a block in this
                        cylinder will be relocated - ALL data on this
                        cylinder has been lost

        A       area number.  There may be several areas on the disk available
                  to a single user.

        P       position.  What sector (256 bytes long), relative to beginning
                  of area, to start I/O at.

        number of bytes number of bytes to transfer.

        core start address      address of the start of the core buffer.

             A address is a 3 bit area number.


                                          58                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


             P is a 13 bit block  offset into the area.  block offset  into the
        area.





                    4.4.5  Disk I/O (Sector)       SVC     0F,ADDR

             This   is   an   obsolete  SVC,   included   for   backward   SUP.
        compatibility.  The  description of  SVC 0E applies  exactly to  SVC 0F
        after  substitution  of "sector"  for  all occurances  of  "block".  (A
        sector contains 256 bytes; a block contains 1024.)






                 4.5  Change MAC Set--               SVC     5,MACSET


             The Change MAC  Set SVC selects the  current MAC set.   The second
        operand specifies the MAC set.  The first fullword following the 16 MAC
        registers points to the PSD  used to resume execution after the  SVC is
        issued.  The MAC sets are assembled into the slot's CTA table or may be
        built dynamically using the Replace MAC Set SVC.






                                    4.6  DDT SVC's


             The following SVC's apply only to KIO users, such as DDT users.





                    4.6.1  TTY Input--             SVC     0A,REG:TIME

             REG:TIME are two fields of  one byte each.  REG is the  left byte,
        TIME is the  right byte.  A single  character is read and  deposited in
        the user's  register specified  by REG (low  order 4  bits) and  a skip
        return (^4) is executed.  If the input buffer is empty the user  is put
        to sleep until  a character arrives or  TIME seconds have  elapsed.  If
        the  sleep is  terminated  by a  character  arriving a  skip  return is
        executed, else a non-skip return  is executed.  If the buffer  is empty
        and TIME is zero a non-skip return is executed immediately.


                                          59                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


             (If the KIO:11 SVC is issued, this SVC may return with a skip (^2)
        return if a ZAPPER has been received.)





                    4.6.2  TTY Output--            SVC     0B,ADDR

             A string is sent to the terminal.  The byte at ADDR is a  count of
        how many  subsequent bytes are  to be sent  to the terminal.   The user
        program may be put to sleep by this SVC depending on the length  of the
        output string  and the  condition of the  user's Kernel  output buffer.
        Characters in the  string with hex values  between 0 and  7, inclusive,
        are escaped with a zero for network purposes.





                    4.6.3  KIO--                   SVC     0D,TYPE

             TYPE determines the meaning of this SVC as follows:



        4.6.3.1  SVC     KIO,0    detach circuit

             ZAP circuit and log the user out.



        4.6.3.2  SVC     KIO,1    transfer control

             Transfers control to the command handler (DDT).



        4.6.3.3  SVC     KIO,2    T.I.D.

             Returns low 6 bits of TYMNET terminal i.d. (in R0).



        4.6.3.4  SVC     KIO,3    echo on

             Turns echo on.







                                          60                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


        4.6.3.5  SVC     KIO,4    echo off

             Turns echo off.



        4.6.3.6  SVC     KIO,5    flush outbound circuit

             Emit GOBBLER.



        4.6.3.7  SVC     KIO,6    change context

             Change context (to slot with key specified by R0).

             Change context permits the transfer of a user from one  slot's DDT
        to  another, if  various  criteria are  met.   This SVC  expects  R0 to
        contain a slot key, used to search for the target slot.  If successful,
        transfer is effected to the new slot, and the old is released.   Else a
        diagnostic is issued to the terminal, and:

             Normal  return,  if  there are  NO  slots  available  for transfer
        destination;

             Skip^1 (4) return if no slot is available with the specified key;

             Skip^2  (8)  return,  if  the  requester  does  not  have adequate
        licenses for the destination slot;

             Skip^3  (12d)  return, if  the  requestor username  is  tied  to a
        specific slot, other than the one specified.



        4.6.3.8  SVC     KIO,7    change context (default)

             Change context (to default user-block for name).

             Change context (default) locates the user-assigned slot  (if any),
        and transfers control there.  If no slot is assigned, Skip^3 return.



        4.6.3.9  SVC     KIO,8    check own background

             Checks own background.







                                          61                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


        4.6.3.10  SVC     KIO,9    check any background

             Check any background.

             Check any background expects a slot key in R0.

             Check any/own background searches  the run list for  a back-ground
        job with the  required key.  Normal return  if not found.   Else Skip^1
        return,  then R0  contains the  execution address  of  that back-ground
        slot.



        4.6.3.11  SVC     KIO,10d  output number

             Output number expects register  0 to contain the binary  number to
        output, and register 1 to contain output control information:

          format:   - - -.- - f f.f f f f.s z b r.r r r r


                where:
                -       unused
                f       output field width
                s       signed output
                z       zero field fill
                b       blank field fill
                r       Radix

             The number in  r0 is converted via  the radix in R1,  according to
        the other R1 control parameters, and is output to the controlling TTY.



        4.6.3.12  SVC     KIO,11d  set zap handling

             Set zap handling.

             Set-ZAP-handling  will cause  the input-SVC  to take  a  skip (^2)
        return if a ZAPPER is input.



        4.6.3.13  SVC     KIO,12d  send yellow ball

             Send a "yellow ball".








                                          62                            ISIS-II
        ISIS Kernel SVC's                                      January 24, 1983


        4.6.3.14  SVC     KIO,13d  set trap handling

             Works exactly like "SVC  SYS,0" (Restart syscall), except  that it
        applies  ONLY to  DDT or  KERNEL I/O  processes.  The  ability  to trap
        system faults, provided by this SVC, disappears when the user exits, or
        control returns to DDT.



        4.6.3.15  SVC     KIO,14d  output single data char

             Takes the single data char (right-justified in R0) and  outputs it
        to  the controlling  terminal.  (This  SVC outputs  the character  C as
        though the program had executed a " SVC 0B,ADDR" and "ADDR" was defined
        as:
                                  ADDR    SC      'C'

             the  purpose of  the  SVC is  to  allow the  output  of "computed"
        characters in an easy fashion.)



































                                          63                            ISIS-II
        ISIS DDT Commands                                      January 24, 1983






                                5 -  ISIS DDT Commands


             ISIS DDT is a subset of the KERNEL process on the ENGINE.  One may
        log into  ISIS on  any given ENGINE,  by directing  the log-in  to that
        machine's host 0.

             The  kernel  has a  good-guy  list, used  to  verify  the username
        logging in.  If the  user-name is valid, login may  proceed;  otherwise
        the  user  is  dropped.   If  valid,  the  list  is  checked  for  slot
        assignment.  If no slot is assigned to this user, the kernel asks for a
        slot number.  Once the slot has  a valid slot number, and if  that slot
        is available, the kernel will  connect the user to DDT.  The  user sees
        (USER TYPES, kernel types):

        USER:377;PASSWORD
        slot# :3                (only if no slot is pre-assigned)
        *

             When the "*"  prompt occurs, the user  is connected to  DDT.  Then
        the commands below can be used.

             Each user name in the good-guy list has certain licenses assigned.
        These licenses determine which  classes of slots that name  may access,
        and which set of operations is legal to that name.

             In particular,  certain of these  licences are  "access licenses",
        which permit  access to  certain special slots.   Every valid  user has
        ordinary access to  the normal "application"  slots (slot number  > 0).
        In addition, certain usages have special accesses defined:

           L.DISC  licence to format a disc;
           L.S0A   license to log into slot 0;
           L.SYA   license to log into slot 0FF (the ISIS system);
           L.SUA   license to log into slots associated with the supervisor.

             Having such license permits one to log into that slot, and perform
        certain commands.   Additional license is  required to  perform certain
        other commands, and these depend upon the access licenses:

           L.R     normal read access;
           L.L     normal load  access (permits the  loading and starting  of a
               dead slot);
           L.E     normal execution access (permits the starting and halting of
               a slot);
           L.H      normal halt  access  (permits halting  a slot  in  order to
               reload it);
           L.P     normal patch access (permits patching a running slot);
           L.S0R   slot 0 read access;

                                          64                            ISIS-II
        ISIS DDT Commands                                      January 24, 1983


           L.S0P   slot 0 patch access;
           L.SYR   system read access;
           L.SYP   system patch access.

             In the  following command  description, each  will start  with the
        list of licenses required: "[L.X!L.Y]", where "!" is the logical ".OR."
        function,  and  special  slot requirements  are  assumed  from context;
        [L.R!L.S0R]  automatically  implies  normal (L.R)  and  slot  0 (L.S0R)
        respectively.

             Note that,  generally, if a  command requires Read  licence, Patch
        licence will also satisfy the requirement.

             Note, also, that certain commands require that the slot  be halted
        (disconnected from  the Dispatcher).  These  will be designated  by the
        requirement "L.HALT".






                          5.1  Initialize Address Space::  A


             [ L.HALT ! L.L ! L.H ! L.P ! L.S0P ].

             Set up address space for slot as one large MAC area.

             An  area larger  than  1 segment  is constructed  as  the required
        number of contiguous  segments (e.g., a slot  with 90-K will  result in
        segment  0  of 64-K  and  a segment  1  of 26-K).   No  protections are
        applied.






                           5.2  Set Breakpoint::  B ADDR NUM


             [ L.HALT ! L.L ! L.H ! L.P ! L.S0R ! L.S0P ].

             Set breakpoint NUM at ADDR.   B will undo any old  breakpoint NUM.
        If ADDR is zero B will undo the old breakpoint only.








                                          65                            ISIS-II
        ISIS DDT Commands                                      January 24, 1983


                                5.3  Execute Slot::  E


             [ L.HALT ! L.L ! L.E ! L.H ! L.P ! L.S0P ].

             E connects the  job associated with  a slot  and  starts execution
        independent of DDT.






                                   5.4  Fire-up::  F


             [ L.L ! L.H ! L.P ! L.S0P ! L.SYP ].

             F enables  the "KIO"  jobs associated with  a slot  for subsequent
        logon.






                                   5.5  Go:: G ADDR


             [ L.R ! L.L ! L.H ! L.P ! L.S0R ! L.S0P ! L.SYR ! L.SYP].

             G causes your program to start at ADDR.  It creates a PSW  using a
        half word  in the  user block.   The status  bits may  be changed  by a
        privileged user through the U command.






                                  5.6  Halt Slot::  H


             [ L.E ! L.H ! L.P ! L.S0P ! L.SYP].

             H halts  the job associated  with a slot;  if the slot  controls a
        "KIO" job, subsequent logons are disabled.







                                          66                            ISIS-II
        ISIS DDT Commands                                      January 24, 1983


                                 5.7  Initialize::  I


             [ ].

             I should only be typed after a new load.






             5.8  Load From Disk::  L DISK-ADDR NUMBER-OF-BLOCKS MEM-ADDR


             [ L.L ! L.H ! L.P ! L.S0P ].

             *(* VALID ONLY IF SYSTEM INCLUDES DISK AND SUPERVISOR *)*

             Reads  NUMBER-OF-BLOCKS  (4  blocks/sector)  starting   at  user's
        virtual DISK-ADDR (16  bits, of which the  high 3 are the  area number;
        the rest  are beginning-block  number) storing  the result  starting at
        user's MEM-ADDR.






                     5.9  LL UNIT SECTOR CORE-ADDR NUMBER-OF-BYTES


             Alternate  load memory  from disk.::  [ L.L ! L.H  ! L.P ! L.S0P ]
        *(* VALID  ONLY  IF  SYSTEM  INCLUDES  DISK *)*  Reads  NUMBER-OF-BYTES
        starting at user's virtual  SECTOR on UNIT storing the  result starting
        at user's CORE-ADDR.






                  5.10  Mask for Search::  M MASK START-ADDR END-ADDR


             [ L.R ! L.L ! L.H ! L.P ! L.S0R ! L.S0P ! L.SYR ! L.SYP].

             Set search MASK and range FOR  X AND Y commands.  The MASK  is one
        word (a MASK of 0 translates to -1).

             Also used to set up parameters for the V (spy) command.

             See the commands V, X, and Y for more details.

                                          67                            ISIS-II
        ISIS DDT Commands                                      January 24, 1983


                                    5.11  Next::  N


             [ L.R ! L.L ! L.H ! L.P ! L.S0R ! L.S0P ! L.SYR ! L.SYP].

             Sets a special breakpoint  after the current instruction  and then
        executes the current instruction.






                                  5.12  Proceed::  P


             [ L.R ! L.L ! L.H ! L.P ! L.S0R ! L.S0P ! L.SYR ! L.SYP].

             Must be  used to continue  from a breakpoint.   Restores identical
        status that existed when breakpoint was reached.






                           5.13  Read Memory::  R ADDR COUNT


             [ L.R ! L.L ! L.H ! L.P ! L.S0R ! L.S0P ! L.SYR ! L.SYP].

             Prints contents of COUNT bytes starting at ADDR.






                         5.14  Read Registers::  RR REG COUNT


             [ L.R ! L.L ! L.H ! L.P ! L.S0R ! L.S0P ! L.SYR ! L.SYP].

             Prints contents of COUNT registers starting at REG.  These are the
        register values at the time the last user instruction was executed.









                                          68                            ISIS-II
        ISIS DDT Commands                                      January 24, 1983


          5.15  Save Memory on Disk::  S DISK-ADDR NUMBER-OF-BLOCKS MEM-ADDR


             [ L.L ! L.H ! L.P ! L.S0P ].

             *(* VALID ONLY  IF SYSTEM  INCLUDES DISK AND  SUP, AND  THE GLOBAL
        UNIT DEFINITION INCLUDES THE "SS" ATTRIBUTE *)*

             Has opposite effect of L.






                    5.16  SS UNIT SECTOR CORE-ADDR NUMBER-OF-BYTES


             Alternate  save  memory  on   disk.::  [ L.L ! L.H ! L.P ! L.S0P ]
        *(* VALID ONLY IF SYSTEM INCLUDES DISK, AND THE GLOBAL  UNIT DEFINITION
        INCLUDES THE "SS" ATTRIBUTE *)* Has opposite effect of LL.






                                5.17  Type Old PSD::  T


             [ L.R ! L.L ! L.H ! L.P ! L.S0R ! L.S0P ! L.SYR ! L.SYP].

             Types PSW as it was when last user instruction was  executed.  Two
        additional digits  may be typed  indicating the cause  of the  last MAC
        interrupt.  (This is then the low-order 5 bits of the MAC status -- see
        TYMNET ENGINE document for elaborations.  These latter digits  are then
        cleared, and will not appear until another MAC violation occurs.)






                              5.18  User Status::  U NUM


             [ L.H ! L.P ! L.S0P ! L.SYP].

             Makes NUM (4  bits) the condition code  in the new psw  created by
        all subsequent G commands.If  NUM .and. 1000x is  non-zero, instruction
        trace logic is enabled for subsequent G commands.



                                          69                            ISIS-II
        ISIS DDT Commands                                      January 24, 1983


                                  5.19  Spy::  V ADDR


             [ L.H ! L.P ! L.S0P ! L.SYP ].

             Spy expects that the user has previously issued  a "M CNT FAD LAD"
        command,  which has  specified number-of-bins  (CNT), spy-start-address
        (FAD), and spy-end-address (LAD).  When the "V ADDR" command is issued,
        ADDR specifies the start of  a table--in the user space--of  length CNT
        halfwords ("bins").  It is  assumed that the user has  initialized this
        array in  an appropriate fashion.   (ADDR = 0  causes Spy to  be turned
        off!)

             While spy is  active, interrupts will  exit to special  code which
        compares the address interrupted  from with the specified FAD  and LAD;
        if in range, the address is biased by -FAD, and the position within the
        range LAD-FAD is converted to  a corresponding bin number;  one  (1) is
        added to that bin.

             Spy is turned off on  command, OR if an overflow is  threatened in
        any bin [ 1+ (bin) = 0 (that bin has wrapped around, and counted  up to
        -1 already) ].

             Spy is intended as  a performance monitoring facility,  allowing a
        programmer to determine where  the code is most heavily  exercised.  It
        does have certain restrictions and penalties associated with it:  being
        driven by interrupts, it does impose a fairly heavy load on the system;
        also, the  implementation allows only  ONE slot's DDT  to use Spy  at a
        time.  Appropriate diagnostics  may be issued  for attempts to  use Spy
        incorrectly!

             See the M command for initialization command format.


           Example:

           M B,S,E     B = no. of Bins, S = Start Address, E = End Address.
           V BA        BA = Bin Address (start of Bins).






                       5.20  Write Memory::  W ADDR COUNT string


             [ L.L ! L.H ! L.P ! L.S0P ! L.SYP].

             Reads COUNT bytes from the terminal and deposits them  starting at
        ADDR.



                                          70                            ISIS-II
        ISIS DDT Commands                                      January 24, 1983


                      5.21  Write Register::  WR REG COUNT string


             [ L.L ! L.H ! L.P ! L.S0P ! L.SYP].

             Reads 4*COUNT  bytes from  the terminal and  deposits them  in the
        register save area starting at REG.






                      5.22  Data Search::  X (0,1) (1,2,4) VALUE


             [ L.R ! L.L ! L.H ! L.P ! L.S0R ! L.S0P ! L.SYR ! L.SYP].

             Search: 0  or 1 (match  or non-match), 1,2  or 4 (number  of bytes
        long).  VALUE is one word.  The search range set in M is used  with the
        mask set  in M.  The  mask is  applied only the  memory value,  not the
        search value.  In  a match search only  the addresses of  matched cells
        are printed, in non-match search  both address & value are  printed (on
        seperate lines).

             See the M command for initialization command format.


           Example:  Scan  without printing  (for example,  to look  for parity
               errors):

           M 0FF000,1000
           X 0,2,00FF






              5.23  Instruction Search::  Y (1,2,3) VALUE1 VALUE2 VALUE3


             [ L.R ! L.L ! L.H ! L.P ! L.S0R ! L.S0P ! L.SYR ! L.SYP].

             Search: 1,2  or 3  (length of instruction  in half  words).  Enter
        search value in appropriate number of half words.  Search is match only
        and used search range set in M but not the mask.  Addresses  of matches
        are printed.

             See the M command for initialization command format.




                                          71                            ISIS-II
        ISIS DDT Commands                                      January 24, 1983


                            5.24  Zap Command Circuit::  Z


             [ ].

             Command to log off.  Responds with "Logging off?" to  confirm your
        intentions.  Type Z to log off, anything else to abort log off.






                                        5.25  \


             [ ].

             "\" is  normally used to  recover from an  unrecognizable command.
        It effectively restarts DDT.  Starting (or restarting) DDT includes the
        examination of  a diagnostic  to determine  if any  abnormal conditions
        have occured  since the  last start.   These conditions  include parity
        error,  illegal memory  references, illegal  SVC's, or  KERNEL crashes,
        either  within DDT,  or  within any  of  the domain  controlled  by DDT
        (Background, Foreground, etc.).  "\" may be used instead of any command
        to examine this diagnostic.






                              5.26  Switch Slot::  ^ NUM


             [ ].

             "^"  attempts  to  transfer  control  from  the  DDT  of  the slot
        currently logged into,  to the slot specified  by NUM, if  all criteria
        for logging into that slot are otherwise satisfied.  If not successful,
        diagnostics are generated.













                                          72                            ISIS-II
        ISIS DDT Commands                                      January 24, 1983


                                    5.27  ?command


             "?":: [ ] followed by a command string (with  possible arguments),
        terminated with any delimiter, invokes special commands:





                    5.27.1  ?B        --query Breakpoints

             ?B outputs a table showing where breakpoints are currently set.





                    5.27.2  ?ABS ADDR --query Absolute Address

             ?ABS ADDR  translates ADDR  to a  physical address  (unMAC'ed) and
        outputs this address, and the protection applied to references  to that
        address.





                    5.27.3  ?MAC      --query MAC

             ?MAC  outputs  a  table  that  displays  the  slot's  current  MAC
        configuration.  If  using extended  memory, ?MAC  outputs a  table that
        displays the slot's MAC configuration  for the MAC set selected  by the
        ?SMAC command.





                    5.27.4  ?SMAC n   --(query) Select MAC Set

             ?SMAC selects the slot's  MAC set, when using extended  memory, to
        be used by  DDT, where n  is the MAC set  number.  ?SMAC followed  by a
        <CR> (no argument) selects the internal MAC set.










                                          73                            ISIS-II
        ISIS DDT Commands                                      January 24, 1983


                    5.27.5  ?SLOT     --query SLOT number

             ?SLOT outputs the current slot's key.





                    5.27.6  ?VERN     --query version number

             ?VERN  outputs the  ISIS version  number, followed  by  the slot's
        version (provided that the slot is a DISPATCHER slot).





                    5.27.7  ?BT       --query Background PSD

             ?BT outputs the current (running) background PSD.  Approximate!





                    5.27.8  ?FT       --query Foreground PSD

             ?FT outputs the current (running) foreground PSD.  Approximate!





                    5.27.9  ?BRR R N  --query Background's Read Registers

             ?BRR   outputs   the  current   (running)   background  registers.
        Approximate!   "?BRR"  works like  "RR",  with "R"  being  the starting
        register, and "N" being the number of registers to display.





                    5.27.10  ?FRR R N  --query Foreground's Read Registers

             ?FRR   outputs   the  current   (running)   foreground  registers.
        Approximate!   "?FRR"  works like  "RR",  with "R"  being  the starting
        register, and "N" being the number of registers to display.

             NOTE..."APPROXIMATE" indicates that the multiple-words  output are
        not necessarily correlated.   DDT will "snapshot" each  successive word
        and output it, but may be dismissed after any word is  output, allowing


                                          74                            ISIS-II
        ISIS DDT Commands                                      January 24, 1983


        the  process  being  monitored  to  run,  and  change  the  items being
        examined.  USE THIS FACILITY WITH CAUTION!





                    5.27.11  ?CT       --query Channels Terminating

             ?CT  outputs  a  table  (for  slots  connected  to  DISPATCHER) of
        channels connected to the slot.  Each is of form:
                PORT i -->Sn:j

             where i is the port number on that slot, n is the slot it connects
        to,  and  j  is  the  port number  on  that  slot.   ("i"  and  "j" are
        hexadecimal; n is decimal.)





                    5.27.12  ?USE      --query Dispatcher buffer usage

             ?USE outputs a  table (for slots  connected to DISPATCHER)  of the
        ports currently active, and the maximum (decimal) number  of characters
        that the dispatcher  needed to buffer, because  of full rings,  in each
        direction.





                    5.27.13  ?HOST     --query host

             ?HOST outputs a table  (for slots connected to the  DISPATCHER) of
        hosts in use by that slot.  Each is of form:
                n HOST m HAS j PORTS, IS state

             where n is the relative host  number for that slot, m is  the host
        number, and j is the number of ports.  ("n" is hexadecimal, "m" and "j"
        are decimal.) "state" is one of the possible states:

                gone!
                down!
                shut
                answered








                                          75                            ISIS-II
        ISIS DDT Commands                                      January 24, 1983


                    5.27.14  ?WHO      --query who

             ?WHO outputs a table showing, for each slot, the current status of
        DDT for that slot, and the two most recent user-names to log  into that
        slot, to provide a short history of who has been making changes.





                    5.27.15  ?EDBG     --(query) Enter DeBuG mode

             Turns on debug mode, so that any subsequent system traps cause the
        background and foreground to become frozen, rather than crashing.





                    5.27.16  ?LDBG     --(query) Leave DebuG mode

             Turns off debug mode.





                    5.27.17  ?FREZ     --(query) FREeZe

             Freeze the associated background and foreground jobs.





                    5.27.18  ?THAW     --(query) THAW

             Thaw the associated background and foreground jobs.





                    5.27.19  ?RET      --query return

             If you  have a  user-name assigned  to a  specific slot,  and have
        transfered  to DDT,  ?RET will  take you  back (equivalent  to  the "^"
        command, except that you don't  have to know what slot key  is assigned
        to you).





                                          76                            ISIS-II
        ISIS DDT Commands                                      January 24, 1983


                    5.27.20  ?STAT     --query status

             If you have a Dispatcher-connected job, and it specifies a status-
        address,  control will  be transfered  to that  address, to  permit the
        execution of  code, at the  DDT level, which  will give  diagnostic and
        status information related to the background and foreground job  to the
        person who is logged into the DDT partition.  This may also be used for
        other, more specialized functions, such as for a private debugger, etc.





                    5.27.21  ?LMAC     --(query) Load Mac

             If you have a Dispatcher-connected job,  it's CTA specifies how to
        set up  storage.  The function  of this  command is to  set up  the MAC
        according to this description.  The command is illegal unless  the slot
        is connectable to  the dispatcher.  A  failure exit and  diagnostic may
        result if there is insufficient memory to set up the desired MAC area.





                    5.27.22  ?PORT      --(query) Kernel Ports

             List the users of the kernel ports.





                    5.27.23  ?HANG      --(query) hang Kernel Ports

             Hang the user on the kernel port specified.





                    5.27.24  ?TIME      --(query) system time

             Output  the current  system time  (elapsed time  since  system was
        loaded.









                                          77                            ISIS-II
        ISIS DDT Commands                                      January 24, 1983


                    5.27.25  ?DIAG      --(query) Flush diagnostics

             All diagnostics which have not yet been flushed will be  dumped to
        the terminal controlling the DDT slot.  This happens  AUTOMATICALLY for
        the  console TTY  connected to  DDT for  ANY slot.   Once flushed  to a
        terminal, the diagnostics do not normally come out again.





                    5.27.26  ?HIST      --(query) list ALL system diagnostics

             All diagnostics in the system diagnostic queue, starting  with the
        oldest, are dumped to the terminal making the query.  This will include
        those which have already been  flushed, but does not of itself  cause a
        flush.





                    5.27.27  ?MEM      --query Memory Error Log

             ?MEM outputs  the system  time and a  table displaying  the memory
        error log buffer.  An error  log table is output only if  memory errors
        were detected by the ECC circuitry on the semiconductor  memory boards.
        The table displays how long, in system time, since the  first occurance
        of  the error,  the address  of  the memory  board on  which  the error
        occurred, the number  of occurances of the  error, and the  chip number
        (for single bit errors) or the row number (for double bit errors) where
        the error  occurred on  the board.  Only  the location  of the  last 16
        different memory errors are maintained in the memory error log buffer.

             Other debugger commands  exist but should  not be used.   They and
        their consequences are:





                    5.27.28  ?CPU      --(query) CPU utilization

             A "snapshot" of the fast clock and the appropriate local clocks is
        performed, DDT dismisses for  approximately 1 second, and  now computes
        the  elapsed real  and slot  (virtual) time.   This is  converted  to a
        percentage,  and output.   Further, the  total "span"  used  (number of
        bytes processed, including padding and incorporating "folding")  of the
        Dispatcher  input  and  output  rings  is  output.   Users  with System
        licences will get a table for all slots; users with lesser licence will
        get the information for their slot only!



                                          78                            ISIS-II
        ISIS DDT Commands                                      January 24, 1983


                    5.27.29  ?SYS      --(query) SYStem utilization

             This command MAY be  implemented on certain ISIS systems,  being a
        configuration-defined  parameter.  If  on, the  command  causes certain
        system parameters to  be monitored, and the  values to be  output, with
        titles; the  set of  parameters may vary  with time.   These parameters
        include the elapsed time  for the sample, and may  additionally include
        such elements as the number of context switches during that time, etc.





                    5.27.30  ?LU       --(query) Logical Unit

             This command displays a  list of logical units and  the associated
        physical device type and unit number.





                    5.27.31  ?TRAN     --(query) Transfer Logical Unit

             This  command transfers  a logical  unit (L.U.)  from one  slot to
        another.  This command requires SYS licence.

             To perform a transfer, one must connect to the slot that currently
        pocesses  the  L.U.  to be  transfered.   After  entering  the command,
        successive  prompts  requests  for  the  L.U.,  destination  slot,  and
        destination   L.U.  (all   responses   to  prompts   are   expected  in
        hexadecimal).  The source L.U. must not be null;  the  destination must
        be null.  The  source and destination slot  may be the same.   The slot
        originally in pocession  of the L.U. will  find that I/O is  halted and
        subsequent references to the L.U. (via SVC's) will fail (since it is an
        unasigned unit).






                                 5.28  DDT Filesystem


             The ISIS Dynamic Debugger, DDT, contains the option of simple file
        system which  may be  enabled as following.   When assembling  the ISIS
        Kernel, a  disc unit  should be  allocated and  assigned to  the common
        logical unit for  all slots.  Set the  symbol FSYS equal to  the chosen
        logical unit number, (not the global unit number).  Thus  assembled the
        file system will be operable from DDT commands.



                                          79                            ISIS-II
        ISIS DDT Commands                                      January 24, 1983


             The  commands  usually  require  a 1-8  byte  ascii  name  for the
        filename.   A  filename may  contain  either lower  case,  or uppercase
        characters.  The DDT commands are:





                    5.28.1  ?LIST

             List all files including file size.





                    5.28.2  ?WRIT,FILENAME

             Create and open for write the filename with the chosen  name.  Any
        existing file with this name is deleted.





                    5.28.3  ?READ,FILENAME

             Open for reading the filename with that name.

             All read, and  write opened files  respond to the  appropriate DDT
        commands: R,ADDR,NBYTE, or W,ADDR,NBYTE,B1B2B3 ect., respectively.





                    5.28.4  ?SAVE,FILENAME

             Save  the slot  image on  disc in  the file  with this  name.  Any
        existing file with that name is deleted.





                    5.28.5  ?SSEG,MASK,FILENAME

             Save only the  segments masked by a  one in the hex  halfword MASK
        (ascii coded).





                                          80                            ISIS-II
        ISIS DDT Commands                                      January 24, 1983


                    5.28.6  ?REST,FILENAME

             Restore the  slot image to  core from the  file image in  the file
        with this name.

             ?REST  will  also  set the  segmentation  registers  found  in the
        segment E in the file.  If  segment E does not exist and the  slot does
        not have built in segmentation registers then an error will result.





                    5.28.7  ?DELE,FILENAME

             Deletes specified file.





                    5.28.8  ?NAME,FILENAME,FILENAME

             Renames the first file specified with the second name.





                    5.28.9  ?CLOS

             ?CLOS will close the currently opened file.

             ?CLOS  releases  the  file  system  for  another  DDT  user.  This
        filesystem can only service one user  at a time.  If a request  is made
        while the system is attached to another DDT user, then an error message
        results.





                    5.28.10  ?FORM

             Format disc unit which erases all previous files.



             The  formatting of  the  disc unit  consists of  placing  all disc
        blocks in the FREE  file, which is a  file of unused disc  blocks.  Any
        command which requires a formatted disc( almost all) will automatically
        discover a previous  format on the  unit, or apply  a format as  in the
        ?FORM command.

                                          81                            ISIS-II
        ISIS DDT Commands                                      January 24, 1983


             The file used in the system is a list of headers, with each header
        containing a  list of data  blocks.  The directory  is a linked  set of
        directory blocks.  Each directory block contains a word of link  to the
        next directory block, a word  of directory index which is 16  times the
        number of file entries listed in the block, and finally a list  of file
        entries.  A file entry is a four word record, the first word  being the
        first header block number for  the file, the second word the  number of
        blocks in the file, and finally two words of filename.  Each file has a
        file entry in a directory block, and there is no limit on the number of
        files.  The free  list file is a  special file which contains  lists of
        unused disc block numbers.  The  free list file remains 'open'  all the
        time.  A directory entry has a 8 byte name (unused bytes null), a block
        total field, and a first header number field.  A header contains a link
        to the next header  field, number of entries  field, and a set  of data
        block  list entries.   A  data block  list  entry has  a  user assigned
        address field, number bytes  field, and disc block number  field.  Some
        data blocks in a file will be compressed.  A data block list  entry for
        a compressed block, does not have a data block number field.  Rather it
        has a minus one in the left half of that field, and the compressed byte
        in the  right most byte  of that field.   Compression takes  place when
        writing to a file (?SAVE,  ?WRIT), and is used whenever a  character is
        repeated 0F (hex) times.






                                  5.29  C  don't use!


             "C":: [  ] the  C command is used  to switch  from ASCII  input to
        binary and back again.  It is used primarily by NAD, and use by logging
        in directly may cause strange operations.






                                    5.30  control-C


             A control-C  (03 or 83)  is used to  interrupt a user  program and
        return  control  to DDT.   It  also flushes  all  characters previously
        input.








                                          82                            ISIS-II
        ISIS DDT Commands                                      January 24, 1983


                                    5.31  control-O


             A  control-O (0F  or 8F)  is used  to flush  the input  and output
        buffers.  This also terminates any output SVC in progress.

















































                                          83                            ISIS-II
        NAD-KERNEL COMMUNICATIONS                              January 24, 1983






                            6 -  NAD-KERNEL COMMUNICATIONS


             To communicate with the resident ISIS DDT from NAD, one must first
        establish a circuit via the ;C command.  For example:

        ;C      ISIS:377;

             builds a circuit to DDT on host 377 with user-name ISIS.  ;C types
        3 blanks  and expects a  logon string up  to the first  semicolon (";")
        followed by a carriage return.

             DDT will first validate the  user name, and then will  request the
        user to  enter the  slot number.  Use  the ";R"  command for  this (DDT
        expects a binary number over an auxiliary circuit).

             for example (USER TYPES, typed back):

        ;C   USER:377;
        working
        slot# :;R03     (only if name is not preassigned to a slot)
        *

             The "*" prompt  from DDT shows that  the user is now  connected to
        the slot he specified.

             Any circuit thus built will be zapped if the user executes  the %Q
        command.






                                 6.1  NAD-DDT commands


             Most of the  DDT commands implemented  in ISIS are  implemented in
        NAD with a  similar calling sequence.  The  normal syntax is  a command
        character followed by  an argument string which  has N arguments  and N
        delimiters;  namely, N-1 commas  and one carriage return  the arguments
        can  be  complex  expressions  involving  symbols  defined  during  the
        assembly.

             The ISIS DDT commands B,  G, H, I, K, L, P,  R, S, T, W, X,  Z are
        the  same  in NAD  except  that  the command  character  is  either ":"
        followed by the  character, or a  control character, such  as control-G
        for the Go command.  Other commands are :E or ;E for the E command, :RR


                                          84                            ISIS-II
        NAD-KERNEL COMMUNICATIONS                              January 24, 1983


        or control-E for the RR  command, :WR or control-F for the  WR command,
        :N  or control-Q  for  the N  command and  :M  or control-N  for  the M
        command.

             Using control characters as commands to IDDT has had  some awkward
        side  effects.   Introduction  of line  editing  has  also  caused some
        commands  to be  impossible (^A,  ^Q in  XEXEC; ^U  in PDP).   Any IDDT
        command may now be  entered in the form ":X"  where "X" is the  same as
        would be entered in IDDT directly.  For example, ":N" is Next,  ":M" is
        Mask, ":RR" is Read Register.

             NOTES:

             :R\:RR,:W\:WR - Due  to the fact that  the command syntax  uses no
        separator between the command and the parameters, if a symbol beginning
        with "R" is used as the first parameter, it must be preceeded by  a "+"
        operator.  For example;

        :R+RET,4        reads 4 bytes starting at "RET"
        :RRET,4         reads 4 registers starting at "ET"

             :Z response is :Z.

             :\ is the same as %\.

             aborting  the  :W  command  does  not  require  entering  ;R81C3C1
        ("flush"::"C"::"A") as NAD will do this for you.

             The following commands are different than their  equivalent direct
        IDDT commands:

        :WRreg,val       store "val" in register "reg".

        :Wadr,val        store "val" right adjusted in the 4 bytes
                        starting at "adr".

        padr,vadr,bcnt:W copy "bcnt" bytes from PDP local memory
                        starting at "vadr" to ENGINE memory starting
                        at "padr".

        adr,bcnt:W       same as "adr,adr,bcnt:W".

        param:W          illegal - see note below.

             sym: is NOT an IDDT  command but defines symbol "sym" to  have the
        current position counter value.

             Characters emitted  from the  ENGINE are  typed on  the NAD-user's
        terminal as they arrive.  normally they are sent to the  user's command
        tty in  asc mode.  However,  they can be  split into 2  hex characters.
        The ENGINE  output relay function  will be changed  to hex if  the user
        types  "1;R".  "0;R"  returns  the relay  function to  normal.   Do not


                                          85                            ISIS-II
        NAD-KERNEL COMMUNICATIONS                              January 24, 1983


        confuse this ";R" command,  which has an argument before  the semicolon
        with the ";R" command explained  below that has no argument  before the
        semicolon.

             Typing  errors are  best corrected  with the  "%\"  command.  "%\"
        sends a "\" to the ENGINE.   If you foul up the argument string  to the
        control-R  command,  just  type  a  few  "%\"  commands  until  you are
        satisfied with the feedback you get from the ENGINE.

             The control-W command in NAD take exactly 3 arguments in  the same
        convention as the 3-argument option to the ;7 command.

             Miscellany:

             The control-Z command is confirmed with a control-Z.

             Use control-N for the M command.

             Use ":N" or control-Q for the N command.

             Use control-E for the RR command.

             Use  control-F  for  a write-1-register  command.   first  arg. is
        register number.  Second arg is a new value for that register.

             %C and %O  send control-C and control-O  to the ENGINE as  well as
        clearing the  input that  has arrived  in the  pdp-10 on  the auxiliary
        circuit and clearing the command-out circuit that is flooded.

             There is  a handy ;R  (relay) command in  NAD for  sending general
        info to the  ENGINE (or any  other host) that  the NAD user  has logged
        into via the ;C  command.  The ;R is followed  by a string of  pairs of
        hex digits terminated by  any non-hex character.  Carriage return  is a
        bad terminator to use for this command.

             There is  a less  general "%R" (relay)  command which,  like ";R",
        relays  characters  from  the user's  command  terminal  to  the ENGINE
        program.   "%R" sends  a copy  of the  asc string  following  it.  This
        command is  terminated by  an ESCAPE.  (DANGER,  2 ESCAPES  will likely
        return control to  the DEC monitor  which will terminate  all auxiliary
        circuits.)

             It  takes  AC  (auxiliary  circuit) license  to  be  able  to have
        circuits built  from the PDP-10  to user names  other than that  of the
        command circuit.

             The commands are ;C, ;R, %R, %\, %O, %C, and control- B, E,  G, I,
        L, N, P, R, S, T, U(":U"), X, W, Z.






                                          86                            ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983






                              7 -  ISIS LIBRARY PACKAGES


             For  convenience  in  developing  and  maintaining  interfaces,  a
        collection of library packages have been created.  These are maintained
        in directory ISIS2, and all have the extension "*.LIB".






                         7.1  ISIS Interface Library Packages


             These packages all require that certain parameters be pre-defined.

             The following parameters should be included in all interfaces:

        :       FILE.T0n                the name of this file
        MAXHST  EQ      1               :maximum number of hosts for slot
        MAXPRT  EQ      $A 32           :maximum number of ports for slot
        NTOUT   EQ      5               :number of timeout entries
        IRSIZE  EQ      200             :size of ISIS input ring, bytes
        ORSIZE  EQ      300             :size of ISIS output ring, bytes
        CNTRL   EQ      1               :See first word of CTA area
        MAXCHAR EQ      14              :number of chars to input before break
        ECHO    EQ      1               :set up for tymsat echo
        ENGINE  EQ      1               :set up for tymnet engine

             Additional parameters  may be defined  as needed for  the specific
        interface.  Some of the above  symbols are not needed if  certain *.LIB
        files are not used, but  provide a good first approximation to  the set
        required.





                    7.1.1  START.LIB

             This file should always  be assembled IMMEDIATELY AFTER  the *.T0n
        file.  Among other items, segment usage is initialized.

             The following parameters should be defined in the *.com file:

        MAXHST  maximum number of hosts associated with this interface slot
        MAXPRT  maximum number of ports associated with this interface slot
        NTOUT   number of timeout list entries to generate

                                          87                            ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


        CNTRL   dispatcher control bits
        ENGINE  set to 1 if executing on a Tymnet Engine
        IRSIZE  number of bytes to provide for input ring, from dispatcher
        ORSIZE  number of bytes to provide for output ring, to dispatcher
                (note...IRSIZE and ORSIZE must each be less than 32K!)

                The following MUST be defined SOMEWHERE in the assembly:

        IRING   the start of the input ring, from dispatcher
        ORING   the start of the output ring, to dispatcher
        ENTRY   the location of the first instruction to be executed

                The following symbols are defined for convenience:

        RATE    the rate of the fast clock (ticks/second)
        NRATE   address of a word containing the value RATE
        FASTC   address of a word containing  realtime fast clock
        SLOWC   address of a word containing  realtime slow clock (1-second)
        GMT     address of a word containing GMT clock
        TEMPER  address of a byte containing machine temperature
        VOLTS   address of a byte containing machine voltage
        VERNO   halfword containing ISIS version number
        HOSTX   halfword containing Kernel host number
        NODEX   halfword containing Kernel node number
        SLOTNO  halfword containing slot number
        R0-R15  symbolic names for the registers
        SEGn    the start address of segment n (0-0E)
        HOSTS   halfword array of host numbers as known by the dispatcher (R/O)
        PORTS   halfword array of ports/host as known by dispatcher (R/O)

                The following symbols MAY be defined. defaults used otherwise

        APROTn  protection byte for area n. default area 1 write protected,
                other areas execution protected.
        HOSTn   host number for host position n. default none.
        HPRTn   number of ports for host position n. default none.
        DSTART  user DDT execution start address. default none
        FPANEL  halfword cell for front panel display. default cell allocated
        FRISIS  Bit array for input-allowed (1=allowed). Default array
                allocated
        TOISIS  Bit array for output-allowed (1=allowed). Default array
                allocated
        VERSION version number for slot (default zero)
        REVLEV  revision level for slot code (default zero)
        PCTTBL  bit array for indicating characters terminating project code
                (default none)
        A.DATA  segment number for data area. Default 0
        A.CODE  segment number for code area. Default 1
        A.BDAT  segment number for based data. Default 2.
        A.RING  segment number for rings. Default 2.
        A.BUFF  segment number for buffer(let)s. Default 2.

        In addition, most SVC calls have been assigned symbolic names.

                                          88                            ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


                    7.1.2  TRACE.LIB

             This file  provides the necessary  backbone for using  the TYMNET-
        ENGINE  hardware-trace  feature.  It  should  be  assembled IMMEDIATELY
        AFTER the START.LIB file.  The file may be assembled directly  from the
        library version, in which case it is necessary to patch the appropriate
        test into the assembled  code, OR it may  be copied and the  test hard-
        coded.  Storage is allocated in segments 0 and A.CODE.

             The symbols available are:

               TRACE   A patch area for  code.  There are 144d  bytes of
                       area available.   This patch area  is initialized
                       with  code to  save the  last trapped  address in
                       TRSAVE and resume  the trace.  It may  be patched
                       or  recoded  for  any  other  special  operations
                       required,  such  as  checking  the  state   of  a
                       particular cell.

               TRBGN   Transfer to this location will cause execution to
                       proceed at ENTRY, with trace enabled.

               TRPSD   The last trap PSD saved.  Initialized to transfer
                       to ENTRY, tracing enabled.

               TRSAVE  17d  words  of temp  storage,  available  to save
                       registers, etc.

               IPSD    The PSD loaded by TRBGN.  Initialized to transfer
                       to ENTRY, with trace enabled.

             The  user  should refer  to  the TYMNET  ENGINE  DOCUMENT (source:
        (ISISDOC)ENGINE.DOC) for details of the operation of the trace feature.





                    7.1.3  BID.LIB

             Library package  for BID,  BIDH.  Used  to find  the index  of the
        left-most bit within a bit pattern.  Either routine is called  with bit
        pattern in R1,  link on R3.  Returns  number of the  left-most non-zero
        bit in R2.  R0, R4-R15 are preserved.  Storage is allocated  in segment
        1.

               BIDH    Halfword bit identifier.   CONSTRAINT---left half
                       of R1 must  be zero if  bit 16 is  zero!  Returns
                       original word  in R1, number  of leftmost  bit of
                       right half of R1 in R2.

               BID     FULLWORD bit  identifier.  Returns  original word
                       in R1, number of leftmost non-zero bit in R2.

                                          89                            ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


             Note that  if the  symbol ENGINE is  defined and  .GT. 0  then the
        Tymnet Engine instructions JFFO and JFFOH will be used, respectively.





                    7.1.4  TIMOUT.LIB

             This package contains the standard timeout routines.  These permit
        the near-automatic scheduling of routines, which are to execute at some
        specific  time in  the  future.  Times  are  based on  FASTC,  and thus
        provide  a resolution  of approximately  1.6 milliseconds.   Storage is
        defined in segments 0 and 1.

             The following parameter MUST be defined at assembly time:

               NTOUT   number of timeout entries which may be  active at
                       any one time.

             Six symbols are declared:

               IZT     InitialiZe  Timeout.   Called  at initialization,
                       link  on  R0.    Registers  are   not  preserved.
                       Should be called before any attempts are  made to
                       call TOPUT.

               TIMOUT  Timeout  servicing.  To  be  called periodically,
                       link  on  on  R0.    Will  in  turn  jump  to any
                       routines which  should be serviced  (no registers
                       are preserved):

                        R0 = routine address
                        R1 = current fast-clock time.

               TORET   Timeout  service  return  address.   ALL routines
                       called by TIMOUT should exit to here.

               TOPUT   Timeout   Put-Up-Timeout.    Expects   to     JAL
                       R10,CRASH   if list overflows, crash type is then
                       15d.  Any code may call this to place an entry on
                       timeout list:

                        link on R5...R6--R15 preserved
                        R0 = address to transfer to
                        R1 = next time to call routine

               TOGET   delete  an  existing  timeout  entry.   Called to
                       delete an entry already on timout list:

                        link on R5...R6--R15 preserved
                        R0 = routine address...entry with
                            this address will be deleted.

                                          90                            ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


               TONOW   execute a  timeout entry IMMEDIATELY.   Called to
                       flush an entry, and execute it NOW!

                        link on R5...NO registers preserved!
                        routine address in R0

             NOTE...when a routine is  called from timeout list, it  is removed
        from list, and must call TOPUT to be called again.

             ALSO...TOGET and TONOW both do normal returns, even if no entry is
        found.





                    7.1.5  FRING.LIB

             A  package is  available  for handling  the ISIS  rings.   It does
        require  the  dedication  of  registers R14  or  R15  during  a message
        sequence, but does permit the concurrent manipulation of both input and
        output rings.  It is fast  because the descriptor is maintained  in the
        register, and  thus only the  operand need be  a memory  reference.  It
        also permits one to scan  through an input message, and  then "back-up"
        and restart the scan if some condition is detected.

             The following CONSTRAINTS apply:

             1.   Once  started,  register  14  or  15  is  dedicated  to  that
        operation, until it is "ended".

             2.  If a new operation is started before the previous operation is
        "ended", the previous operation is aborted, and the appropriate ring is
        effectively left unchanged.

             3.  This package now permits simultaneous input and output!

                        R14 is used for input operations;
                        R15 is used for output operations.

             The routines  may be  divided into  utility, primative  input, and
        primative output routines:



        7.1.5.1  Utility Routines

             These are  all called with  link R5, and  expect a pointer  to the
        string in R3.  Registers R6-R13  and R15 are preserved.  Each  of these
        expects  an  argument  in  SC format  (SC  format  consists  of  1 byte
        containing a count of bytes, followed by that number of bytes):



                                          91                            ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


               OCS     Output  Canned  String.  OCS  expects  R2  = port
                       number.   OCS will  output the  string as  a data
                       message to the  specified port.  OCS may  be used
                       to  place a  complete text  message to  the port.
                       OCS goes to  completion, and then  terminates the
                       operation.

               OCM     Output  Canned Message.   OCM expects  R2  = port
                       number.  OCM will output the string as  a message
                       to the  specified port.   The first  character of
                       the string  is passed as  the message  type.  OCM
                       may  be used  for fixed  messages, such  as logon
                       strings,  etc.   OCM  goes  to   completion,  and
                       terminates the operation.

               OBS     Output Byte String.   OBS expects R2 =  number of
                       characters.  OBS will output the specified string
                       into the  current message.  OBS  neither "starts"
                       nor "terminates" the message, but instead  may be
                       used to insert "canned" fragments into  a message
                       being constructed.  The string is NOT expected to
                       be in SC format.



        7.1.5.2  Primative Input Routines

             All link on R4, and pass the argument (if any) in  R0., preserving
        R1-R3, R5-R13, and R15:

               LOOK    Determine  if  an  input  message exists...normal
                       return if not; skip (4) return if so, and then:

                        R1 = port number
                        R2 = message type code (peek)

                       On skip return, condition codes are set such that
                       JE will  succeed if message  is for port  0.  The
                       port  number  will  have  been  removed  from the
                       message, but the message code will not  have been
                       removed (you get a peek at it).

               GETCH   Get a character.

               GETH    Get a halfword.   An even number of  bytes should
                       previously   have  been   removed   for  expected
                       results.

               GETW    Get a word.   An even number of  halfwords should
                       have   been  removed   previously   for  expected
                       results.



                                          92                            ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


               FLUSH   Flush  away remainder  of input  message.   R0 is
                       number of bytes  remaining, to skip  over.  After
                       absorbing these bytes, performs ELIR.

               ELIR    End-Logical-Input-Record.      "Ends"     current
                       message, sets up pointers for next message.



        7.1.5.3  Primative Output Routines

             All link on  R4, primary argument  in R0; preserve  R0-R3, R5-R14,
        unless used for arguments, or otherwise specified:

               ROOM    R0  =  number  of  characters  required  for next
                       message, returns when that much room is available
                       in output ring.  MAY DISMISS.  SMASHES R1.

               SPACE   Returns number  of characters of  space available
                       in output ring.

               SLOR    Start  Logical   Output  Record.    MAY  DISMISS!
                       Provides function of  ROOM,  PUTH, and  PUTCH for
                       first 3 chars of message:

                        R0 = number of bytes required
                        R1 = port #
                        R2 = message type code

               PUTCH   places character in next position of ring.

               PUTH    places  halfword in  next position  of  ring.  An
                       even  number  of bytes  should  have  been output
                       previously in this message.

               PUTW    places word  in next position  of ring.   An even
                       number  of  halfwords  should  have  been  output
                       previously in this message.

               ELODR   End  Logical  Output  Data  Record.   Places byte
                       count  into message  type to  make  data message,
                       then performs ELOR.

               ELOR    End  Logical  Output  Record.    "Ends"  message.
                       Forwards message to DISPATCHER.









                                          93                            ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


                    7.1.6  BUFFER.LIB

             This package contains all  code and storage allocation  needed for
        bufferlet usage.

             If the symbol  BUFTRC is defined and  has a value greater  than 0,
        then a trace of all GCI and WCI calls will be included and HISX will be
        a halfword pointer into a table HISTAB.

               HISTAB  will contain  100 one  word entries.   Each entry
                       contains a one byte character, one byte of buffer
                       number, and a  halfword address of the  caller of
                       GCI/WCI.  The table is circular:

                byte 0          the character
                byte 1          buffer number
                byte 3,4        the halfword address from which the routine
                                        was called.

             The following parameters MUST be defined before assembly:

        NBUF    the number of buffers to create
        NBFLET  the number of bufferlets to create

             A BUFFERLET is an  element in a pool of  data, set up as a  set of
        linked lists.  A  bufferlet is 8  bytes long, and  can contain up  to 6
        bytes of data (the other 2 bytes are used for list linking).

             A BUFFER is  a set of four  half-word descriptors; it  contains no
        data of itself.  It DOES  contain pointers to the data  associated with
        it, in  a pool of  storage associated with  the routines.   Buffers are
        numbered 0, 1, ..., NBUF-1.  Buffers are addressed by buffer index: the
        index for a buffer is twice the number of that buffer.

             Buffer  index may  be used  to index  into the  following halfword
        arrays from external routines:

        BF      buffer flags (see below)
        BB      buffer start address (in bufferlet pool)
        BE      buffer end address (in bufferlet pool)
        BCT     buffer counts

             The  following  should also  be  defined externally  (in  the user
        package):

               FLAGS   a  bit  array  of  length  corresponding  to  the
                       maximum BF (buffer flag) value.

             The  significance  of  FLAGS is  as  follows:   normally,  one has
        several different processes running concurrently (e.g., input, output),
        each  of  which  may  need  to  service  a  collection  of  buffers--in
        particular,  that  set  of  buffers  that  is  non-empty.   Whenever  a


                                          94                            ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


        character is placed  into an empty buffer,  the associated BF  value is
        taken as a (bit) index into  FLAGS, and the assigned bit is  turned on.
        This permits the process to pick up one of it's flag words,  and detect
        if it has anything to do.  (If  so, it can use BID to determine  one of
        the  bits,  and  then  service  the  associated  buffer.)  The  bit  is
        automatically turned off  when the last  character is removed  from the
        buffer.

             NOTE...it is up  to the user program  to initialize the  BF array,
        and thereby force the partitioning of the FLAGS array.

             There are several routines available.  Each routine is called with
        (unless otherwise specified):

                        Link on R4
                        R0 = argument
                        R1 = buffer index (buffer number*2)

             Routines:

               IZBF    link on R5, used to initialize buffers.

               GCI     get a character from buffer.

               WCI     write a character into buffer.

               WCD     back up a buffer to restore last character.

               EMPTY   empty (flush) buffer.

             The package uses routines  in TIMOUT.LIB --- requires  one timeout
        list entry.

             The bufferlet pool is divided  into two parts: the main  pool, and
        the reserve tank.  (The reserve tank normally contains 1/8 of the total
        number of bufferlets.)  If the main pool  is ever emptied,  the reserve
        tank is transfered to  it.  At some later  time, an attempt is  made to
        restore the reserve tank, zapping one or more buffers as necessary.  If
        this happens, a diagnostic will be sent to the supervisor,  advising of
        the  buffer  zap.   This  condition  is  abnormal,  and  caused   by  a
        malfunctioning program,  or by a  misallocation of bufferlets  (too few
        for the application).

             If the macro ZAPBUF is defined then the code in the macro  will be
        executed whenever  CKBZ is  forced to zap  a buffer.  The code  will be
        executed immediately following the  call to EMPTY (R1 will  contain the
        buffer index).  The first line of the macro must be "ZAPBUF  MACRO [.X"
        (where X may be a carriage return or semicolon).






                                          95                            ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


                    7.1.7  BBFLET.LIB

             This package contains all  code and storage allocation  needed for
        dynamic allocation  of big bufferlets.   It contains no  routines which
        manage data in big bufferlets.  Such routines are left to be written by
        the user.

             This  is the  two level  re-entrant version  (all routines  can be
        called by both foreground and background).

             The following parameters MUST be defined before assembly:

               NBBFLT   the number of big bufferlets to create.   Two of
                       them will "never" be allocated, to avoid possible
                       race conditions and unraveling of the  free list.
                       This can't  be counted on,  however, since  it is
                       possible  for  one  of  the  unusable  2  to  get
                       allocated if things  are timed in just  the right
                       order.

               BBFLSZ  the size (in bytes)  of a big bufferlet,  MUST be
                       even.

             If more than  one segment (64K)  of bufferlets are  being defined,
        the symbol  FWBBF must  be globally defined  and set  to 1.   This will
        cause all bufferlet pointers to be a fullword.  All external references
        to the bufferlet pointers must reflect this.

             The following parameters are defined for the user:

               BBUFER  base address of big bufferlet storage area.

               BBFPSZ  The size in bytes of a bufferlet pointer.

             The following external routines are used:

               CRASH   JAL    R10,CRASH   performed    if   catastrophic
                       theoretically impossible conditions occur.

             The big  bufferlets are  kept in  a double  linked free  list from
        which they are allocated  when needed.  The pointers used  are relative
        to BBUFER.

             The package contains both utility and primitive  routines (utility
        routines are called with link on R5, with R2, R6, and R7 volatile):

               PBBC    Put Big Bufferlet Chain.  R3 = pointer to 1st big
                       bufferlet in chain.  PBBC will return a  chain of
                       big bufferlets to the dynamic pool.

             Primitive routines are called with link on R4, with R2, R6, and R7
        volatile:


                                          96                            ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


               IZBB    Initialize   Big  Bufferlets.    Initializes  big
                       bufferlet double linked list used  to dynamically
                       allocate big bufferlets.

               GBB     Get Big Bufferlet.

                        Return          -No Big Bufferlet is available.
                        Skip return     -R3 has pointer to big bufferlet,
                                         chain half-word in big bufferlet
                                         set to zero.

               PBB     Put  Big  Bufferlet.   R3  has  pointer   to  big
                       bufferlet to return to dynamic pool.

             Debugging modes (active if symbol defined as a positive number):

               BBF.D1  Count GBB and RBB calls in global  cell 'BUFCNT'.
                       When all bufferlets put back, BUFCNT=0.  Crash if
                       BUFCNT<0.

               BBF.D2  Software  crash when  no bufferlets  available on
                       GBB call.

               BBF.D3  On all returns of  BB to chain, check  BB address
                       range.

               BBF.D4  On all  gets and  puts to  the bufferlet  pool an
                       indicator is  set to indicate  the status  of the
                       bufferlet.  If a bufferlet in use is reused or an
                       unused bufferlet is released it will crash.





                    7.1.8  CRASH.LIB

             This is a generalized crash package.  It handles both software and
        hardware crashes.  On any crash, the registers are saved in  CRREG, and
        CRSHCT is incremented.  Software crashes occur via:
                                    JAL R10,CRASH.

             CRASH saves (R10) in cell  CPOINT.

             Software crashes may be  "good" or "bad"...if "good",  the calling
        sequence is:

                JAL     R10,CRASH
                HC      0               :this key distinguishes a "good"
                                        :crash from bad
                BC      4*L,Y           :first byte is 4*register linked
                                        :to routine, Y is crash type


                                          97                            ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


             Then register (L) is saved in CFROM, and Y is saved in CRASHC.

             In  the  event  of   a  hardware  failure,  CPOINT   contains  the
        instruction address at the time of failure, CRASHC contains the failure
        reason, and CFROM is set =-1.

             On completion of crash,  transfers to label START, defined  in the
        user code.

             If the symbol CRSTOP is defined, and set .GT. 0, then this routine
        will permit only  one crash (except  power failure or  manual restart).
        When  this  routine executed  the  second time  the  registers  will be
        restored from CRREG and the slot will be HALTED.





                    7.1.9  FRONT.LIB

             This  package is  the ISIS  front end...used  to service  the ISIS
        input and  output rings,  and to  activate user  code whenever  a break
        (user defined) is encountered.

             It also  activates user  code when  a user-processable  (also user
        defined) non-data  message is encountered,  if excessive data  is input
        without a break, or if a timeout occurs for a port.



        7.1.9.1  Conventions

             Each of NPORT  ports has a  buffer-pair associated with  it.  Even
        numbered  buffers are  input buffers...the  corresponding  odd numbered
        buffer is  that port's  output buffer.   The user-provided  code should
        initialize these buffers.

             A 0-byte in the buffer is an escape...it is followed by  a data-0,
        or  by  an  ISIS  message code  and  the  appropriate  character stream
        following.  (This  does NOT apply  to needles [message  code =  0], and
        thus unassigned  ports should be  connected to an  appropriate process.
        Needles  are  parsed, and  the  following usage  applies  on activation
        <Needles ALWAYS activate>:

                        R5      Invoice number,
                        R6      Destination Host number,
                        R7      Originating Node number,
                        R8      Originating Port number,
                        R9      TID,
                        R10     number of characters in user name (the
                                username is placed into the port's buffer.)

             Data breaks on C/R if no break array is specified.

                                          98                            ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


             Activation always occurs at the END of the message  which contains
        one or more breaks.

             Break is activated with the buffer index in R1, and links  on R15.
        All registers  are available  for use while  in the  user code,  and on
        return, R0 is to contain a number N.  If N>0, it is default timeout (in
        seconds)  until the  next activation...else  timeout is  disabled.  All
        data characters are  automatically placed in  the input buffer,  as are
        any control messages specified for user-handling.

             ALL ISIS special messages are placed in the buffer for port 0, and
        each breaks automatically.

             For non-text messages, the  escape convention applies ONLY  to the
        message type...the body of the message is unescaped.  ALL such messages
        handled by the user cause a break.

             The  following WORD  arrays (length  NPORT words),  and are  to be
        initialized by the user program:

               BREAK   a pointer to the bit array of characters to break
                       upon.

               MBREAK  a pointer  to the bit  array of message  types to
                       break on.

               PROCESS a pointer to the  process to be activated  upon a
                       break condition.

             The following items are to be provided by the user:

               A bit array TISIS of length NPORT, to signal output data.

               A  symbol  MAXCHAR...causes  break  if  the  buffer count
                       exceeds this value.

               A symbol  ECHO...causes tymsat  echoing for  terminals if
                       >0.

             The following routines should be called by the user (link R0):

               IZFRONT at initialization time, after calling IZT.

               INPUT   from exec loop, to process input from ISIS.

               OUTPUT  from exec loop, to process output to ISIS.








                                          99                            ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


                    7.1.10  FRNTND.LIB

             This package is an ISIS Front End interface to Tymnet. It  is used
        to service the ISIS input  ring, and to activate user  defined routines
        whenever a  message is found  for a port.   The package is  designed to
        permit  the activation  routines to  be defined  on an  individual port
        basis if desired. It is also designed so that context within  a process
        can  be  indicated  by  dynamically  changing  to  a  different  set of
        activation routines.

                                      Conventions

             The following symbols are to be provided by the user:

               ECHO    if TRUE causes Tymsat echoing for terminals.

               AUTOBP  if TRUE causes automatic backpressure application
                       and  release  for  a  port  based  upon comparing
                       number of characters in input buffer and MAXCHAR.

               PTIMEO  if TRUE port timeouts are available.

               MAXCHAR maximum number  of characters  in a  port's input
                       buffer before backpressure should be applied.

             The following symbol is to be initialized by the user:

               PECHO   a bit for each port. If set then echoing  will be
                       honored for the port, otherwise defered echo mode
                       will not be honored.

             The  following  symbols  may  be  provided  by  the  user  (If not
        provided, default values will be used):

               CRIPOM  crash code for invalid port zero message (default
                       20x).

               CRNAR   crash  code  for  no  activation   routine  found
                       (default 21x).

               CRINVN  crash code  for invalid needle  received (default
                       22x).

               CRINVM  crash code for invalid message  received (default
                       23x).

             The following data structures  are to be provided  and initialized
        by the user (They may be located in any segment):

               DCB     Device  Control  Block,  a  data  structure which
                       contains all the context information for  a port.
                       There should be  NPORT DCB's defined  starting at


                                          100                           ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


                       address  DCBLKS.  Within each  DCB  the following
                       offsets must be defined:

                        DCBICC  input character count (halfword)
                        ACTIVD  relative address in A.CODE of data
                                activation routine.
                        ACTIVC  relative address in A.CODE of a table of
                                halfword offsets in A.CODE of routines
                                for each possible control message.
                        ACTIVT  relative address in A.CODE of timeout
                                activation routine.
                        ACTIVO  relative address in A.CODE of output
                                activation routine.

               PORTAB  Port Table,  a halfword array  containing entries
                       for each port which are the relative  offset from
                       DCBLKS of the DCB for the port.

             In addition,  activation routines  must be  defined for  port zero
        messages (ACITV0) to for  needles (ACITVN). These labels should  be the
        location of the actual routine not offsets in A.CODE.

             Whenever a data or  control message activation routine  is called,
        the following registers are set up:

                R1      port number
                R2      message type
                R5      link register
                R12     DCB pointer
                R14     input ring pointer

             The  activation routines  are responsible  for extracting  all the
        message data for the current logical record from the input  ring.  Upon
        return,  this  package   willend  the  logical  input   record  (ELIR).
        Therefore R14  must be  pointing to the  end of  the message  when this
        package regains control. All other registers may be smashed.

             Needles are handled differently. The are parsed and  the following
        registers loaded.

                        R1      port number
                        R2      number of characters in username
                        R5      link register
                        R6      invoice number
                        R7      destination host number
                        R8      originating node number
                        R9      originating host number
                        R10     originating port number
                        R11     dialect code
                        R13     TID
                        R14     input ring pointer



                                          101                           ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


             Upon  a  needle activation,  everything  up to  and  including the
        username  length will  have been  extracted from  the input  ring.  The
        ACTIVN routine is responsible for extracting the username.

             If  PTIMEO  is true  then  a normal  return  from  any activate'ed
        process indicates  that the  timeout state  of the  port should  not be
        modified. If a skip return is taken, then R0 will be examined. If R0 is
        non-zero, a timeout for that many seconds will be set for the  port. If
        R0  is zero  then any  timeout for  the port  will be  cleared.  When a
        timeout expires for a port the timeout activation routine for  the port
        will be called with the following registers set up:

                        R1      port number
                        R5      link register
                        R12     DCB pointer

             Upon  return  from  the  timeout  activation  routine,   the  same
        skip/normal return convention is followed.

             The user may also set or clear a timeout for a port directly.  The
        routines SETTO and CLRTO are used to set or clear a timeout for  a port
        respectively. They are used when a timeout is to be set (or cleared) at
        a time other than a the return from an activation. The  routines should
        be  called with  R1 =  port number.   For SETTO  R0 should  contain the
        interval, in seconds, until the timeout activation routine for  the DCB
        in activated.

             The output routine searches for any ports requiring output service
        which are not backpressured. For each such port, the  output activation
        routine found in  the port's DCB will  be activated with  the following
        registers set up:

                R1      port number
                R5      link register
                R12     DCB pointer

             Upon  return  from   the  output  activation  routine,   the  same
        skip/normal return convention for timeouts is followed.

             The following routines are to be called by the user (link R0).

               IZFRNT  at initialization time, after calling IZT.

               INPUT   from EXEC loop, to process input from ISIS.

               OUTPUT  from EXEC loop, to process output requests.

             In order to facilitate  setting up the control  message activation
        routine table some symbols, routines, and macros have been defined.

             The following symbols have  the values of the offsets  from A.CODE
        of a number of control message processing routines:


                                          102                           ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


                Symbol  Routine Description

                XTOSS   TOSS    tosses the message
                XZAP    ZAP     handles zapper
                XNOSEND NOSEND  handles backpressure
                XRESEND RESEND  handles release backpressure
                XGOBBLE GOBBLE  handles gobbler
                XFLBACK FLBACK  handles flush backward
                XEDEM   EDEM    handles enter defered echo mode
                XLDEM   LDEM    handles leave defered echo mode
                XGB     GB      handles green ball
                XRB     RB      handles red ball
                XOB     OB      handles orange or black ball
                XPNEED  PNEED   handles either pseudo needle
                XXLIM   XLIM    handle xmit limit
                XINVAL  INVAL   crashes with invalid message code

             The following macros are used to set up the tables:

               HTABVT  with argument  table name is  used to set  up the
                       process  table  for  a  typical  virtual terminal
                       port.

               HTABIA  with argument  table name is  used to set  set up
                       the process table for an inactive port.

               CHGTAB  with  arguments  table  name,  msg   number,  and
                       routine label is used to substitute for a default
                       process routine in the table.

             Example -- To set up the control message activation  routine table
        for a  virtual terminal handler  which must call  a routine  to release
        resources (RELRSC) upon losing the circuit on a port the following code
        might be used.

                        SEG     A.CODE
                        MO      .,FRNTND

                        HTABVT(VTAB)            :GENERATE DEFAULT TABLE
                        CHGTAB(VTAB,9E,RELRSR)  :CHANGE ZAPPER HANDLER
                RELRSC  ------                  :CODE TO CLEAN UP AND RELEASE
                        ------                  :RESOURCES USED BY PORT
                        J       ZAP             :JUMP TO ZAP PROCESSOR TO CLEAN
                                                :UP ITS TABLES
                        EM
                        END

             It should be  noted that the above  code is in the  module FRNTND.
        This is the Input Handler module. The preceeding symbols,  routines and
        macros are not global'ed so the code must be in the same module  or the
        symbols  LOCAL'ed.   It should  also  be noted  that  the  user defined
        processing  routines  should jump  to  the default  process  routine or
        perform similar processing on the input ring and status indicators.

                                          103                           ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


                    7.1.11  ARING.LIB

             For convenience  in handling ASYNC  I/O, this package  is provided
        with  a set  of routines  to  get and  place characters  for  the async
        driver,  performing all  required bookkeeping  on the  appropriate port
        ring's pointers.

             The following parameter MUST be defined before assembly:

               NAPORT  number of async ports.

             The following quantities are defined by the package:

               NGRP    number  of groups  (16 ports  each)  required for
                       NAPORT ports.

               RBS     number of bytes in a port's ring entry.

               ARING   the start address of the async ring storage.

               DSR     NGRP-halfword bit array for DSR term.

               DTR     NGRP-halfword bit array for DTR term.

               CP      NGRP-halfword bit array for CP term.

               TAM     NGRP-halfword  bit array  for  Transmitter Active
                       Mask.

               TOPORT  NGRP-halfword bit array, set if data  present for
                       port.

               FPORT   NGRP-halfword  bit  array,  set  if  data present
                       coming from port.

             The following routines are included.  All link on R4,  expect port
        number in R5 (unless otherwise specified):

               IZASYN  Initialize   ASYNC   handling.     preserves   NO
                       registers.  on return, has set:

                        DSR     0
                        DTR     1
                        CP      0
                        TAM     1
                        TOPORT  0
                        FPORT   0
                        ARING   0

               AGCI    get a character  from Async input ring.   If that
                       ring is  empty, performs  a normal  return (turns
                       off FPORT bit).  Else skip (4)  return, character
                       in R0.

                                          104                           ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


               AWCI    Place a single char in Async output ring.   R0 is
                       char to transmit.   If less than 4  characters of
                       space remain in ring after placing character, TAM
                       is turned off.  TOPORT bit is always turned on.

               AWCP    Place escaped char  in Async output ring.   R0 is
                       char to transmit.  Places escaped  character PAIR
                       into output ring, then acts like AWCI.

             AWCI and AWCP turn off  TAM sufficiently early that a  program may
        place another character or character pair into the ring  before running
        into trouble.  This insures  that a sequence of several  characters may
        be placed without the necessity of implicitly checking if there is room
        available, or of "backing-up" in a ring (dangerous, since the driver is
        executing concurrently).

             The  following  conventions   apply  to  input  and   output  data
        characters:

                INPUT CODES

        0       escape...always followed by second char
        1-FF    data codes 0-FF
        0|0     escaped data code 0
        0|8x    escaped terminal speed:
                x=0     10 cps
                x=1     15 cps
                x=2     30 cps
                x=3     40 cps
                x=4     60 cps
                x=5     120 cps
                x=6     30 cps (3767)
                x=7     14.7 cps (2741)
        0|90    escaped break detected
        0|91    escaped break end

                OUTPUT CODES

        0       escape...always followed by second char
        1-FF    data code
        0|0     data 0
        0|1-8F  delay time
        0|90-AF output baud rate
        0|B0-CF input baud rate
        0|D0-DF enter connect mode
        0|E0    enter data mode
        0|E1    disconnect
        0|E2    enable
        0|E3    RS up
        0|E4    RS down




                                          105                           ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


                    7.1.12  FINISH.LIB

             This  file  should  ALWAYS  be  assembled  LAST!!    It  generates
        diagnostics if necessary, and computes the value of the symbols SnSIZE,
        where n is the segment number (0 - E).

             The CTA table  is created including  the HOSTS, PORTS,  and PTABLE
        arrays. Values are assigned to the symbols CTA and CTASIZE.

             It  will also  type  out the  memory requirements,  and  cause all
        undefined symbols to be listed on the control terminal.






                                 7.2  Utility Routines


             There are several utility routines, capable of providing commonly-
        used functions.





                    7.2.1  OUTNUM.LIB

             This  package provides  a mechanism  to convert  a  binary number,
        according to  any radix  R (1  < R  < 17d),  and place  the appropriate
        string of digits and  other characters into the specified  user buffer.
        The  calling sequence  specifies  parameters such  as:   Signed number;
        Blank or zero fill;  and Field width.  Storage is allocated in segments
        A.DATA and A.CODE.

             The symbols available are:

               OUTNUM  Subroutine to convert  a binary number  and place
                       the  corresponding  character  string   into  the
                       specified buffer.  Conventions:













                                          106                           ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


                R0      control information...format:

                            - - -.- - f f.f f f f.s z b r.r r r r

                      where:
                          -     unused
                          f     output field width
                          s     signed output
                          z     zero field fill
                          b     blank field fill
                          r     Radix
                R1      pointer to buffer area
                R2      binary number to be output
                R6      link register
                R3-R5   internal scratch registers

             NOTES:  If the output number  is too big for the field,  the field
        is generated with the leading character ">", to indicate the condition.

             If  both blank-fill  and zero-fill  are specified,  zero-fill will
        override.

             If neither  blank- nor  zero-fill are  specified, exactly  as many
        characters as required  will be placed  in the buffer  (variable length
        specification).

             R1 is always returned pointing at the next character of the buffer
        to be filled.





                    7.2.2  CONVRT.LIB

             This package provides  a mechanism to  convert a binary  number to
        either a decimal or a  hexidecimal, signed string of characters  in the
        users buffer.  Storage is allocated in segments A.DATA and A.CODE.

             The routines are:

               BINDEC  Subroutine to convert a binary number to decimal.

               BINHEX  Subroutine   to  convert   a  binary   number  to
                       hexidecimal.

             Both routines have the register conventions:

                R4      Link register.
                R9      the binary number.
                R10     number of digits to output.
                R11     pointer to the output area.


                                          107                           ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


                    7.2.3  DATIME.LIB

             This  package  provides  a  set  of  routines  to  manipulate  GMT
        (Greenwich Mean  Time).  Storage  is allocated  in segments  A.DATA and
        A.CODE.

             The routines are:

               DATIME  Subroutine to convert  the GMT clock  relative to
                       1/1/74, from seconds  to DDMMMYY HH:MM  (GMT), or
                       DDMMMYY HH:MM:SS (GMT).  Register usage:

                        R3      No. of second since 1/1/74 (beyond 1/1/76)
                        R4      No. of characters of output (13d or 16d)
                        R5      Address of output string
                        R6      Link register.


               TMSTMP  Subroutine to  convert the  fullword GMT  time of
                       day to HH:MM or HH:MM:SS.  Register usage:

                        R3      Fullword time of day (GMT clock)
                        R4      No. of characters to output (5 or 8)
                        R5      Address of output string
                        R6      Link register.


               DATE    Subroutine to  convert the  fullword GMT  time of
                       day to a fullword representation of the  date and
                       time.   The  format of  the  result  is MMDDHHMM,
                       where MM,  DD, HH, and  MM represent  Month, Day,
                       Hour, and Minute, respectively -- all  in decimal
                       format.   I.e.  DEC  12 13:41  would  be 12121341
                       (hex).

                        R3      GMT Clock Value
                        R5      Link register
                        R6      Value returned.

             If  the  symbol TIMEZON  is  defined it  should  be  the time-zone
        correction factor from CUT  (Coordinated Universal Time).  I.e.  PST is
        -8.

             NOTE...This package uses CONVRT.LIB.










                                          108                           ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


                    7.2.4  STATUS.LIB - User Command Handler

             The Status  package is  intended to provide  an extension  to DDT,
        invocable via the "?STAT" command in DDT.  Once "?STAT" is typed at DDT
        level, the prompt ":"  appears, and additional commands may  be defined
        as slot-specific extensions to DDT.  In particular, since no licence is
        required  to  execute  "?STAT", the  unprivileged  user  may  use these
        extensions for a variety of status information.

             It  is  recommended  that all  applications  include  the commands
        "HELP" (to inform  the user of the  menu of operations he  can perform)
        and "CODE" (to type out a brief description of this process).

             There  is limited  editing control  built into  the  package ("^W"
        means Control-W):

                ESC     aborts back to command level,
                ^W      discards partial token already input (word or number),
                ^A      discards last char of token (backspace).

             Delimiters  may  occur  in  multiple (e.g.  ",  "  is  OK).  Valid
        delimiters are:
                C/R     L/F     H/T     ","     and BLANK.

             The entry points and routines are:

               DSTART  Place to exit on completion of  command.  Outputs
                       ": " and accepts new command token.

               DS.ILL  Place  to  exit  on  illegal  command   --  types
                       'Illegal command'.

               DS.ERR  Place to  exit on command  error -- types  " type
                       '\'".  Then examines all input, looking  for '\';
                       when successful, exits to DSTART.

               DS.EXI  Place to exit machine.

               DS.QUI  Place to exit back to DDT.

               DS.GCH  Get a  character...Link on  R1, char  (with high-
                       order  bit  forced)  in  R0...normal   return  if
                       detected ^W, skip-4 if detect ^A, aborts  back to
                       DSTART if detects ESC.

               DS.DEL  Check  for   delimiter...Link  on  R2,   char  in
                       R0...normal  return if  delimiter  detected, else
                       skip-4 return.

               DS.CUC  Convert to upper case.  Link on R1,  Character in
                       R0.



                                          109                           ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


               DS.TOK  Get a string  token.  Link on R4,  TOKEN returned
                       in R3.  Inputs  up to 4 characters,  returns them
                       (in uppercase) left justified, with 0 fill.

               DS.NUM  Get a number.  Link  on R5, expects Radix  in R4.
                       Number  returned  in   R0.   May  ABORT   if  any
                       character  is  input other  than  valid  digit or
                       delimiter.

             There are two built-in commands:

        Q or QUIT       exit back to DDT.
        EXI or EXIT     exit machine.

             Additional commands may be defined via the DS.CMD macro:

                                   DS.CMD(TEXT,ADDR)

                Where:
                TEXT    The (UPPERCASE) target command string.
                ADDR    The virtual address to transfer to, to service that
                command.

             DS.CMD generates  a 12-byte  discriptor for  this command,  at the
        point  assembly where  it is  invoked.  This  discriptor is  on  a WORD
        boundary.





                    7.2.5  DARRAY.LIB

             This package provides a pair of routines to display  logical half-
        word (unsigned  16-bit elements)  arrays on  the DDT  control terminal.
        They are intended to  provide the commonly-used function  of displaying
        arrays of statistical data collected by user-supplied processes.

             Storage is allocated in segment A.CODE.

             Various arguments are in the form of pointers to "descriptors", of
        format:

                DISCR   WC      START
                        HC      SVCDSC
                        HC      NUMBER

                Where:

               DISCR - The start value (or pointer).

               SVCDSC - Print  discriptor  (as  per   SVC  SYS<0D>,14d).


                                          110                           ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


                       Flexability is provided by requiring the  user to
                       specify  this  discriptor;  this  precludes fixed
                       assignment  of  radix,  field-width,   and  other
                       special properties which  the user might  want to
                       select.  (Note  -- the value  62A generates  a 6-
                       character   unsigned   decimal   number,   right-
                       justified   with   blank-fill.    This   will  be
                       convenient for many purposes.)

               NUMBER - Either increment Or number of elements.

             One kind of descriptor  required is a "label" descriptor,  used to
        label each line printed (no label will be printed if SVCDSC =  0).  For
        this descriptor, the first  descriptor word (START) contains  the value
        used to label the first  line;  NUMBER is used to increment  this value
        for successive lines.

             The second  kind of descriptor  is the "array"  descriptor;  here,
        START is a  pointer to the  beginning of the  array, and NUMBER  is the
        number of array elements (half-words).

             The routines are:

               LIST    Subroutine to display  a half-word array  in text
                       form.  Register usage:

                        R0-R4 - Scratch registers
                        R5 -    Label-descriptor pointer
                        R6 -    Array-descriptor pointer
                        R7 -    Link register
                                all other registers preserved.


               PROFIL  Subroutine to  display a  half-word array  in the
                       form of a  histogram.  The histogram  consists of
                       one  line  for  each array  element  -  each line
                       consists  of  a  Label,  followed  by  a  line of
                       asterisks   ("*"),   the  length   of   which  is
                       proportional (scaled) to the element  value.  The
                       histogram may be Full (all elements displayed) or
                       Truncated  (multiple  zero-elements  suppressed).
                       Register usage:

                        R0-R6 - destroyed (scratch registers)
                        R6 -    Scaling Factor
                        R7 -    Label-descriptor pointer
                        R8 -    Array-descriptor pointer
                        R9 -    Mode (Full or Truncated) flag
                        R10 -   Link register.
                                all other registers preserved.

                where:


                                          111                           ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


               Scale   The  maximum  value  for  a  full-line  histogram
                       element;  Used  to compute the  scale-factor used
                       to fix the  line-length for each line  printed --
                       default is one "event" per column (if SCALE=0).

               Mode    Truncated  histogram   if  negative,   else  Full
                       histogram.

               NOTE    The SVCDSC field  of the Array descriptor  is not
                       referenced.






                                7.3  Development Tools


             The following set of library packages are intended for use  in the
        development of applications,  rather than for permanent  inclusion into
        those applications.  Thus, they  fall into the catagory  of development
        tools!





                    7.3.1  INSTAT.LIB

             This  package  is  controlled  by  ?STAT  commands,  and  collects
        statistics on the  ISIS-Dispatcher input-ring traffic.   It's operation
        is completely transparent to the application, except for the extra load
        imposed upon the machine by it's use.

             However, transparancy is provided by imposing certain restrictions
        upon the sequence of library references used to create the application:
        INSTAT.LIB  must be assembled before FRING.LIB!!

             INSTAT    requires    STATUS.LIB,    and    also     calls    upon
        <DATIME.LIB>DATIME.

             Implementation of statistic  gathering is performed by  defining a
        LOOK  routine layered  between the  application and  the  ring handler,
        which intercepts all messages and records statistics.

             ?STAT commands implemented are:

               Q or QUIT  Exit back to DDT.

               EXI or EXIT  Exit (log out).

               IS.?    Help.  Brief resume of commands.

                                          112                           ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


               IS.I    Initialize INSTAT, start statistics gathering.

               IS.H    Halt  INSTAT, Stop  statistics  gathering.  Exits
                       via IS.C.

               IS.C    Check INSTAT status.  Status may be:

        INSTAT Not Used.
                - or -
        NSTAT started DDMMYY HH:MM:SS (GMT).
                - and -
        Running for HH:MM:SS
                - or -
        Ran for HH:MM:SS
        Input NNNNN user messages, NNNNN system messages
        Input a total of NNNNNN user data characters.

               IS.L    Length statistics.  Outputs the message  code (in
                       HEX) and the number of occurances of each message
                       (in decimal), both for user and system messages.

               IS.D    Data statistics.  Outputs the character  code (in
                       HEX) and  the number of  occurances of  each data
                       character.

               IS.S    String statistics.  Outputs the string length and
                       number of  occurances of  strings of  that length
                       (both decimal).





                    7.3.2  SPY.LIB

             This  package  is  controlled  by  ?STAT  commands,  and  collects
        statistics on slot execution.  It's operation is completely transparent
        to the application, except for the extra load imposed upon  the machine
        by it's use.

             SPY requires STATUS.LIB.

             Implementation of statistic gathering is performed by invoking the
        ISIS SPY logic,  which periodically (based upon  interrupts) determines
        the current execution location, and collects statistics based thereon.

             Special symbols may  be defined to  direct the SPY.LIB  package to
        initialize certain  parameters;  default values  are provided  if these
        are not defined.  The symbols (and defaults) are:

               SP.FAD  First  Address  (default =  beginning  of Segment
                       A.CODE).


                                          113                           ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


               SP.SIZ  The size of a spy Bin (default = 80 bytes).

               SP.RNG  The  range  of  spy  execution  (default  = range
                       between SP.FAD and beginning of SPY.LIB code).

               SP.NBIN The  number  of  bins  to  allocate   (default  =
                       SP.RNG/SP.SIZ).


             ?STAT commands implemented are:

               Q or QUIT - Exit back to DDT.

               EXI or EXIT - Exit (log out).

               SP.? -  Help.  Brief resume of commands.

               SP.I -  Initialize SPY, start statistics gathering.

               SP.H -  Halt SPY,  Stop statistics gathering.   Exits via
                       SP.C.

               SP.C -  Check SPY status.  Status may be:

                                     SPY Not Used.
                                        - or -
                                   SPY in progress.
                                        - or -
                                    SPY completed.

               SP.L -  List  statistics.   Outputs the  first  bin start
                       address and the number of occurances in  each bin
                       (in decimal), up to 8 bins/line.

               SP.P -  Profile statistics.  Outputs the start address of
                       each channel and a line of "*"s, whose  length is
                       dependent   upon   the   number   of  occurances.
                       Automatic  scaling  of output  takes  place, such
                       that no  line will overflow.   The exact  form of
                       output may be either "truncated"  (multiple empty
                       bins  print as  a single  blank line),  or "full"
                       (each  bin  is  printed).   The  default  mode is
                       "truncated".

               SP.T -  Set histogram to "truncated" mode.

               SP.F -  Set histogram to "full" mode.

               SP.D -  Display the parameters used:





                                          114                           ISIS-II
        ISIS LIBRARY PACKAGES                                  January 24, 1983


        Start Addr. = 10000x
        Range =        2000x (end addr. = 12000x)
        Bin size =      100x
        No. Bins = 32

               SP.N -  Specify number of bins (decimal).  Exit via SP.D.

               SP.R -  Specify new range (hexidecimal).  Exit via SP.D.

               SP.S -  Specify  new start  address  (hexidecimal).  Exit
                       via SP.D.

               SP.B -  Specify  new  bin size  (hexidecimal).   Exit via
                       SP.D.


                                        NOTES:


                  SPY records ALL occurances of execution  within the
                  specified  area of  memory, and  cannot distinguish
                  between foreground, background, and DDT usage.

                  N (number of bins) *  B (bin size) = R  (range).  A
                  change in either B  or R will be reflected  in both
                  parameters being  changed.  A change  in N  will be
                  reflected in a corresponding change in B.

                  B  is   internally  constrained   to  be   even,  a
                  reasonable constraint since all  instructions start
                  on half-words.   The same  constraint applies  to S
                  (start address).

                  Each of N, B, and R must be entered greater than 0,
                  to avoid a diagnostic.

                  Furthermore, N  is internally  forced to  the value
                  specified  by  SP.NBIN  (or  it's  default)  if  an
                  attempt is made to exceed this value.


                  Until  such  time  as  the  new  SPY  SVC  is fully
                  deployed, this package  will operate in  a "kludgy"
                  fashion:  SP.H  and SP.C give  meaningless results;
                  SP.I  will output  a command  list, which  you must
                  enter to DDT to perform the SPY connection.








                                          115                           ISIS-II
        CONFIGURING AN ISIS SYSTEM                             January 24, 1983






                            8 -  CONFIGURING AN ISIS SYSTEM


             In order to configure an ISIS system, some knowledge is  needed of
        the proposed applications,  and their resource requirements.   The ISIS
        environment itself takes  65-100 (or more)  K-bytes of memory,  and the
        NODE-CODE  portion requires  an  additional 45-128  (or  more) K-bytes,
        depending  on  the  configuration.   Individual   applications  require
        varying  quantities   of  resources,   and  must   be  computed   on  a
        configuration-by-configuration basis.

             Anyone  configuring  ISIS  systems  must  currently  go  through a
        "feeling-out" process, where a proposed configuration is tried, and run
        through NAD to determine  the resource requirements.  To this  end, the
        remainder of  this chapter is  devoted to an  annotated example  of the
        generation of a particular configuration.






                                      8.1  FILES


             An ISIS configuration  is easiest to  maintain through the  use of
        several  files on  the  PDP-10.  These  include a  file  containing the
        configuration parameters  (XXX.TYM file),  and a  corresponding command
        file (XXX.CMD file).  These are treated separately below.

             NOTE...The file  names used herein  are descriptive ONLY,  and are
        not intended to reflect real file names in directory (ISIS2).  The real
        file names are instead keyed with the appropriate version  and revision
        levels.





                    8.1.1  XXX.CMD FILE

             The command file is just that...a set of commands to NAD, normally
        telling NAD which  other files to assemble  (see NAD chapter  for other
        usages).  A typical command file for node IS (Isis System),  would have
        the following form (shown is what  you would see if you typed  the file
        out; the quantities <i> are  NOT in the file--they reference  the notes
        following):



                                          116                           ISIS-II
        CONFIGURING AN ISIS SYSTEM                             January 24, 1983



        ;@(ISIS2)INIT.NAD       <a, b>
        ;@IS.TYM                <c>
        ;@(ISIS2)GOODGY.LAB     <d>
        ;@(ISIS2)ISIS.NAD       <e>
        ;@(ISIS2)TNET2.NAD      <f>
        ;@(ISIS2)IGEN.I         <g>




           <a>.  The  ";@" tells  NAD to assemble  this file  (INIT.NAD).  This
               file, in turn, defines certain parameters and MACROS  which will
               be invoked by subsequent files.
           <b>.  There is no space between the ";@" and the "INIT.NAD".
           <c>.   This  file  comes  from  your  directory,  and  specifies the
               parameters according to which the configuration occurs.
           <d>.  This line  invokes the "good-guy"  file for a  particular sub-
               network.   This in  turn determines  which usernames  may access
               ISIS DDT.
           <e>.  This line tells NAD to assemble the ISIS source code according
               to the parameters in the IS.TYM file.  (In certain  cases, other
               files  must  be  specified  for  special  applications,  such as
               Supervisor, Disc and Tape, etc.)
           <f>.  This invokes the  TYMNET-II node-code (slot 0) portion  of the
               compilation.
           <g>.  The invocation of this  file is "optional"; it is  required if
               the  MERLIN  NIB-file binder  is  to be  used,  as  it generates
               several parameters used  by MERLIN.  If  used, it will  output a
               synopsis   of   the   configuration,   telling    the   resource
               requirements.





                    8.1.2  XXX.TYM file

             The XXX.TYM corresponds to the X.TYM files, familiar from TYMNET-I
        usage.   Below is  a sample  X.TYM file.   Again, <a>  refers  to notes
        following:

        : IS.TYM        ISIS-II T-II - DEFINITION PARAMETERS - R03.00   <a>

        :               DEFAULT HARDWARE CONFIGURATION OVERRIDE         <b>
        NASYNG  EQ      4               :* NO. OF ASYNC GROUPS (2 GRP/CD)  <c>
        MICRO   EQ      1               :* 1 IF ENHANCED ASYNC MICRO-CODE  <d>

        :               ISIS CONFIGURATION CONSTRAINTS
        NSLOT   EQ      5               :  NO. OF SLOTS TO CONNECT      <e>
        NLU     EQ      4               :  MAX. NO. OF LOGICAL UNITS/SLOT  <f>

        :               NODE CONFIGURATION                              <g>

                                          117                           ISIS-II
        CONFIGURING AN ISIS SYSTEM                             January 24, 1983


        TII     EQ      1               :  1 IF TYMNET-II ON NODE       <h>
        XLINKS  EQ      4               :  EXTRA T-II LINKS
        SILINS  EQ      4               :  NUMBER OF SIO LINES
        NSP     EQ      080             :  NUMBER OF TYMNET II PORTS    <i>
        PTHRU   EQ      0               :  1 IF PASSTHROUGHS INHIBITED  <j>
        MACHNM  EQ      $8 2377         :  NODE NUMBER                  <k>
        HST0    EQ      $A 377          :  ISIS KERNEL HOST NUMBER      <l>

        :               NETWORK CONFIGURATION                           <m>
                TYMNET(0,2030,8)                                        <n>
                TYMNET(1,2004,4)
                TYMNET(2,2006,)
                TYMNET(3,2003)

        :       SLOT 0 - T-II NODE CODE                                 <o>
        NLUS0   EQ      4               :  NO. OF L.U.'S FOR NODE CODE  <p>
        S0L0    S.REF(0)                                                <q, r>
        S0L1    S.REF(1) 
        S0L2    S.REF(2) 
        S0L3    S.REF(5)                                                <s>

        :       SLOT 1 - GATEWAY
        S1CORE  EQ      $A 40           :  SL0T 1 CORE SIZE IN K-BYTES  <t>
        NLUS1   EQ      1               :  NO. OF L.U.'S FOR SLOT 1
        S1L0    S.REF(4)

        :       SLOT 2 - TYMSAT
        S2CORE  EQ      $A 50
        NLUS2   EQ      4
        S2L0    A.REF(0)                                                <u>
        S2L1    A.REF(1)
        S2L2    A.REF(2)
        S2L3    A.REF(3)

        :       SLOT 3 - RAM
        S3CORE  EQ      $A 300
        NLUS3   EQ      0

        :       SLOT 4 - VAL
        S4CORE  EQ      $A 55
        NLUS4   EQ      0

        :       SLOT 5 - EXTENDED MEMORY APPLICATION
        S5CORE  EQ      $A 32
        NLUS4   EQ      0
                DEFEXT(5,3,10000,10000,3)                               <v>

        XGG     MACRO[                                                  <w>
                GG(0,2,ISIS)                                            <x>
        ]




                                          118                           ISIS-II
        CONFIGURING AN ISIS SYSTEM                             January 24, 1983


           <a>.  This is a comment line...it is not required, but does make the
               file more readable.
           <b>.  This set of parameters tells of the presence of various pieces
               of hardware.  These are a mix of ISIS-II switch  parameters, AND
               numbers  of  particular devices  on  the machine.   The  list of
               allowable parameters (and their default value) is:

            ENGINE:    1    * Assume (REQUIRE!!) TYMNET ENGINE
            XLINKS:    0      Extra Links - default window size = 8
            NLINES:    0      Number of SYNC lines
            SILINS:    0      Number of SIO lines
            DEBUG:     0    * System-DEBUG mode
            N.ADA:     0    * Use old async device addresses
            MICRO:     0    * Enhanced ENGINE Microcode not used
            M.NCARD:   0      No Mother-boards present **
            SYSDBG:    0    * TTY-port accesses DDT
            WWVB:      0    * No WWVB receiver
            SUP:       0    * No Supervisor configured
            NPRINT:    0      No printers
            XSELCH:    0    * No extra selector channel
            XSYNC:     0    * No extra sync card
            NASYNG:    0      No Asyng groups
            NDISC:     0      No disc
            NTAPE:     0      No tape
            MSCDSK:    0      No MSC-1400 Disc-controller ***
            DI.TRC:    1    * Dispatcher character trace turned on
            ZITEL:     1      1 if using Zitel MAC
            BAUD(BR1200)      1200 baud (BR4800 for 4800 baud)****


               * denotes switch parameter
               ** If Mother boards are declared present, for each define:
                        M.NPn   number of ports on card n;
                        M.DAn   device address of card n.
               *** for each controller declared, define:
                        NMSCn   number of drives on controller n;
                        MSCDAn  Device Address of controller n.
               **** The BAUD macro specifies to ISIS the expected baud rate.


                As more development occurs, this list is likely to expand.
           <c>.  There  are two ASYNC  groups per ASYNC  CARD.  An  Async group
               consists of  16 consecutive async  ports.  By dividing  the card
               into  groups,  we  can  assign  different  groups  to  different
               processes.   We can  also have  code which  services  only those
               groups in actual use, rather than all groups possible.
           <d>.  Enable the enhanced-ENGINE microcode.
           <e>.   This is  the number  of USER  slots to  configure;  it  is in
               addition  to slot  0, and  to any  slots configured  for special
               usage, such  as the supervisor.   It corresponds to  the highest
               numbered slot (connected to the dispatcher) in the machine.
           <f>.   The  maximum  number  of Logical  Units  for  any  slot.  All


                                          119                           ISIS-II
        CONFIGURING AN ISIS SYSTEM                             January 24, 1983


               peripheral devices are considered physical units, and are mapped
               into the contiguous, Logical units for each slot.  Logical Units
               may  be of  the same  (e.g.,  all sync  lines) type,  or  may be
               different  for  some application  (e.g.,  one unit  is  an async
               group, another is a printer).
           <g>.  This set  of parameters configure  slot 0 (the  node-code), in
               terms of resources.  (An ISIS system is ALWAYS a Base in TYMNET-
               I)!
           <h>.  ISIS-II will operate with slot 0 containing either TYMNET-I or
               -II code, with no change to the various  applications.  However,
               certain restrictions apply to TYMNET-I, and diagnostics  need be
               generated if an attempt  is made to use  TYMNET-II configuration
               parameters with  TYMNET-I.  If T-II  is invoked, then  there are
               extra  parameters  which  apply to  TYMNET-II  only!   These are
               defaulted, as shown below.
           <i>.  NSP is a TYMNET-II parameter...  the number of  ports assigned
               to the node code (slot 0).
           <j>.  PTHRU is set to 1 if the node is not to support passthroughs.
           <k>.  The TYMNET node number.
           <l>.  The TYMNET host number used to access the ISIS KERNEL.
           <m>.  These parameters describe the position of the node in TYMNET.
           <n>.  This MACRO invocation defines one network link:
           Parameter    Usage
               1        link number (decimal should be specified);
               2        neighbor number (octal);
               3        number of groups to use on this link (if TII = 0);
                                        else
               3        window size...must be multiple of 4 (if TII = 1).
           <o>.  We finally come to allocating resources to each of  the slots.
               Slot 0 is special, in  that the node-code defines it's  own size
               at assembly time.   Slot 0 may  also reference no  devices other
               than sync or M-boards.
           <p>.  A slot may have less than the maximum number of LU's assigned.
               However, there must be a definition for each LU  specified.  The
               correct format is "NLUn" or "NLUnn", where n or nn is  a decimal
               number.
           <q>.  The correct  format for these symbols  is "SiLj" (Slot  i Line
               j), where i and j may be 1- or 2-digit decimal numbers.
           <r>.  This MACRO reference assigns Sync-line 0 to symbol S0L0.
           <s>.  Note  that logical  units need not  be assigned  to successive
               physical  units.   Indeed,   for  many  configurations,   it  is
               desirable (and  necessary) to perform  assignments such  as sync
               lines 0, 1, 4,  5, 8, 9, 12,  13 to successive logical  units on
               the node code,  in order to  permit other interfaces  to acquire
               enough  of the  special sync  lines (those  with terms,  such as
               Clear-To-Send, available).
           <t>.  This is the memory  allocated to this slot.  Once  the machine
               is up, no more memory can be assigned without reloading!






                                          120                           ISIS-II
        CONFIGURING AN ISIS SYSTEM                             January 24, 1983


           <u>.  Here  we see a  different type of  logical unit  assigned.  In
               particular, this invocation is to Async-group 0.   Devices which
               may be referenced are:
               Sync line (S.REF);
               Async group (A.REF);
               Printer (P.REF);
               Experimental SIO card (X.REF);
               Mother-board device (M.REF...note that this has 2 arguments: the
                  card number and device number upon that card!).
           <v>.  The DEFEXT macro defines the address limits and protection for
               the extended MAC area.  It takes the form:

                DEFEXT (SLOT,BLOCK,STPG,NUM,PROT)

             where
                SLOT    slot number (may range from 0 - NSLOT)
                BLOCK   block number (may range from 3 - 15)
                STPG    starting page number
                NUM     number of pages
                PROT    protection mask
                        1       execution access permitted
                        2       write access permitted
                        4       read access permitted (assumed if execution or
                                write access is specified)

           <w>.   This  section  is  used to  specify  additional  users  for a
               specific ISIS configuration, if  a standard sub-net file  is not
               used.  This  is done via  the creation of  a MACRO  invoking the
               "GG" macro, of form:

                GG(LICENCE,ACCESS,NAME)

                        where:

        LICENCE:        may be 0, or any combination of the following ("!" is
                        the logical OR function):
                        L.DISC ! L.SYA!L.SYP!L.SYR
                        !L.SUA ! L.S0A!L.S0P!L.S0R
                        !L.P!L.H!L.L!L.E!L.R
        ACCESS:         -1 if all access allowed; else unique slot #
        NAME:           user name (up to 8 chars long)

           <x>.  This validates  a user "ISIS", with  no licences, to  log into
               slot 2 (only).










                                          121                           ISIS-II
        CONFIGURING AN ISIS SYSTEM                             January 24, 1983


                                    8.2  GENERATION


             To generate a node from the above files, we execute  the following
        session fragment:

        -R NAD                                                          <a>
        101979                                                          <b>
        ;X   IS.CMD                                                     <c>

        ;@   (ISIS2)INIT.NAD                                            <d>

        End of assembly
        ;@   IS.TYM                                                     <d>

        End of assembly
        ;@   (ISIS2)GOODGY.LAB                                          <d>

        End of assembly                                                 <e>
        ;@   (ISIS2)ISIS.NAD

        SYNC 7AA 0F54                                                   <f>
        CLOCKS 0F54 1854
        FLASH 1854 1940
        KCAREA 1A00 2000
        KERNEL 2000 5564
        DDT 5600 7300
           3376d bufferlets allocated to dispatcher                     <g>
        DISPAT 7300 13000
        End of assembly
        ;@   (ISIS2)TNET2.NAD                                           <h>

           Slot 0 CTA assembled at: 13000x, 20000x bytes                <i>
        End of assembly
        ;@   (ISIS2)IGEN.I

         ............................................



            ***  ISIS-II  ***                                           <j>
              Version 2.0d                                              <k>
             >>> ENGINE <<<                                             <l>
        TYMNET-II, Version 471.12o                                      <m>
            KERNEL host is 377                                          <n>
        4 interface slots

         expects 1 async board, device address is 91
                enhanced micro-coded async

        node 2377 has 4 sync lines:                                     <o>
        line 0d is physical line 0
        line 1d is physical line 1

                                          122                           ISIS-II
        CONFIGURING AN ISIS SYSTEM                             January 24, 1983


        line 2d is physical line 2
        line 5d is physical line 5

        Slot configurations:

        slot 1 has 40 K-bytes of core, from 36800 to 407FF
        1 logical unit
        L.U. 0 is sync line 4                                           <p>

        slot 2 has 50 K-bytes of core, from 40800 to 97FFF
        4 logical unit
        L.U. 0 is async group 0
        L.U. 1 is async group 1
        L.U. 2 is async group 2
        L.U. 3 is async group 3

        slot 3 has 300 K-bytes of core, from 4D000 to 97FFF
        no logical units

        slot 4 has 55 K-bytes of core, from 98000 to 0A5BFF
        no logical units

        *** HIGHEST LOCATION USED IN THIS CONFIGURATION IS 0A5C00       <q>

        REQUIRES 665d KILOBYTES OF CORE                                 <r>



         ............................................



        End of assembly
        %Q                                                              <s>
        EXIT

        -




           <a>.  Execute NAD.
           <b>.  NAD is ready to accept input.
           <c>.  Tell NAD to use the command file.
           <d>.   NAD  assembles the  INIT.NAD,  the .TYM,  and  the GOODGY.LAB
               files.
           <e>.  NAD finishes assembling the .LAB file.
           <f>.  Various modules of the code are assembled, and the  start- and
               end-addresses are output.
           <g>.  A resource note is issued concerning the number  of bufferlets
               assigned to the dispatcher.
           <h>.  The node code is assembled...in this case, TYMNET-II.


                                          123                           ISIS-II
        CONFIGURING AN ISIS SYSTEM                             January 24, 1983


           <i>.  A resource note is issued concerning the start and size of the
               node code.
           <j>.  NAD assembles the IGEN  source file.  This in turn  prints out
               the map of the configuration.
           <k>.  The ISIS-II version number.
           <l>.  Indicates that this code will run on a TYMNET ENGINE.
           <m>.  The node-code type and version number.
           <n>.  The kernel host number...this is the host one will log into in
               order to access this machine's DDT.
           <o>.  The node configuration is printed.
           <p>.  The  type of  unit is specified  for each  LU.  NULL  LU's are
               ignored.
           <q>.  The highest location in hex.
           <r>.  The core required.
           <s>.  We enter the command to exit out of NAD.






                                  8.3  SHARED DEVICES


             Certain  devices,  notably disc  and  tape, must  of  necessity be
        shared between all users of an ISIS system, and are thus refered  to as
        global units or shared devices.  These need be configured in  a special
        fashion.





                    8.3.1  DECLARING SHARED DEVICES

             The first  requirement is that  the devices be  present...thus the
        parameters NDISC, NTAPE, and/or MSCDSK must be defined non-zero.

             Then  the device  partitions  must be  defined:  this  is  done by
        invoking the following MACRO for each partition:

                SGU.DEF(n,DEV,m,START,SIZE,sys)

             where:


           n:     Global Unit Number (hex);
           DEV:   Mnemonic device type (Choose from "DK", "MT", or "MS");
           m:     Device Unit number (decimal...eg, MT"0", MT"1", etc.);
           START: Area Start Cylinder (hex, Discs only);
           SIZE:  Area Size (Cylinders, hex;  Discs only),
           sys:   the value  "1" to denote the  system device (type  "DK" discs


                                          124                           ISIS-II
        CONFIGURING AN ISIS SYSTEM                             January 24, 1983


               only;   only one  area on  disc may  be declared  as  the system
               device).





                    8.3.2  REFERENCING SHARED DEVICES

             Once  all global  units are  declared, it  is necessary  to assign
        them, with the appropriate access licence, to each slot.  This  is done
        by declaring the  number of shared logical  units for each  slot.  This
        symbol is called:

                                         NXLUn

             where  "n" is  a  one or  two  digit decimal  number,  (eg, NXLU0,
        NXLU11).

             Next, the  global units are  assigned to the  slot.  This  is done
        with successive invocations to the MACRO:

                SGU.REF(SLOT,XLU,GLU,Access)

             where:


           SLOT:    The number  of the  slot to  which the  assignment  is made
               (decimal);
           XLU:     The  number  of  the  eXtra  Logical  Unit  being  assigned
               (decimal);
           GLU:    The number of the GLobal Unit being assigned (hex);
           Access: A list of mnemonics  used to specify access allowed  to this
               usage: (choose from combinations of):
                RD      ReaD access allowed
                WR      WRite access allowed
                AT      ATtach access allowed
                SS      Save licence
















                                          125                           ISIS-II
        CONFIGURING AN ISIS SYSTEM                             January 24, 1983





        8.3.2.1  EXAMPLE:



                SGU.DEF(1,DK,0,0000,1C)         save area
                SGU.DEF(2,DK,0,001C,4FF)        work area
                SGU.DEF(3,DK,0,041C,1,1)        system device

        NXLU0   EQ      0                       no units for slot 0
        NXLU1   EQ      0                       no units for slot 1
        NXLU2   EQ      3
                SGU.REF(2,0,2,RD+WR)            read/write access to area 2
                SGU.REF(2,2,1,RD)               read access to area 1

                                        NOTES:


           This example partitions the disk into two areas (global  units), one
               for a work area, one for a save area.
           Slots 0 and 1 do not access shared devices.
           slot 2 defines local units 0 and 2, but for some reason  leaves unit
               1 unassigned...this is not an error condition;  unassigned units
               are permitted, and allow of no access!
           Multiple access licences are generated with expressions of the form:

                              L1+L2+...   or   L1!L2!...

























                                          126                           ISIS-II
        STARTING & RESTARTING AN ISIS-II MACHINE               January 24, 1983






                     9 -  STARTING & RESTARTING AN ISIS-II MACHINE


             The following conventions are used during this chapter:

             <ZOT> means to press button ZOT on the engine front panel.  <7, 8>
        means to press buttons 7, then 8, in sequence.

             UPPER CASE IS WHAT YOU TYPE.  Lower case it what is typed  back at
        you.

             Always perform the following steps:

           Make sure the console is unlocked.
           If  the machine  is in  the wait  state (wait  light bars  on) press
               <PSW>.  Write down the number displayed on the console.
           To stop the machine press  <SGL>.  If the wait light bars  are still
               off, press <INI>.  If this  fails turn off the machine  and call
               for help.
           Press <DTA, ADR,  SET>;  if the consol  is now zero, proceed  to the
               next paragraph; else press <SGL> and repeat this  paragraph.  If
               unable to zero out the console, call for help.






                            9.1  START UP (WITHOUT RELOAD)


             Press <SGL> and wait for  the wait light bars to  reappear.  Press
        <SGL, 7, 0, ADR, RUN> -  the machine should now be up.   If successful,
        lock the console.  If not, go to the appropriate reload procedure.






                             9.2  PROM START FROM SCRATCH


             With the machine  in wait state, press  the PROM loader  switch on
        the TTY card.  This will cause the bootstrap loaders to be  loaded into
        memory, starting at 400,  and then executed.  The PROM  loader contains
        the TTY, the SYNC, and the DISK bootstrap.



                                          127                           ISIS-II
        STARTING & RESTARTING AN ISIS-II MACHINE               January 24, 1983


                        9.3  SPECIALIZED RELOADING INFORMATION


             Manual restart is at location 070.  This location contains  a jump
        which causes the machine to be re-initialized before restarting.

             The  bootstraps,  either PROM  or  TTY, come  into  low  core, and
        immediately find the end of memory, by successively trying to decrement
        memory at the end  of each 32-K block,  and checking if the  memory has
        really changed.  Once it succeeds, it copies the loaders into  the last
        512 bytes of existing memory,  and transfers to the bootstrap.   Any of
        the bootstraps  will initially save  RX3 format jump  instructions into
        low memory,  each of which  takes execution to  one of  the bootstraps.
        The pertinent locations are:

                5A      SYNC bootstrap
                60      TTY bootstrap
                66      DISK bootstrap

             Executing any of the bootstraps  will restore the jumps at  5A, 60
        and 66.






                                  9.4  DISK BOOTSTRAP


             The disk bootstrap shows  various diagnostics if some part  of the
        disk interface is failing.  The following values displayed on the right
        half of the consol indicate the failure:

                0000    disk is not responding
                0001    disk RESTORE operation failed
                0002    disk SEEK operation failed
                0003    disk CONTROLLER failed
                0004    disk SELECTOR CHANNEL STATUS is bad
                0005    disk CONTROLLER STATUS is bad
                000E    SUCCESS!

             On occasion, it may be  desirable to reference the disk in  a non-
        standard fashion,  requiring patching  of the  bootstrap.  If  the DISK
        bootstrap starts at 0XXF0C, then the following location contain:

                0XXF00  Memory Start Address (4 bytes)
                0XXF04  Memory End Address (4 bytes)
                0XXF08  Initial disk cylinder (2 bytes)
                0XXF0A  Controller Command (read=0130, write=0210) (2 bytes)

             The DISK bootstrap may be  called from a program (NOTE,  from ISIS


                                          128                           ISIS-II
        STARTING & RESTARTING AN ISIS-II MACHINE               January 24, 1983


        system, not user program), E.G.,  to save a crash.  The  program should
        initialize the  above constants first,  (it can determine  the location
        from the address stored at location 68, the address portion of the jump
        to DISK bootstrap starting at  66), and then JAL to 0XXX0E,  linking on
        register 9.  The diagnostic status normally presented to the  consol at
        the end of a  disk boot is returned  in register 1.  Registers  are NOT
        preserved during this operation!















































                                          129                           ISIS-II
        Loading an ISIS-II slot                                January 24, 1983






                             10 -  Loading an ISIS-II slot







                               10.1  Prefered procedure


             The prefered method of loading  a slot is via the  LOADII program.
        See the TOOLS AND UTILITIES document for usage.






                    10.2  alternate procedure [used for debugging]


             In order to bring a process on-line under ISIS, it is necessary to
        perform a sequence  of operations to  generate, load, and  connect that
        process.  These  operations have,  to some  extent, been  automated, so
        that  the  inexperienced  operator  can  load  and  bring  on-line some
        specific process.  This description is in terms of  this semi-automated
        procedure, with  notes "<x>"  provided for those  users who  would like
        additional information, and  for those programmers  who would set  up a
        procedure for some new process.

             NOTE...an ISIS slot must be reloaded each time that ISIS itself is
        loaded, unless  one has  used MERLIN  to bind  the contents  of several
        slots  into one  master ISIS  ".NIB" file.   MERLIN will  allow several
        different applications to be loaded along with ISIS, all at one time.

             In order  to use  the semi-automated  process, knowledge  of three
        specific pieces of information are required:


           1.   The name  of the  command file  describing the  assembly  to be
               performed;
           2.  The ISIS host number (slot 0) of the destination machine;
           3.  The slot number, within that machine, that is to be loaded.

             The process to be described  is in terms of a command  file, which
        is assumed to already exist on the the PDP-10.  The  naming conventions
        for these command files  is IhhhSn.CMD, where "hhh" is  the destination


                                          130                           ISIS-II
        Loading an ISIS-II slot                                January 24, 1983


        host  number,  and "n"  is  the slot  number  (this  convention applies
        currently--it will be necessary to  expand it, within the limits  of 6-
        character file names, as the  range of host numbers, and the  number of
        slots possible, expand).

             For the purposes of illustration, assume that file  I377S1.CMD has
        been defined, to be loaded into host 377, slot 1.  This is what we must
        do:

        ==> we type:    -R NAD
        NAD responds:   Ready
        ==> we type:    ;X   (ISIS2)I377S1.CMD                  <a>
        NAD responds:   
                        ;@   (ISIS2)I377S1.COM                  <b, c>

                        End of assembly
                        ;@   (ISIS2)START.LIB

                        End of assembly
                        ;@   (ISIS2)FRING.LIB

                        RING 6 1020C                            <d>
                        End of assembly
                        ;@   (ISIS2)TIMOUT.LIB

                        TIMOUT 806 102E0
                        End of assembly
                        ;@   (ISIS2)BUFFER.LIB

                        BUFFER 846 20802
                        End of assembly
                        ;@   (ISIS2)BID.LIB

                        BID 10698 107F0
                        End of assembly
                        ;@   (ISIS2)CRASH.LIB

                        CRASH 1050 1092E
                        End of assembly
                        ;@   (ISIS2)FRONT.LIB

                        FRONT 10A2 11022
                        End of assembly
                        ;@   (ISIS2)TEST.NAD

                        End of assembly
                        ;@   (ISIS2)FINISH.LIB

                        SEGMENT 0-length 5246d, requires 1500x bytes of core.
                        SEGMENT 1-length 4314d, requires 1100x bytes of core.
                        SEGMENT 2-length 2050d, requires 900x bytes of core.
                                12d K-bytes of core
                        End of assembly

                                          131                           ISIS-II
        Loading an ISIS-II slot                                January 24, 1983


        ==> we type:    ;C   ISIS:377;                          <e>
        NAD responds:   Working
                        Circuit ready

                        node: 377
                        host: 377

        query, respond: slot #: ;R01                            <f>
        ==> we type:    *:A                                     <g, h>
                        *:W SEGE, SESIZE                        <i>
        NAD responds:   Data Sent

        ==> we type:    *%R?LMAC                                <j>
        query, respond: *WSEG1,S1SIZE                           <k>
        NAD responds:    Data Sent

        ==> we type:    *;E                                     <l>
        ==> we type:    *%Q             <this exits us from NAD...we're done>
                        EXIT
                        -


                NOTES:

           <a>  The 3  spaces are  introduced by  NAD, to  improve readability.
               The particular command file used for this example would be:

        ;@(ISIS2)I377S1.COM
        ;@(ISIS2)START.LIB
        ;@(ISIS2)FRING.LIB
        ;@(ISIS2)TIMOUT.LIB
        ;@(ISIS2)BUFFER.LIB
        ;@(ISIS2)BID.LIB
        ;@(ISIS2)CRASH.LIB
        ;@(ISIS2)FRONT.LIB
        ;@(ISIS2)TEST.NAD
        ;@(ISIS2)FINISH.LIB
           which invokes a .COM parameter file, a number of .LIB library files,
               and one .NAD special source file.
           <b>  This  entire sequence  of output  is engendered  from  the .CMD
               file.
           <c>  A .COM file is normally used to specify the parameters specific
               to  a  particular   usage  of  a  particular   application.   In
               particular,  a  process  may be  active  several  places  in the
               network,  or even  in the  same machine,  and each  copy  of the
               process  is distinguished  by  parameters such  as  host number,
               number of ports, etc.   These parameters are defined  within the
               .COM file.
           <d>  Some of the files may have MODULE references.  Lines output, of
               this form, are related to modules, and may be ignored, except by
               the programmer.
           <e>  This command to NAD causes  a circuit to be constructed  to the


                                          132                           ISIS-II
        Loading an ISIS-II slot                                January 24, 1983


               user-name  specified.  This  must be  either YOUR  user-name, or
               else you must have previously set "AC" license on the PDP-10.
           <f>  We  are now  getting  responses both  from NAD,  and  from DDT,
               through NAD.  DDT is outputting the node and host numbers, (just
               for redundancy,  in case you  mis-typed the destination  host in
               <e>.  DDT may then ask you for the slot number...if it does, use
               the ";Rnn"  (relay) debugger  command to  send DDT  the required
               slot number.  If it does  not, then the user-name you  have used
               is hard-assigned to  a specific slot number.   [NOTE...";R01" is
               the response portion of this line.]
           <g>  The "*" is a prompt from DDT.  We invoke another  command file,
               to do the rest of the work.
           <h>  This command is used to set up the MAC for the next operation.
           <i>  We  must  first  write  segment  "E",  since  it  will  contain
               information  which  will  permit  subsequent  operations  to  be
               performed.
           <j>  [This command  MUST be  terminated with  "ESC"!!] Based  up the
               information presented with the last command, DDT will now set up
               the  MAC so  that other  areas can  be loaded;   Currently, this
               command must  be sent in  "relay" mode, hence  the need  for the
               escape to return to NAD's command level.
           <k>  We  assume only  area 1  need be  loaded, other  areas  will be
               initialized by the code.
           <l>  This command causes the process to start  execution...it SHOULD
               be typed-in separately (rather than being a part of  the command
               file)  so that  if any  error occurs  during loading,  the human
               controlling  the process  can abort  the execution,  rather than
               allow something STRANGE to execute.


























                                          133                           ISIS-II
        Summary of ISIS Message Formats                        January 24, 1983






                     APPENDIX I.   Summary of ISIS Message Formats



             Conventions used are:

                     <byte>    <-----full word----><half word> (unused)
        * Type         !.##.:....|....:....!....:....|....:....!____:____|

             where "*", if present, denotes this message may only appear in one
        direction -- "<" = toward slot; ">" = from slot.


                                ---  PORT messages  ---

             For user ports (port = 1-64k), first halfword is port number.

        < Needle         00 :leng|  invoice number   |Dest host!Orig Node+
                                 |Orig Host!Orig Port|____:____!____:____+
                                 |Dialect..!TID.:Size|Tid.:size!User name...

          Data           01 :Data|  (1 data byte)
           :              :    :
          Data           9D :.. D a t a ..  (9Dx data bytes)

        > Detach         9E :____|
          Zap            9F :____|
          Set Bk-pres.   A0 :____|
          Release BP     A1 :____|
          Gobbler        A2 :____|
          Flush input    A3 :____|
          Black Ball     A4 :____|
          Grey Ball      A5 :____|
          Enter DEM      A6 :____|
          Leave DEM      A7 :____|
          Enter Transp.  A8 :____|
          Leave Transp.  A9 :____|
          Green Ball     AA :____|
          Red Ball       AB :____|
          Yellow Ball    AC :____|
          Orange Ball    AD :____|
          Break Begin    AE :____|
          Hang up        AF :____|
          Query term.    B0 :.NN.|
          Set Terminal   B1 :.NN.|valu:____!____:____|
        < Pseudo Need.   B2 :key.|local.key!____:____|
        > Logon Char     B3 :char|
        < Logon status   B4 :stat|
        < Logon failed   B5 :err.|

                                          134                           ISIS-II
        Summary of ISIS Message Formats                        January 24, 1983


        < Logon 'OK'     B6 :____|  invoice number   |Orig Host!____:____|
        > Accounting     B7 :____|0Emg:value....:....|
          Super Hang     B8 :____|
          Set xmit limit B9 :limt|
          Break end      BA :____|
        > Zap ack        BB :____|
          Ent Alt Dev    BC :____|
          Lev Alt Dev    BD :____|
        > Zap w/reason   BE :resn|
          SIIX Command   BF :____|
          TIIX Command   C0 :____|

             Note:   Set-Terminal-Parameter  and  Query-Terminal-Parameter have
        the Parameter-Type-Field NN:

        NN  Bit Length  Usage

        00      1       Echo control
        01      1       Echo Control-I
        02      1       Echo LF with LF/CR/Rub
        03      1       Echo CR with CR/LF
        04      1       CR Delay
        05      4       Input Baud rate
        06      4       Output Baud rate
        07      1       Parity
        08      1       Half-Duplex
        09      4       Parameter-A
        0A      4       Parameter-B
        0B      4       Parameter-C
        0C      1       X-Enable
        0D      1       Echo Control-H (backspace)
        0E      1       Reverse X-Enable
        0F      4       Parameter-D
        10      1       Katakana
        11      1       Terminate output on Break
        12      1       Echo-ESC
        13      1       "Q"-mode


                          ---  Intra-ISIS Communications  ---

             For Intra-ISIS Comunications, RPORT (first halfword) is zero.

          Restart Req.   00 :____|
          Restart Resp   01 :____|
        < Take over      02 :Supn|
        > Rpt to SUP     03 :key.|Half wd 4!Half wd 3|HW2l:____!____:____|
        > Host status    04 :key.|  Host # !# of prts|Rel Host#!stat:Hkey|
        > Report Accnt   05 :____|accounting message |
        < Tell hst Tim   06 :____|....:...GMT...:....|
        > Pseudo N Req   07 :key.|local key!I........|Orig Host!TID.:____|
        > Aux Crq req    08 :key.|local key!I........|Orig Host!size+
                                 :User name...

                                          135                           ISIS-II
        Summary of ISIS Message Formats                        January 24, 1983


        < Pseudo N rej   09 :key.|local key!err.:____|
        > Hst Prt aval   0A :key.|  Host # !# of prts|Rel Host#!____:____|
        < Host unaccep   0B :key.|  Host # !err.:____|
        > Rpt Hst cost   0C :key.|  Host # !Host Cost|Rel Host#!____:____|
        < No SUP         0D :____|
        < 1Down Mess.    0E :key.|Type:Size!Text...
        < Rpt All Hsts   0F :____|
        > Ext. Host stat 10 :key.|Host numb!# of prts|Rel Host#!stat:Hkey+
                                 |I___:PID !













































                                          136                           ISIS-II
        Summary of ISIS Kernel SVC's                           January 24, 1983






                      APPENDIX II.   Summary of ISIS Kernel SVC's



             Conventions used:

           "<"     Arguments are expected in registers;
           ">"     values are returned in registers;
           "*n"    may skip return (by n bytes);
           "R"     Register specified by user;
           "Rn"    Register specified.


                                     Dismiss SVC's

        SVC     0,VALUE         Dismiss Execution
        SVC     1,--            Fast Dismiss Execution


                                 System SVC's (SYS=2)

        SVC     SYS,0           Restart                         <R0, *4
        SVC     SYS,1           Connect-Foreground              <R0
        SVC     SYS,2           Turn-on-Debug-Mode
        SVC     SYS,3           Turn-off-Debug-Mode
        SVC     SYS,4           Test-Debug-Mode                 >R0
        SVC     SYS,5           Freeze-Slot
        SVC     SYS,6           Thaw-Slot
        SVC     SYS,7           Test-Freeze                     >R0
        SVC     SYS,8           Read-DDT-Register               <R0, >R0
        SVC     SYS,9           Read-DDT-PSD                    <R0, >R0
        SVC     SYS,10d         Read-Background-Register        <R0, >R0
        SVC     SYS,11d         Read-Background-PSD             <R0, >R0
        SVC     SYS,12d         Read-Foreground-Register        <R0, >R0
        SVC     SYS,13d         Read-Foreground-PSD             <R0, >R0
        SVC     SYS,14d         Read-DDT-MAC-Register           <R0, >R0
        SVC     SYS,15d         Read-Background-MAC             <R0, >R0
        SVC     SYS,16d         Read-Foreground-MAC             <R0, >R0
        SVC     SYS,17d         Set-1-Protect                   <R0
        SVC     SYS,18d         Set-Protection                  <R0
        SVC     SYS,19d         Set-Backround-Execution-Addr.   <R0
        SVC     SYS,20d         Set-Foreground-Execution-Addr.  <R0
        SVC     SYS,21d         Setup-Dispatcher-MAC
        SVC     SYS,22d         Check-SUP-Freeze-State          *4
        SVC     SYS,23d         Check-SUP-Run-Q-State           *4
        SVC     SYS,24d         Freeze the SUP
        SVC     SYS,25d         Thaw the SUP
        SVC     SYS,26d         Set/Clear ALARM                 <R0
        SVC     SYS,27d         Read Super-Clock                >R0, *4

                                          137                           ISIS-II
        Summary of ISIS Kernel SVC's                           January 24, 1983


        SVC     SYS,28d         Set Super-Clock                 <R0
        SVC     SYS,29d         Set User Diagnostic             <R0
        SVC     SYS,30d         Locate Storage Parameters       >R0--R1
        SVC     SYS,31d         Super-Freeze-Slot               <R0, *4
        SVC     SYS,32d         Halt-Slot
        SVC     SYS,33d         Super-Halt-Slot                 <R0, *4
        SVC     SYS,34d         SPY                             <>R0, *4
        SVC     SYS,42d         Replace MAC Set                 <R0,R1, *4


                           I/O Control SVC's (IO=3); OP:REG 

        SVC     IO,8000,,       I/O Attributes Query            *4
        SVC     IO,0:R          Connect Synchronous Input       <R--R+2, *4
        SVC     IO,1:R          Connect Synchronous Output      <R--R+1, *4
        SVC     IO,2:R          Force Synchronous Output        <R--R+1, *4
        SVC     IO,3:R          Connect Async (old)             <R--R+7, *4
        SVC     IO,4:R          Connect Printer                 <R--R+2, *4
        SVC     IO,5:R          Force Printer Output            <R--R+2, *4
        SVC     IO,6:R          T-II Sync-line Connect          <R, *4
        SVC     IO,7:R          T-II Sync-line Idle Test        <R, *4
        SVC     IO,8:R          T-II Query Parameters           <R, *4
        SVC     IO,9:R          Connect M-board channel         <R--R+3, *4
        SVC     IO,10d:R        Force M-board input             <R--R+3, *4
        SVC     IO,11d:R        Force M-board output            <R-R+3, *4
        SVC     IO,12d:R        Connect Async (new)             <R0, *4


                                 Extended Memory SVC's

        SVC     5,MACSET        Change MAC Set                  


                                       DDT SVC's

        SVC     0A,R:TIME       TTY Input                       >R, *4 (*2)
        SVC     0B,ADDR         TTY Output

















                                          138                           ISIS-II
        Summary of ISIS Kernel SVC's                           January 24, 1983


                            Kernal I/O operations (KIO=0D)

        SVC     KIO,0           detach circuit
        SVC     KIO,1           transfer control
        SVC     KIO,2           T.I.D.                          >R0
        SVC     KIO,3           echo on
        SVC     KIO,4           echo off
        SVC     KIO,5           flush outbound circuit
        SVC     KIO,6           change context                  <R0, *4/*8/*12d
        SVC     KIO,7           change context (default)        *12d
        SVC     KIO,8           check own background            *4
        SVC     KIO,9           check any background            <R0, *4
        SVC     KIO,10d         output number                   <R0--R1
        SVC     KIO,11d         Set Zap handling
        SVC     KIO,12d         send yellow ball
        SVC     KIO,13d         set trap handling               <R0
        SVC     KIO,14d         output single data char         <R0


                         Shared Device Control SVC's (SHARE=4)

        SVC     SHARE,ADDR      Shared Device Operations
        SVC     0E,ADDR         Disk I/O (Block)  [obsolete]
        SVC     0F,ADDR         Disk I/O (Sector) [obsolete]






























                                          139                           ISIS-II
        ISIS DISPLAYS AND HALTS                                January 24, 1983






                        APPENDIX III.   ISIS DISPLAYS AND HALTS



             In general,  the ISIS  SYSTEM generates a  display on  the machine
        front-panel:






                                 III.1  NORMAL DISPLAY


             The normal  ISIS display consists  of nine hexidicimal  digits, of
        format:

                ----.---.---.---.---.---.---.---.----
                | s | speed | S0 ss | slot display  |
                -------------------------------------

             Where:

           s        slot number -- the number of the ISIS slot  being displayed
               in the "slot display" field.
           speed    speedometer -- a pair of bits which are periodically cycled
               to provide  a moving  display;  the  rate of  motion is  a rough
               indication of  the load experienced  by the ISIS  environment --
               hence the name "speedometer".
           S0 ss    Special display for slot  0 -- the usage  varies, depending
               on the contents of slot 0 (TYMNET-I or II).
           slot display  this  field  may  display  current  information  for a
               running slot;  the usage is highly slot dependent.  If  the slot
               is  NOT  running,  a  default  display  is  generated  by  ISIS,
               depending upon the state of that slot:
               The slot  has been  halted by  outside activity  (halt command);
                  the display will present "DEAD" to indicate this state.
               The slot has been  halted by ISIS because of  excessive internal
                  faults (e.g. un-recovered  parity errors);  the  display will
                  present "D1ED" to indicate this state.
               The slot has never been activated;  the display will  present an
                  ordered succession of  "0FEE", "0F1E", "0F0E", and  "0F00" to
                  indicate  this  state.   It  is  unlikely  that  this  can be
                  misinterpreted as any  indication that the slot  itself might
                  originate.




                                          140                           ISIS-II
        ISIS DISPLAYS AND HALTS                                January 24, 1983


                               III.2  ISIS HALT DISPLAY


             Under certain  circumstances, the ISIS  SYSTEM may detect  that an
        irrecoverable  or  catastrophic  condition has  occured,  and  that the
        condition is severe enough to halt the machine.

             If a fault  occurs, the PSD  will reflect the  condition detected.
        The following discussion will display the PSD as:

                        .---.---.---.---.---. .---.---.---.---.
                        | B | A | D | x | x | | 8 | 7 | c | c |
                        --------------------- -----------------

                        .---.---.---.---.---. .---.---.---.---.
        formerly        | D | E | A | D | 0 | | 8 | 0 | c | c |
                        --------------------- -----------------

        (formerly       < x | 0 | 0 | 7 | 0 | | p | p | p | p > ).

             where xx is the extended crash-code, cc is the crash-code.





                    III.2.1  DISPLAYED STATUS

           BADxx 87cc  DEAD  Old form:
                             <1 8000>  machine ignores parity errors.
           BAD00 8720  8020  <1 8001>  parity     error     detected     during
               initialization.
           BAD00 8730  8030  <1 8002>  unexpected I/O interrupt.
           BAD00 8740  8040  <1 8003>  illegal        instruction        during
               initialization.
           BAD00 8750  8050  <1 8004>  MAC interrupt during initialization.
           BAD00 8760  8060  <1 8005>  SVC trap during initialization.
           BAD02 8750                  Unexpected    MAC    interrupt    during
               initialization of semiconductor memory above 1 MEG.
           BAD04 8763  8063  <1 8006>  Wild transfer to low core.
           BAD04 8730  8030  <1 8007>  Enhanced-sync interrupt, not expected.
           BAD02 8740  8040  <4 8000>  Illegal instruction within KERNEL.
           BAD02 8720  8020  <4 8001>  PARITY ERROR within KERNEL.
           BAD04 8752  8052  <4 8002>  DMA device timeout.
           BAD02 8763  8063  <4 8003>  Bad REPOP operation.
           BAD00 8763  8063  <4 8004>  Unable to connect slot on start-up.
           BAD04 8741  8041  <4 8005>  Bad MAC.
           BAD00 8790        <4 8006>  Daughter-board       timeout      during
               disconnect.
           BAD04 8762  8062            Unexpected Sync Interrupt.
           BAD14 8763        <5 8000>  Data   transfer   core   address  within
               KERNEL.
           BAD06 8762  8062  <5 8001>  Disc interrupt queue overrun.

                                          141                           ISIS-II
        ISIS DISPLAYS AND HALTS                                January 24, 1983


           BAD08 8763  8063  <5 8002>  Invalid  routine  address   (from  queue
               address).
           BAD0A 8763  8063  <5 8003>  Invalid queue address.
           BAD0C 8762  8062  <5 8004>  MSC     Controller     locked     during
               recalibrate.
           BAD06 8720  8020  <7 8002>  Parity error within DISPATCHER.
           BAD0E 8763  8063  <7 8003>  KERNEL crash.
           BAD06 8740  8040  <7 8004>  Illegal Instruction within DISPATCHER.
           BAD06 8760  8060  <7 8005>  Illegal SVC within DISPATCHER.
           BAD06 8763  8063  <7 8006>  SYSTEM crash (PARITY ERROR in KERNEL).
           BAD06 8750  8050  <7 8007>  Protection   Violation   (should   never
               happen).
           BAD10 8763  8063  <7 8009>  "TOPUT" crash within DISPATCHER.
           BAD02 8765  8065  <7 800A>  "GCI" crash within DISPATCHER.
           BAD04 8765  8065  <7 800B>  "WCI" crash within DISPATCHER.
           BAD06 8765  8065  <7 800C>  "WRECI" crash within DISPATCHER.
           BAD08 8765  8065  <7 800D>  "EMPTY" crash within DISPATCHER.
           BAD12 8763  8063  <7 800E>  Accounting crash within DISPATCHER.
           BAD16 8763                  No dispatcher present.





                    III.2.2  CRASH TABLE

             Physical location 0006C  will always contain the  physical address
        of the beginning of the crash table:

                                  CRASH TABLE HEADER:

        NODENUMBER      HS      1       :Machine node number
        NODETYPE        HS      1       :node type (see table below)
        TABVER          HS      1       :Version of crash table
        CODVER          HS      1       :version of code
        TAKETIME        WS      1       :real time of first takeover (GMT)
        CRCNT           HS      1       :current crash count

                                    CRASH SUMMARY:

        CRCNT           HS      1       :crash count for entry
        CRID            HS      1       :crash ID (see table below)
        CRPSD           WS      2       :crash PSW and PC
        CRTIME          WS      1       :real time of crash (GMT)

                                     DETAIL TABLE:

        CRCNT           HS      1       :crash count for entry
        CRID            HS      1       :crash ID (see table below)
        CRPSD           WS      2       :crash PSW and PC
        CRTIME          WS      1       :real time of crash (GMT)
        REGS0           WS      $0 10   :register set 0
        REGSF           WS      $0 10   :register set F (or current set)

                                          142                           ISIS-II
        ISIS DISPLAYS AND HALTS                                January 24, 1983


        MACREGS         HS      $0 30   :mac registers (locations 300-35F)
        LASTSLOT        HS      1       :last slot executed (filled by ISIS
                                                only)

             The summary  table is  a push-down stack,  meaning that  the first
        entry is for  the last crash, the  second entry is the  previous crash,
        and so  on.  The  crash table  will not  be over-written  by repetitive
        loads and the software will not initialize it.  Thus if the  machine is
        reloaded  with  the  same  code  we  can  still  read  out   old  crash
        information.

             The tabeover label will  contain the real-time value of  the first
        takeover  (in GMT)  after a  reload.  However,  upon first  startup the
        value will be set to  hex 80000000.  Also, any crashes  occuring before
        the  first takeover  will be  the number  of seconds  plus  the initial
        value.  All valid times will not have the high-order bit on.





                    III.2.3  COMMON CRASH HANDLING

             The following section addresses the issue of common crash handling
        for all versions  of node code and  ISIS.  Common crash  codes, console
        formats, and crash action  are all considered.  Common  local debugging
        facilities are deferred to a later date.



        III.2.3.1  Crash Codes

             Crash  codes  will  be  one  byte,  with  the   high-order  nibble
        designating  the general  crash type  and the  low-order  nibble giving
        additional information.

                  2x - Parity error
                  20 - Non-DMA
                  21 - DMA

                  3x - Unexpected interrupt
                  30 - Non-microcode device
                  31 - Microcode-controlled device

                  4x - Instruction failure
                  40 - Illegal instruction (memory location bad)
                  41 - Legal illegal instruction (memory location OK)
                  42 - Instruction malfunction (e.g., illegal result)

                  5x - MAC error
                  50 - Protection violation
                  51 - Out of bounds
                  52 - DMA time-out

                                          143                           ISIS-II
        ISIS DISPLAYS AND HALTS                                January 24, 1983


                  53 - Presence error
                  54 - Write interrupt
                  55 - Fetch error

                  6x - Software-detected errors (common)
                  60 - Illegal SVC
                  61 - Dispatcher detected error
                  62 - Hardware consistency error
                  63 - Software consistency error
                  64 - GCI crash - empty buffer
                  65 - GCI crash - illegal buffer index
                  66 - Bufferlet error - illegal free list pointer

                  7x - Software-detected errors (code-dependent)

                  8x - Configuration error
                  80 - Not enough memory
                  81 - Required device not assigned
                  82 - Wrong device type

                  9x - Device failure
                  90 - Busy/not ready
                  91 - Status error
                  92 - Missing interrupt

                  Ax-Fx - Reserved for future use.

             The above crash codes will be used in the CRID (crash ID) field of
        the crash  table, for  crash reports to  the SUP  log, and  for console
        displays.
























                                          144                           ISIS-II
        CONVENTIONS FOR NAD - DDT COMMUNICATIONS               January 24, 1983






                APPENDIX IV.   CONVENTIONS FOR NAD - DDT COMMUNICATIONS



             A program on the PDP-10 (such  as NAD) can build a circuit  to DDT
        in a  specific slot  on a Tymnet  Engine.  Once  this circuit  has been
        built, it can enter Binary-Mode-Transfers (via the "C" command).  While
        in binary-mode, information is transmitted in an abbreviated form.

             The conventions used are different, depending on the  direction of
        transfer.






                                 IV.1  PDP10 TO ENGINE


           81 - FLUSH  CHAR.  Will cause hand-shake  char to be sent  by Tymnet
               Engine.   The  Engine then  waits  for command.   (Only  sent in
               response to flush request originating at Engine.)
           84 - "0" FILL.  Next data character contains count of 00 bytes.
           85 - "1" FILL.  Next data character contains count of FF bytes.
           80 -  ESCAPE CHAR.  Next  byte is XOR  with 40--the result  is data.
               The only data characters presently requiring escape are:

        80      ESCAPE
        81      FLUSH
        83      
        84      "0" FILL
        85      "1" FILL
        8F
        03      ZAPPER
        0F      














                                          145                           ISIS-II
        CONVENTIONS FOR NAD - DDT COMMUNICATIONS               January 24, 1983


                                 IV.2  ENGINE TO PDP10


           81 - Requests a flush  char from the PDP10, then all  bytes received
               will be ignored until the flush char is received.
           80 -  ESCAPE CHAR -  The following table  indicates meaning  of next
               byte:

        00      DATA CHAR 80.
        01      DATA CHAR 81.
        02      HAND SHAKE - Tymnet Engine waits for a command.
        03      ILLEGAL COMMAND.
        04      ILLEGAL INSTRUCTION AT:
                        followed by 4 bytes of address.
        05      BREAKPOINT ENCOUNTERED
                        followed by 1 byte BP number.
        06      ADDRESS OUT OF RANGE (from G or B).
        07      BREAKPOINT NUMBER OUT OF RANGE (from B).
        08      NO BREAKPOINT TO PROCEED FROM (from P).
        09      MEMORY OUT OF BOUNDS (from R or W).
        0A      ILLEGAL REGISTER NUMBER (from R or W).
        0B      DISK ERROR (from L or S)
                        followed by 2 bytes of status.
        0C      INVALID NUMBER (should never happen).
        0D      INCORRECT BOUNDS (from M).
        0E      BAD SEARCH LENGTH (from X or Y).
        0F      BAD SEARCH BOUNDARY (from X or Y).
        10      ILLEGAL SVC EXECUTED.
        11      ILLEGAL MEMORY REFERENCE BY OUT-SVC.
        12      PARITY ERROR.
        13      ILLEGAL MEMORY REFERENCE BY USER PROGRAM.
        14      LOGGING OFF?
        15      JUMP OUT OF BOUNDS.
        16      SLOT ALREADY CONNECTED.
        17      ILLEGAL INSTRUCTION IN CONTROLLED CODE.
        18      BREAKPOINT ALREADY EXISTS THERE.
        19      DISPATCHER CRASH.
        1A      BAD 'M' ARGUMENTS.
        1B      WE ALREADY HAVE USE OF SPY...ABORTING.
        1C      ABORTING.
        1D      INSUFFICIENT LICENSE.
        1E      FROZEN!
        1F      MAC NOT SET UP CORRECTLY.
        20      ABORTING--AVAILABLE SPACE EXCEEDED.
        21      DISC AREA SAVE PROTECTED.
        22      HALTED! (by other than DDT).








                                          146                           ISIS-II
        SEGMENT 14d -- Core Layout                             January 24, 1983






                       APPENDIX V.   SEGMENT 14d -- Core Layout



             Segment 14d is used  by ISIS to initialize memory  resources, such
        as MAC usage and protection.  It also contains information  for control
        of and communications with  the slot.  This segment is  ALWAYS declared
        read-only, and  should not  be modified by  the user  in any  way.  The
        information is provided  by the user, and  verified by ISIS  before the
        slot may run.  The following data may be found within segment 14d:

         LOC    SIZE    NAME   Usage
         (byte)(byte)  (library)

         0E0000 4      CNTRL   Control flags.
         0E0004 4      CTASIZ  Size of CTA (bytes).
         0E0008 4      AREAS   Memory area 0 requirements (bytes).
         0E000C 4x13d          Additional     memory      area     requirements
                                (bytes/area).
         0E0040 2      NPROT   Count of usable protection bytes.
         0E0042   14d  PROT    Memory protection requirements, by segments.

         0E0050 4      ISTART  Slot execution start address.
         0E0054 4      DSTART  DDT execution start address.
         0E0058 4      FPANEL  Pointer to front-panel display cell.
         0E005C 4      HOSTS   Pointer to host table.
         0E0060 4      PORTS   Pointer to port table.
         0E0064 4      PTABLE  Pointer to termination table.
         0E0068 4      IRINGP  Pointer to input ring discriptor.
         0E006C 4      ORINGP  Pointer to output ring discriptor.
         0E0070 4      IBKPNT  Pointer to "FROMISIS" bit array.
         0E0074 4      OBKPNT  Pointer to "TOISIS" bit array.
         0E0078 4      PCBPNT  Pointer to project code termination bit array.
         0E007C 4      CSADDR  Core start address.
         0E0080 2      HOSTN   Maximum number of hosts.
         0E0082 2      NPORTS  Highest real port number.
         0E0084 2      IMAXI   Size of input ring (bytes).
         0E0086 2      OMAXI   Size of output ring (bytes).
         0E0088 2      SLOTNO  Slot number.
         0E008A 1      SVERNO  Slot version number.
         0E008B 1      SREVLE  Slot revision level.
         0E008C 4      DD.BG2  Second DDT entry.
         0E0090 2      MACPNT  HW pointer to extended MAC sets.
         0E0092 2      MAXCNT  HW count of extended MAC sets.
         0E008C 64d            reserved for expansion.


                                     CONTROL BITS


                                          147                           ISIS-II
        SEGMENT 14d -- Core Layout                             January 24, 1983


             The word labeled CNTRL contains a number of bit flags:

           00000002  Set if  ports not reusable until they emit a disconnect.
           00000004  Set if number of ports may be changed.
           00000008  Set if host numbers may be changed.
           00000010  Slot wants to know about take-over.
           00000020  Slot wants to know supervisor time.
           00000040  Slot can originate reset requests.
           00000080  Slot wants zappers and detach's acknowledged.
           00000100  Set to accumulate project code.
           00000200  Slot wants out-of-band flow-control.
           00000400  Slot wants "1-down" messages.
           00000800  Slot wants to know about undertake.
           00001000  Slot uses extended memory.

             These  bits  are "OR'ed"  to  specify the  collection  of services
        required.





































                                          148                           ISIS-II
        SEGMENT 15d -- Core Layout                             January 24, 1983






                       APPENDIX VI.   SEGMENT 15d -- Core Layout



             Segment 15d is used by ISIS to make System Variables  available to
        the individual users.  This  segment is ALWAYS declared  read-only, and
        may not be modified by the user in any way.  The following data  may be
        found within segment 15d:

         LOC    SIZE    NAME   Usage
         (byte)(byte)  (library)

         0F0000 4      RATE    The rate at which the fast clock ticks.
         0F0004 4      FASTC   The fast clock
         0F0008 4      SLOWC   The slow clock (ticks once/second)
         0F000C 4      GMT     The  GMT clock  (ticks once/second);   This will
                                have the high-order  bit set, whenever  the GMT
                                is not known.
         0F0010 1      TEMPER  Machine   temperature,   as   read    from   the
                                multifunction card.
         0F0011  1     VOLTS   Machine voltage, as read from  the multifunction
                                card.
         0F0012   2    VERNO   The ISIS  version number  (binary: corresponding
                                decimal  number  has  leading  digits   as  the
                                version number, low two digits are the revision
                                level.
         0F0014 4              unused!  (0 if not implemented.)
         0F0018 2      HOSTX   Kernel host number.
         0F001A   2    NODEX   Kernel node number.
         0F001C 2      LO.CLK  Local-clock   area  pointer   (see  description,
                                below), relative to  RATE (the base  of segment
                                0F...LCX = RATE+(LO.CLK) ]).
         0F001E   2    NSLOT   The number  of the  highest-numbered dispatcher-
                                connected slot.
         0F0020 2      LCT     Location of crash table relative to RATE.
         0F0022   2    MAXP0   Largest port 0 message number.
         0F0024 2      MAXMSG  Largest non-port 0 message number.
         0F0026   2    LP0LST  Location  of  a  list  of  port-0  message sizes
                                relative to RATE.  The list has 1 byte for each
                                message  type,  that  indicates  the  number of
                                bytes  in the  message, exclusive  of  the port
                                number.  A value 0 indicates  a variable-lenght
                                message.
         0F0028 100x   LENGTH  Length table for non-port 0  messages, formatted
                                as above.
         0F0128 8      A.SPED  Bit  array  specifying  ASYNC   terminal  speeds
                                supported.



                                          149                           ISIS-II
        SEGMENT 15d -- Core Layout                             January 24, 1983


                               LCX -- Local Clocks area


         LCX-2    2    Local system clock.   Ticks whenever a slot  numbered -1
                                (FF -- ISIS Flasher) is running.
         LCX    2      local  clock  index,  referenced  via   LO.CLK.   Index,
                                relative to LCX, for the local  clock currently
                                being ticked.
         LCX+2    2    the local clock for slot 0.
         LCX+4  2              the local system clock for slot 0.  (Ticks while
                                dispatcher is cleaning up after slot 0.)
         LCX+6    2            the local clock for slot 1.
         LCX+8  2              the local system clock for slot 1.
         . . .                 For    a    system    with    NSLOT,    location
                                [4*NSLOT+LCX+6]  will  be ticked  by  any other
                                processes active (eg, Supervisor).


             The  local clock  ticks at  the same  rate as  FASTC;  counting is
        directed at the appropriate local clock each time a  new context-switch
        is performed by  the KERNEL.  In particular,  there are TWO  clocks for
        each dispatcher-connected slot:  The  one which runs while the  slot is
        active, and the one which  runs while the system is  performing actions
        for that slot (eg, the dispatcher is servicing the output  generated by
        the slot).   Note that  a slot performing  a disproportionate  share of
        input may end  up with a  low recorded share  of system usage,  while a
        slot  which  does  mostly  output  will  get  a   correspondingly  high
        indication.   The two  slot clocks,  used together,  should  provide an
        indication of the share of machine time that slot is using.

             To determine the share of machine time any slot is using,  one can
        "snapshot" both the local clock  of interest, and FASTC; after  a short
        wait,  a  second "snapshot"  will  allow the  computation  of  real and
        virtual elapsed time, from which a presentage may be derived.




















                                          150                           ISIS-II
        OBSOLETE WAYS TO RESTART AN ISIS-II NODE               January 24, 1983






               APPENDIX VII.   OBSOLETE WAYS TO RESTART AN ISIS-II NODE



             The mechanisms described in this appendix, while still applicable,
        have been largely superceeded by the introduction of the LOADII program
        and down-line loading.   See the document,  TOOLS AND UTILITIES,  for a
        description of the use of LOADII.

             The  conventions  used herein  are  the same  as  in  the chapter,
        STARTING AND RESTARTING AN ISIS-II MACHINE.






                        VII.1  RELOAD PROCEDURE (FROM TERMINAL)


             The machine may be reloaded from the TTY card, using a "Y" cable.

             Plug the terminal into the TTY card!  Press <DTA, PSW, 6, 0, ADR>.
        The console should display  00060 8000.  Now press <SGL>.   The console
        should display XXD36 8000, where XX is is a digit followed by 0 or F.



             If  not, do  "start from  scratch procedure".   If the  values are
        correct, log into  ISIS2:33 from the terminal  next to the  machine and
        type:

        -R NAD
        <version>
        ;@   ******.CMD         (****** is name of machine)

                        it types a LOT of stuff!
        end of assembly

        0,IEND;8                (SEE NOTE BELOW BEFORE YOU TYPE THIS)
        [garbage]
        %Q
        -

             NOTE...after you type the ;8 an automatic CR LF will  occur (don't
        type CR after ;8).  After the  CR LF completes press <RUN> -  take your
        time, you have at  least 3 seconds.  If all  goes well there will  be a
        change in the console (it  no longer displays an address;   instead the


                                          151                           ISIS-II
        OBSOLETE WAYS TO RESTART AN ISIS-II NODE               January 24, 1983


        high 5 digits will start counting down, (this is the number of bytes of
        memory left to  load), and the low  2 digits will start  flashing (last
        character received).  When done, a successful load is indicated  by the
        console displaying FFFFF00xx).  Now perform "start up (without reload)"
        procedure.






                          VII.2  START-FROM-SCRATCH PROCEDURE


             This  procedure  has two  options:  you can  either  use  the PROM
        procedure, or the TTY card procedure.





                    VII.2.1  TTY (MULTIFUNCTION) CARD START FROM SCRATCH

             Plug the terminal into the TTY card!  Press <DTA, 2, 8, 0, ADR, 2,
        9, 4>.

             on the TTY  card you will  find a terminal-speed  selector switch.
        Set the switch to 1200.



             Now login  to ISIS:33  from the  terminal next  to the  engine and
        type:

        -R NAD
        <version>
        ;@   (ISIS)EBOOT.NAD

        disk 0FE5C 0FFA2
        end of assembly

        BBOOT,200%8             (SEE NOTE BELOW BEFORE YOU TYPE THIS)
        [garbage]
        loaded
        %Q
        -

             NOTE...after you type the %8 an automatic CR LF will  occur (don't
        type CR after %8).   After the CR LF  completes press <BT> -  take your
        time, you have at least 3 seconds.  If all goes well, data  output from
        the terminal will correspond to  a change in the console.  If  not call
        for help.  Now perform reload procedure.


                                          152                           ISIS-II
        OBSOLETE WAYS TO RESTART AN ISIS-II NODE               January 24, 1983


             The bootstrap, once loaded  into memory, immediately find  the end
        of  existing memory,  and relocates  itself to  the last  512  bytes of
        memory.   It also  places the  appropriate instructions  for  the other
        reload procedures.






                          VII.3  RELOAD PROCEDURE (FROM DISK)


             This procedure may apply if the system has a disk.

             Press  <DTA, SET,  6, 6,  ADR>.  The  consol should  display 00066
        8000.  Now press <SGL>.  The console should now display XXF0C 8000.  If
        it doesn't,  go to  "start from  scratch" procedure.   Otherwise, press
        <RUN>.  The right half of the console will go to zero.  When the consol
        goes to 000E,  the load is complete.   If any other value  appears call
        for help.  Now follow start up procedure.

































                                          153                           ISIS-II
                                       GLOSSARY                January 24, 1983


        NEEDLE               -- A  message  describing  a  new  circuit  to the
                                 destination.

        SLOT                 -- A slot is the collection of resources allocated
                                 to   a   single  entity,   and   includes  the
                                 particular process or set of processes capable
                                 of using those resources.

        ZAPPER               -- A  message  describing the  disappearance  of a
                                 circuit  --  passage of  a  zapper  causes the
                                 release  of  resources  associated  with  that
                                 circuit.










































                                          154                           ISIS-II
                                         INDEX                 January 24, 1983


                                         INDEX

        1-DOWN MESSAGE  22                    CONTROL TABLE AREA  3, 26, 147
                                              CP  46
                                              CS  42
        A.SPED  149                           CSADDR  147
        ACCESS LICENSES  64                   CTA  3, 26, 87, 147
        ACCOUNTING  4, 5, 15                  CTASIZ  147
        ADDENDUM TO ACCOUNTING
           MESSAGE  15
        AGCI ROUTINE  104                     DATA LOST MESSAGE  11
        ALU  46                               DATA-SET-READY  see DSR
        AREAS  147                            DATA-TERMINAL-READY  see DTR
        ASYNC I/O  104                        DD.BG2  147
        ASYNCHRONOUS I/O  44                  DDT  64
        AUX CIRCUIT  25                       DDT BREAKPOINTS  65
        AUX PSEUDO-NEEDLE REQUEST             DDT EXECUTION  66
           MESSAGE  19                        DDT INITIALIZATION  67
        AUXILIARY-  see AUX-                  DDT LICENCES  64
        AWCI ROUTINE  104                     DDT MAC INITIALIZATION FOR
        AWCP ROUTINE  105                        SLOT  65, 77
                                              DDT MEMORY SEARCHES  67, 71, 71
                                              DDT PROCESS  2
        BACKGROUND  2                         DDT PROGRAM STEPPING  68
        BACKPRESSURE  4, 11                   DDT READ COMMAND  85
        BID ROUTINE  89                       DDT SLOT CONNECTION  66
        BIDH ROUTINE  89                      DDT SLOT DISCONNECTION  66
        BLACK BALL  11                        DDT SPY COMMAND  70
        BREAK MESSAGE  11                     DDT TTY INPUT  59
        BREAKPOINTS, DDT  65                  DDT TTY OUTPUT  60
        BRINGING A SLOT ONLINE  66            DDT WRITE COMMAND  85
        BUFFER  94                            DDT-DEBUGGER COMMUNICATIONS  84
        BUFFER INDEX  94                      DDT:  EXAMINING MEMORY  68
        BUFFERLET  94                         DDT:  EXAMINING PROGRAM
                                                 STATUS  69
                                              DDT:  EXAMINING REGISTERS  68
        CARRIER PRESENT  see CP               DDT:  MODIFYING MEMORY  70
        CHANGE CONTEXT SVC  61                DDT:  PROCEEDING FROM A
        CHANGE MAC SET SVC  59                   BREAKPOINT  68
        CHECK BACKGROUND SVC  62              DDT: INTERRUPTING A PROGRAM  82
        CIRCUIT ORIGINATION  24               DDT: MODIFYING REGISTERS  71
        CIRCUIT TERMINATION  24               DEBUGGER-DDT COMMUNICATIONS  84
        CIRCUIT-FAILURE MESSAGE  14           DEFERED-ECHO-MODE  see DEM
        CIRCUITS  24                          DEM  11
        CLEAR-TO-SEND  see CS                 DETACH MESSAGE  11
        CNTRL  147                            DIAGNOSTIC COLLECTION  5
        COMMAND FILE  116                     DIAGNOSTIC MESSAGE  17
        COMMAND LIST  42                      DISC DRIVER  50
        CONFIGURATION MEMORY                  DISCONNECT MESSAGE  11
           REQUIREMENTS  123                  DISCONNECTING A SLOT  66
        CONNECT PRINTER SVC  48               DISCONNECTION FROM DDT  72
        CONNECTING A SLOT  66                 DISK BOOTSTRAP
        CONSOLE  127                             DIAGNOSTICS  128, 128

                                          155                           ISIS-II
                                         INDEX                 January 24, 1983




        DISK RELOAD  153                      HALTS  140
        DISMISS  31                           HOSTN  147
        DISMISS SVC  31                       HOSTS  147
        DISPATCHER  3, 9, 26, 77              HOSTX  149
        DISPLAYS  140
        DS.CUC ROUTINE  109
        DS.DEL ROUTINE  109                   I/O SOFTWARE CONNECTION  40
        DS.ERR ADDRESS  109                   I/O SVC  40
        DS.EXI ROUTINE  109                   IBKPNT  147
        DS.GCH ROUTINE  109                   IIX  11
        DS.ILL ADDRESS  109                   IMAXI  147
        DS.NUM ROUTINE  110                   INITIALIZATION OF MAC FOR
        DS.QUI ROUTINE  109                      SLOT  65, 77
        DS.TOK ROUTINE  109                   INPUT RING  9
        DSR  42, 46                           INTELLIGENT INTERFACE  11
        DSTART  147                           INTERFACE  1
        DSTART ROUTINE  109                   INTERNAL COMMUNICATIONS  3
        DTR  42, 46                           INTERNAL MESAGE FORMAT  10
                                              INTERRUPTS  1
                                              IRINGP  147
        ELIR ROUTINE  93                      ISIS  1
        ELODR ROUTINE  93                     ISIS DISPLAYS  140
        ELOR ROUTINE  93                      ISIS HALTS  140
        EMPTY ROUTINE  95                     ISIS INTERNAL COMMUNICATION  9
        ERROR MESSAGE  17                     ISIS LIBRARY  87
        EXECUTING A PROGRAM UNDER DDT  66     ISIS MESAGE FORMAT  10
        EXTENDED LOGON STATUS  see NORMAL     ISIS RINGS  9, 91
           LOGON STATUS                       ISIS SVC'S  31, 137
                                              ISIS SYSTEM GENERATION  122
                                              ISIS-II RELOAD  151
        FASTC  149                            ISTART  147
        FLUSH MESSAGE  11                     IZBF ROUTINE  95
        FLUSH ROUTINE  92                     IZT ROUTINE  90
        FOREGROUND PROCESS  2
        FPANEL  147
                                              KERNEL  1, 3
                                              KERNEL-I/O SVC'S  59
        GCI ROUTINE  95
        GENERATION, ISIS  122
        GETCH ROUTINE  92                     LCT  149
        GETH ROUTINE  92                      LCX  150
        GETW ROUTINE  92                      LENGTH  149
        GLOBAL UNITS  124                     LIBRARY  87
        GMT  149                              LICENCES, GOODGUY  64
        GOBBLER  11                           LO.CLK  149
        GOODGUY LICENCES  64                  LOADING A SLOT  130
        GOUGING LEVEL  11                     LOCAL CLOCKS  150
        GREEN BALL  11                        LOGON-FAILURE MESSAGE  14
        GREY BALL  11                         LOOK ROUTINE  92
                                              LP0LST  149


                                          156                           ISIS-II
                                         INDEX                 January 24, 1983




        MAC  3                                PTABLE  147
        MAC INITIALIZATION FOR                PUTCH ROUTINE  93
           SLOT  65, 77                       PUTW ROUTINE  93, 93
        MACPNT  147
        MAXCNT  147
        MAXMSG  149                           QUASI-PROCESS  2
        MAXP0  149                            QUERY LOGICAL UNIT ATTRIBUTES  40
        MEMORY PROTECTION  see PROT           QUERY TERMINAL PARAMETER
        MEMORY REQUIREMENTS,                     MESSAGE  12
           CONFIGURATION  123
        MERLIN  130
        MERLIN NIB-FILE BINDER  117           RATE  149
        MOTHER-BOARD  49                      READ COMMAND, DDT  85
                                              RED BALL  11
                                              RELOAD  151
        NEEDLE  24, 154                       REQUEST-TO-SEND  see RS
        NODEX  149                            RESTARTING A MACHINE  127, 128
        NORMAL CIRCUIT  24                    RING  9, 91
        NORMAL LOGON STATUS  13               ROOM ROUTINE  93
        NORMAL PSEUDO-NEEDLE MESSAGE  12      ROTOR LIST  42
        NORMAL PSEUDO-NEEDLE REQUEST          ROUTING  5
           MESSAGE  19                        RS  42, 45
        NPORTS  147
        NPROT  147
        NSLOT  149                            SCHEDULING  1, 2
                                              SEGMENT 0E  147
                                              SEGMENT 0F  149
        OBKPNT  147                           SEGMENT 14D -- CORE LAYOUT  147
        OBS ROUTINE  92                       SEGMENT 15D -- CORE LAYOUT  149
        OCM ROUTINE  92                       SERIAL-I/O  49
        OCS ROUTINE  92                       SET TERMINAL PARAMETER
        OFFLINE, TAKING A SLOT  66               MESSAGE  12
        OMAXI  147                            SHARED DEVICES  124
        ONLINE, BRINGING A SLOT  66           SHARED LOGICAL UNITS  125
        ORANGE BALL  11                       SLOR ROUTINE  93
        ORINGP  147                           SLOT  2, 154
        OUTPUT NUMBER SVC  62                 SLOT MAC INITIALIZATION  65, 77
        OUTPUT RING  9                        SLOT, LOADING  130
                                              SLOTNO  147
                                              SLOWC  149
        PACKAGES, LIBRARY  87                 SOFTWARE ASYNCHRONOUS I/O
        PCBPNT  147                              CONNECTION  44
        PORTS  147                            SOFTWARE CONNECTION OF I/O  40
        PRINT STREAM FORMAT  48               SOFTWARE PRINTER OUTPUT
        PRINTER I/O  47                          CONNECTION  48
        PRIORITY  1                           SOFTWARE SYNCHRONOUS INPUT
        PROM BOOTSTRAP  127                      CONNECTION  41
        PROT  26, 147                         SOFTWARE SYNCHRONOUS OUTPUT
        PSEUDO-NEEDLE  24, 24                    CONNECTION  42
        PSEUDO-NEEDLE REJECTION               SOFTWARE SYNCHRONOUS OUTPUT
           MESSAGE  20                           FORCED CONNECTION  43

                                          157                           ISIS-II
                                         INDEX                 January 24, 1983




        SOFTWARE SYNCHRONOUS OUTPUT           YELLOW BALL  11
           NORMAL CONNECTION  43
        SPACE ROUTINE  93
        SPY COMMAND, DDT  70                  ZAP ACKNOWLEDGE  15
        SPY LIBRARY  113                      ZAP HANDLING SVC  62
        SREVLE  147                           ZAPPER  11, 154
        START-FROM-SCRATCH PROCEDURE  152
        STARTING A MACHINE  127, 151
        SUP LOST MESSAGE  22
        SUPERVISORY COMMANDS  31, 137
        SVC  31, 137
        SVC, DISMISS  31
        SVERNO  147
        SYNCHRONOUS INPUT  41
        SYNCHRONOUS LINE PADDING  42
        SYNCHRONOUS OUTPUT  42
        SYSTEM GENERATION  122
        SYSTEM VARIABLES  149
        SYSTEM-DEBUG MODE  119


        TAKEOVER MESSAGE  17
        TAKING A SLOT OFFLINE  66
        TAPE DRIVER  50
        TEMPER  149
        TERMINAL PARAMETERS  12
        TIME (GMT) MESSAGE  18
        TIMESLICES  2
        TIMOUT ROUTINE  90
        TOGET ROUTINE  90
        TONOW ROUTINE  91
        TOPUT ROUTINE  90
        TORET ADDRESS  90
        TPC  11
        TRANSPARENCY MESSAGE  11
        TTY BOOTSTRAP  152
        TTY RELOAD  151
        TYMNET  24


        UNDERTAKER MESSAGE  22


        VERNO  149
        VOLTS  149


        WCD ROUTINE  95
        WCI ROUTINE  95
        WRITE COMMAND, DDT  85


                                          158                           ISIS-II
 %@Z